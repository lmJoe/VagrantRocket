!function(t,e,r){r.un,r.uns;var i=r.static,n=r.class,a=r.getset,s=(r.__newvec,laya.maths.Bezier),o=laya.resource.Bitmap,h=laya.utils.Browser,u=(laya.filters.ColorFilter,laya.utils.ColorUtils),l=r.Config,c=laya.resource.Context,_=(laya.display.cmd.DrawImageCmd,laya.events.Event,laya.display.cmd.FillTextCmd,laya.filters.Filter),d=laya.utils.FontInfo,f=laya.resource.HTMLCanvas,x=(laya.utils.HTMLChar,laya.resource.HTMLImage),p=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),b=laya.maths.Point,m=laya.maths.Rectangle,T=laya.renders.Render,v=laya.renders.RenderSprite,C=laya.resource.Resource,g=(laya.display.cmd.RestoreCmd,laya.display.cmd.RotateCmd,laya.utils.RunDriver),y=(laya.display.cmd.SaveCmd,laya.display.cmd.ScaleCmd,laya.display.Sprite),S=(laya.display.SpriteConst,laya.display.css.SpriteStyle,laya.display.Stage),R=laya.utils.Stat,E=laya.utils.StringKey,A=laya.system.System,M=(laya.display.Text,laya.resource.Texture),L=(laya.display.cmd.TransformCmd,laya.display.cmd.TranslateCmd,laya.utils.VectorGraphManager);laya.utils.WordText;r.interface("laya.webgl.submit.ISubmit"),r.interface("laya.webgl.canvas.save.ISaveData");var D=function(){function SaveBase(){}n(SaveBase,"laya.webgl.canvas.save.SaveBase");var t=SaveBase.prototype;return r.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,SaveBase.POOL[SaveBase.POOL._length++]=this,this._newSubmit&&(t._curSubmit=P.RENDERBASE)},SaveBase._createArray=function(){var t=[];return t._length=0,t},SaveBase._init=function(){var t=SaveBase._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t[8388608]="_colorFiler",t},SaveBase.save=function(t,e,r,i){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var n=SaveBase.POOL,a=n._length>0?n[--n._length]:new SaveBase;a._value=r[a._valueName=SaveBase._namemap[e]],a._dataObj=r,a._newSubmit=i;var s=t._save;s[s._length++]=a}},SaveBase.POOL=laya.webgl.canvas.save.SaveBase._createArray(),SaveBase._namemap=SaveBase._init(),SaveBase}(),w=function(){function Value2D(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.defines=new At,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=Value2D._cache[this._cacheID],t>0&&!this._inClassCache&&(this._inClassCache=Value2D._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}n(Value2D,"laya.webgl.shader.d2.value.Value2D");var t=Value2D.prototype;return t.setValue=function(t){},t._ShaderWithCompile=function(){return Pt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Ft.create,this._attribLocation)},t.upload=function(){var t=ot;ot.worldMatrix4===ot.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4,ot.matWVP&&(this.defines.addInt(2048),this.u_MvpMatrix=ot.matWVP.elements);var e=Pt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},t.setFilters=function(t){if(this.filters=t,t)for(var e,r=t.length,i=0;i<r;i++)(e=t[i])&&(this.defines.add(e.type),e.action.setValue(this))},t.clear=function(){this.defines._value=this.subID+($.shaderHighPrecision?1024:0)},t.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1)},Value2D._initone=function(t,e){Value2D._typeClass[t]=e,Value2D._cache[t]=[],Value2D._cache[t]._length=0},Value2D.__init__=function(){Value2D._initone(4,Tt),Value2D._initone(512,mt),Value2D._initone(1,vt),Value2D._initone(9,vt)},Value2D.create=function(t,e){var r=Value2D._cache[t|e];return r._length?r[--r._length]:new Value2D._typeClass[t|e](e)},Value2D._cache=[],Value2D._typeClass=[],Value2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Value2D}(),B=function(){function Shader2D(){this.ALPHA=1,this.shaderType=0,this.defines=new At,this.fillStyle=_t.DEFAULT,this.strokeStyle=_t.DEFAULT}return n(Shader2D,"laya.webgl.shader.d2.Shader2D"),Shader2D.prototype.destroy=function(){this.defines=null,this.filters=null},Shader2D.__init__=function(){var t,e;t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = pos.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e="/*\n\ttexture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",Pt.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}",Pt.preCompile2D(0,4,t,e,null),t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = pos.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n\n#import?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n\n#import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_uniform;\n\n#import?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n\n#import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_uniform;\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   \n   #import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_logic;\n   \n   #import?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   \n   #import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_logic;\n   \n   #import?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Pt.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Pt.preCompile2D(0,512,t,e,null)},Shader2D}(),G=function(){function Buffer(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,this._glBuffer=V.instance.createBuffer()}n(Buffer,"laya.webgl.utils.Buffer");var t=Buffer.prototype;return t._bindForVAO=function(){},t.bind=function(){return!1},t.destroy=function(){this._glBuffer&&(V.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)},a(0,t,"bufferUsage",function(){return this._bufferUsage}),Buffer._bindedVertexBuffer=null,Buffer._bindedIndexBuffer=null,Buffer}(),W=function(){function ShaderDefinesBase(t,e,r){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=r}n(ShaderDefinesBase,"laya.webgl.shader.ShaderDefinesBase");var t=ShaderDefinesBase.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||ShaderDefinesBase._toText(this._value,this._int2name,this._int2nameMap)},ShaderDefinesBase._reg=function(t,e,r,i){r[t]=e,i[e]=t},ShaderDefinesBase._toText=function(t,e,r){var i=r[t];if(i)return i;for(var n={},a=1,s=0;s<32&&!((a=1<<s)>t);s++)if(t&a){var o=e[a];o&&(n[o]="")}return r[t]=n,n},ShaderDefinesBase._toInt=function(t,e){for(var r=t.split("."),i=0,n=0,a=r.length;n<a;n++){var s=e[r[n]];if(!s)throw new Error("Defines to int err:"+t+"/"+r[n]);i|=s}return i},ShaderDefinesBase}(),I=(function(){function ArabicReshaper(){}n(ArabicReshaper,"laya.webgl.text.ArabicReshaper");var t=ArabicReshaper.prototype;t.characterMapContains=function(t){for(var e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e][0]===t)return!0;return!1},t.getCharRep=function(t){for(var e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e][0]===t)return ArabicReshaper.charsMap[e];return!1},t.getCombCharRep=function(t,e){for(var r=0;r<ArabicReshaper.combCharsMap.length;++r)if(ArabicReshaper.combCharsMap[r][0][0]===t&&ArabicReshaper.combCharsMap[r][0][1]===e)return ArabicReshaper.combCharsMap[r];return!1},t.isTransparent=function(t){for(var e=0;e<ArabicReshaper.transChars.length;++e)if(ArabicReshaper.transChars[e]===t)return!0;return!1},t.getOriginalCharsFromCode=function(t){var e=0;for(e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e].indexOf(t)>-1)return String.fromCharCode(ArabicReshaper.charsMap[e][0]);for(e=0;e<ArabicReshaper.combCharsMap.length;++e)if(ArabicReshaper.combCharsMap[e].indexOf(t)>-1)return String.fromCharCode(ArabicReshaper.combCharsMap[e][0][0])+String.fromCharCode(ArabicReshaper.combCharsMap[e][0][1]);return String.fromCharCode(t)},t.convertArabic=function(t){for(var e,r,i="",n=0;n<t.length;++n){var a=t.charCodeAt(n);if(this.characterMapContains(a)){for(var s=null,o=null,h=n-1,u=n+1;h>=0&&this.isTransparent(t.charCodeAt(h));--h);for((!(e=!!(s=h>=0?t.charCodeAt(h):null)&&this.getCharRep(s))||null==e[2]&&null==e[3])&&(s=null);u<t.length&&this.isTransparent(t.charCodeAt(u));++u);if((!(e=!!(o=u<t.length?t.charCodeAt(u):null)&&this.getCharRep(o))||null==e[3]&&null==e[4])&&(o=null),1604===a&&null!=o&&(1570===o||1571===o||1573===o||1575===o)){r=this.getCombCharRep(a,o),i+=null!=s?String.fromCharCode(r[4]):String.fromCharCode(r[1]),++n;continue}if(e=this.getCharRep(a),null!=s&&null!=o&&null!=e[3]){i+=String.fromCharCode(e[3]);continue}if(null!=s&&null!=e[4]){i+=String.fromCharCode(e[4]);continue}if(null!=o&&null!=e[2]){i+=String.fromCharCode(e[2]);continue}i+=String.fromCharCode(e[1])}else i+=String.fromCharCode(a)}return i},t.convertArabicBack=function(t){var e="",r=0,i=0;for(i=0;i<t.length;++i)r=t.charCodeAt(i),e+=this.getOriginalCharsFromCode(r);return e},i(ArabicReshaper,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}])}(),function(){function SaveTransform(){this._matrix=new p}n(SaveTransform,"laya.webgl.canvas.save.SaveTransform");var t=SaveTransform.prototype;return r.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,SaveTransform.POOL[SaveTransform.POOL._length++]=this},SaveTransform.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var r=SaveTransform.POOL,i=r._length>0?r[--r._length]:new SaveTransform;i._savematrix=t._curMat,t._curMat=t._curMat.copyTo(i._matrix);var n=t._save;n[n._length++]=i}},SaveTransform.POOL=D._createArray(),SaveTransform}()),P=function(){function Submit(t){this.clipInfoID=-1,this._numEle=0,this._ref=1,this._key=new tt,void 0===t&&(t=1e4),this._renderType=t,this._id=++Submit.ID}n(Submit,"laya.webgl.submit.Submit");var t=Submit.prototype;return r.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.getID=function(){return this._id},t.releaseRender=function(){Submit.RENDERBASE!=this&&--this._ref<1&&(Submit.POOL[Submit._poolSize++]=this,this.shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var r=$.mainContext;return this._mesh.useMesh(r),this.shaderValue.upload(),k.activeBlendFunction!==this._blendFn&&(ct.setBlend(r,!0),this._blendFn(r),k.activeBlendFunction=this._blendFn),r.drawElements(4,this._numEle,5123,this._startIdx),R.renderBatch++,R.trianglesFaces+=this._numEle/3,1},t._cloneInit=function(t,e,r,i){t._ref=1,t._mesh=r,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=i*O.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},t.clone=function(t,e,r){return null},t.reUse=function(t,e){return 0},t.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},Submit.__init__=function(){var t=Submit.RENDERBASE=new Submit(-1);t.shaderValue=new w(0,0),t.shaderValue.ALPHA=1,t._ref=4294967295},Submit.create=function(t,e,r){var i=Submit._poolSize?Submit.POOL[--Submit._poolSize]:new Submit;i._ref=1,i._mesh=e,i._key.clear(),i._startIdx=e.indexNum*O.BYTES_PIDX,i._numEle=0;var n=t._nBlendType;i._blendFn=t._targets?k.targetFns[n]:k.fns[n],i.shaderValue=r,i.shaderValue.setValue(t._shader2D);var a=t._shader2D.filters;return a&&i.shaderValue.setFilters(a),i},Submit.createShape=function(t,e,r,i){var n=Submit._poolSize?Submit.POOL[--Submit._poolSize]:new Submit;n._mesh=e,n._numEle=r,n._startIdx=2*e.indexNum,n._ref=1,n.shaderValue=i,n.shaderValue.setValue(t._shader2D);var a=t._nBlendType;return n._key.blendShader=a,n._blendFn=t._targets?k.targetFns[a]:k.fns[a],n},Submit.TYPE_2D=1e4,Submit.TYPE_CANVAS=10003,Submit.TYPE_CMDSETRT=10004,Submit.TYPE_CUSTOM=10005,Submit.TYPE_BLURRT=10006,Submit.TYPE_CMDDESTORYPRERT=10007,Submit.TYPE_DISABLESTENCIL=10008,Submit.TYPE_OTHERIBVB=10009,Submit.TYPE_PRIMITIVE=10010,Submit.TYPE_RT=10011,Submit.TYPE_BLUR_RT=10012,Submit.TYPE_TARGET=10013,Submit.TYPE_CHANGE_VALUE=10014,Submit.TYPE_SHAPE=10015,Submit.TYPE_TEXTURE=10016,Submit.TYPE_FILLTEXTURE=10017,Submit.KEY_ONCE=-1,Submit.KEY_FILLRECT=1,Submit.KEY_DRAWTEXTURE=2,Submit.KEY_VG=3,Submit.KEY_TRIANGLES=4,Submit.RENDERBASE=null,Submit.ID=1,Submit.preRender=null,Submit._poolSize=0,Submit.POOL=[],Submit}(),O=function(){function CONST3D2D(){}return n(CONST3D2D,"laya.webgl.utils.CONST3D2D"),CONST3D2D.BYTES_PE=4,CONST3D2D.BYTES_PIDX=2,CONST3D2D.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],CONST3D2D.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],CONST3D2D.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],CONST3D2D._TMPARRAY=[],CONST3D2D._OFFSETX=0,CONST3D2D._OFFSETY=0,CONST3D2D}(),N=(function(){function MatirxArray(){}n(MatirxArray,"laya.webgl.utils.MatirxArray"),MatirxArray.ArrayMul=function(t,e,r){if(t)if(e)for(var i=NaN,n=NaN,a=NaN,s=NaN,o=0;o<4;o++)i=t[o],n=t[o+4],a=t[o+8],s=t[o+12],r[o]=i*e[0]+n*e[1]+a*e[2]+s*e[3],r[o+4]=i*e[4]+n*e[5]+a*e[6]+s*e[7],r[o+8]=i*e[8]+n*e[9]+a*e[10]+s*e[11],r[o+12]=i*e[12]+n*e[13]+a*e[14]+s*e[15];else MatirxArray.copyArray(t,r);else MatirxArray.copyArray(e,r)},MatirxArray.copyArray=function(t,e){if(t&&e)for(var r=0;r<t.length;r++)e[r]=t[r]}}(),function(){function VertexArrayObject(){}return n(VertexArrayObject,"laya.webgl.VertexArrayObject"),VertexArrayObject}()(function(){var e={};function synthesizeGLError(r,i){var n;e[r]=!0,void 0!==i&&(n=i,t.console&&t.console.error&&t.console.error(n))}var r=function WebGLVertexArrayObjectOES(t){var e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(var r=0;r<this.attribs.length;r++){var i=new WebGLVertexArrayObjectOES.VertexAttrib(e);this.attribs[r]=i}this.maxAttrib=0};(r.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var i=function(r){var i=this;this.gl=r,function(t){var r=t.getError;t.getError=function(){do{(i=r.apply(t))!=t.NO_ERROR&&(e[i]=!0)}while(i!=t.NO_ERROR);for(var i in e)if(e[i])return delete e[i],parseInt(i);return t.NO_ERROR}}(r);var n=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(t){return t==i.VERTEX_ARRAY_BINDING_OES?i.currentVertexArrayObject==i.defaultVertexArrayObject?null:i.currentVertexArrayObject:n.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(t){var e=i.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(t){var e=i.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(t,e){switch(t){case r.ARRAY_BUFFER:i.currentArrayBuffer=e;break;case r.ELEMENT_ARRAY_BUFFER:i.currentVertexArrayObject.elementArrayBuffer=e}return n.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(t,e){var a=i.currentVertexArrayObject.attribs[t];switch(e){case r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return a.buffer;case r.VERTEX_ATTRIB_ARRAY_ENABLED:return a.enabled;case r.VERTEX_ATTRIB_ARRAY_SIZE:return a.size;case r.VERTEX_ATTRIB_ARRAY_STRIDE:return a.stride;case r.VERTEX_ATTRIB_ARRAY_TYPE:return a.type;case r.VERTEX_ATTRIB_ARRAY_NORMALIZED:return a.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(t,e,r,a,s,o){var h=i.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,t);var u=h.attribs[t];return u.buffer=i.currentArrayBuffer,u.size=e,u.type=r,u.normalized=a,u.stride=s,u.offset=o,u.recache(),n.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas&&r.canvas.addEventListener&&r.canvas.addEventListener("webglcontextrestored",function(){var e;e="OESVertexArrayObject emulation library context restored",t.console&&t.console.log&&t.console.log(e),i.reset_()},!0),this.reset_()};i.prototype.VERTEX_ARRAY_BINDING_OES=34229,i.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new r(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},i.prototype.createVertexArrayOES=function(){var t=new r(this);return this.vertexArrayObjects.push(t),t},i.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},i.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof r&&t.hasBeenBound&&t.ext==this)},i.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(!t||t.isAlive){var r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var n=this.currentVertexArrayObject;if(i!=n){i&&n.elementArrayBuffer==i.elementArrayBuffer||r.bindBuffer.call(e,e.ELEMENT_ARRAY_BUFFER,n.elementArrayBuffer);for(var a=this.currentArrayBuffer,s=Math.max(i?i.maxAttrib:0,n.maxAttrib),o=0;o<=s;o++){var h=n.attribs[o],u=i?i.attribs[o]:null;if(i&&h.enabled==u.enabled||(h.enabled?r.enableVertexAttribArray.call(e,o):r.disableVertexAttribArray.call(e,o)),h.enabled){var l=!1;i&&h.buffer==u.buffer||(a!=h.buffer&&(r.bindBuffer.call(e,e.ARRAY_BUFFER,h.buffer),a=h.buffer),l=!0),(l||h.cached!=u.cached)&&r.vertexAttribPointer.call(e,o,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!=a&&r.bindBuffer.call(e,e.ARRAY_BUFFER,this.currentArrayBuffer)}}else synthesizeGLError(e.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},t._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var r=t.getExtension;t.getExtension=function(t){var e=r.call(this,t);return e||("OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new i(this)),this.__OESVertexArrayObject))}},t._forceSetupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var r=t.getExtension;t.getExtension=function(t){if("OES_vertex_array_object"===t)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new i(this)),this.__OESVertexArrayObject;var e=r.call(this,t);return e||null}}}()),function(){function ShaderCompile(t,e,r,i){this._clearCR=new RegExp("\r","g");var n=this;function _compile(t){t=t.replace(n._clearCR,"");var e=[],r=new xt(e);return n._compileToTree(r,t.split("\n"),0,e,i),r}var a=h.now();this._VS=_compile(t),this._PS=_compile(e),this._nameMap=r,h.now()-a>2&&console.log("ShaderCompile use time:"+(h.now()-a)+"  size:"+t.length+"/"+e.length)}n(ShaderCompile,"laya.webgl.utils.ShaderCompile");var t=ShaderCompile.prototype;return t._compileToTree=function(t,e,r,i,n){var a,s,o,h,u,l,c,_=0,d=0,f=0,x=0;for(d=r;d<e.length;d++)if(!((o=e[d]).length<1)&&0!==(_=o.indexOf("//"))){if(_>=0&&(o=o.substr(0,_)),a=c||new xt(i),c=null,a.text=o,a.noCompile=!0,(_=o.indexOf("#"))>=0){for(h="#",x=_+1,f=o.length;x<f;x++){var p=o.charAt(x);if(" "===p||"\t"===p||"?"===p)break;h+=p}switch(a.name=h,h){case"#ifdef":case"#ifndef":if(a.src=o,a.noCompile=null!=o.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+o.substr(_+a.name.length)+"}"):(l=o.replace(/^\s*/,"").split(/\s+/),a.setCondition(l[1],"#ifdef"===h?1:2),a.text="//"+a.text),a.setParent(t),t=a,n)for(l=o.substr(x).split(ShaderCompile._splitToWordExps3),x=0;x<l.length;x++)(o=l[x]).length&&(n[o]=!0);continue;case"#if":if(a.src=o,a.noCompile=!0,a.setParent(t),t=a,n)for(l=o.substr(x).split(ShaderCompile._splitToWordExps3),x=0;x<l.length;x++)(o=l[x]).length&&"defined"!=o&&(n[o]=!0);continue;case"#else":a.src=o,s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.condition=s.condition,a.conditionType=1==s.conditionType?2:1,a.text="//"+a.text+" "+s.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":l=ShaderCompile.splitToWords(o,null);var b=ShaderCompile.includes[l[1]];if(!b)throw"ShaderCompile error no this include file:"+l[1];if((_=l[0].indexOf("?"))<0){a.setParent(t),o=b.getWith("with"==l[2]?l[3]:null),this._compileToTree(a,o.split("\n"),0,i,n),a.text="";continue}a.setCondition(l[0].substr(_+1),1),a.text=b.getWith("with"==l[2]?l[3]:null);break;case"#import":u=(l=ShaderCompile.splitToWords(o,null))[1],i.push({node:a,file:ShaderCompile.includes[u],ofs:a.text.length});continue}}else{if((s=t.childs[t.childs.length-1])&&!s.name){i.length>0&&ShaderCompile.splitToWords(o,s),c=a,s.text+="\n"+o;continue}i.length>0&&ShaderCompile.splitToWords(o,a)}a.setParent(t)}},t.createShader=function(t,e,r,i){var n={},a="";if(t)for(var s in t)a+="#define "+s+"\n",n[s]=!0;var o=this._VS.toscript(n,[]),h=this._PS.toscript(n,[]);return(r||Pt.create)(a+o.join("\n"),a+h.join("\n"),e,this._nameMap,i)},ShaderCompile._parseOne=function(t,e,r,i,n,a){var s={type:ShaderCompile.shaderParamsMap[r[i+1]],name:r[i+2],size:isNaN(parseInt(r[i+3]))?1:parseInt(r[i+3])};return a&&("attribute"==n?t.push(s):e.push(s)),":"==r[i+3]&&(s.type=r[i+4],i+=2),i+=2},ShaderCompile.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(ShaderCompile.includes[t])throw new Error("add shader include file err, has add:"+t);ShaderCompile.includes[t]=new nt(e)},ShaderCompile.preGetParams=function(t,e){var r=[t,e],i={},n=[],a=[],s={},o=[];i.attributes=n,i.uniforms=a,i.defines=s;for(var h=0,u=0,l=0;l<2;l++){r[l]=r[l].replace(ShaderCompile._removeAnnotation,"");var c,_=r[l].match(ShaderCompile._reg);for(h=0,u=_.length;h<u;h++){var d=_[h];if("attribute"==d||"uniform"==d)h=ShaderCompile._parseOne(n,a,_,h,d,!0);else{if("#define"==d){o[d=_[++h]]=1;continue}if("#ifdef"==d){s[c=_[++h]]=s[c]||[];for(h++;h<u;h++)if("attribute"==(d=_[h])||"uniform"==d)h=ShaderCompile._parseOne(n,a,_,h,d,o[c]);else if("#else"==d)for(h++;h<u;h++)if("attribute"==(d=_[h])||"uniform"==d)h=ShaderCompile._parseOne(n,a,_,h,d,!o[c]);else if("#endif"==d)break}}}}return i},ShaderCompile.splitToWords=function(t,e){for(var r,i,n=[],a=-1,s=0,o=t.length;s<o;s++)if(r=t.charAt(s)," \t=+-*/&%!<>()'\",;".indexOf(r)>=0){if(a>=0&&s-a>1&&(i=t.substr(a,s-a),n.push(i)),'"'==r||"'"==r){var h=t.indexOf(r,s+1);if(h<0)throw"Sharder err:"+t;n.push(t.substr(s+1,h-s-1)),s=h,a=-1;continue}"("==r&&e&&n.length>0&&(i=n[n.length-1]+";","vec4;main;".indexOf(i)<0&&(e.useFuns+=i)),a=-1}else a<0&&(a=s);return a<o&&o-a>1&&(i=t.substr(a,o-a),n.push(i)),n},ShaderCompile.IFDEF_NO=0,ShaderCompile.IFDEF_YES=1,ShaderCompile.IFDEF_ELSE=2,ShaderCompile.IFDEF_PARENT=3,ShaderCompile._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),ShaderCompile._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),ShaderCompile._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),ShaderCompile.includes={},i(ShaderCompile,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),ShaderCompile}()),F=function(){function Mesh2D(t,e,r){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new Gt(t,35048),e?this._vb._resizeBuffer(e,!1):l.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new Wt,r&&this._ib._resizeBuffer(r,!1)}n(Mesh2D,"laya.webgl.utils.Mesh2D");var t=Mesh2D.prototype;return t.cloneWithNewVB=function(){var t=new Mesh2D(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new Mesh2D(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),r=0,i=0,n=0;n<t;n++)e[r++]=i,e[r++]=i+2,e[r++]=i+1,e[r++]=i,e[r++]=i+3,e[r++]=i+2,i+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.configVAO=function(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=new Dt),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,r=0,i=0;i<e;i++){var n=this._attribInfo[r+1],a=this._attribInfo[r],s=this._attribInfo[r+2];t.enableVertexAttribArray(i),t.vertexAttribPointer(i,n,a,!1,this._stride,s),r+=3}this._vao.unBind()}},t.useMesh=function(t){this._applied||this.configVAO(t),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},Mesh2D._gvaoid=0,Mesh2D}(),V=function(){function LayaGL(){}n(LayaGL,"laya.layagl.LayaGL");var t=LayaGL.prototype;return t.createCommandEncoder=function(t,e,r){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===r&&(r=!1),new H(this,t,e,r)},t.beginCommandEncoding=function(t){},t.endCommandEncoding=function(){},t.matrix4x4Multiply=function(t,e,r){},t.evaluateClipDatasRealTime=function(t,e,r,i){},LayaGL.getFrameCount=function(){return 0},LayaGL.syncBufferToRenderThread=function(t,e){void 0===e&&(e=0)},LayaGL.createArrayBufferRef=function(t,e,r){},LayaGL.createArrayBufferRefs=function(t,e,r,i){},LayaGL.EXECUTE_JS_THREAD_BUFFER=0,LayaGL.EXECUTE_RENDER_THREAD_BUFFER=1,LayaGL.EXECUTE_COPY_TO_RENDER=2,LayaGL.EXECUTE_COPY_TO_RENDER3D=3,LayaGL.ARRAY_BUFFER_TYPE_DATA=0,LayaGL.ARRAY_BUFFER_TYPE_CMD=1,LayaGL.ARRAY_BUFFER_REF_REFERENCE=0,LayaGL.ARRAY_BUFFER_REF_COPY=1,LayaGL.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,LayaGL.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1,LayaGL.instance=null,LayaGL}(),U=(function(){function WebGLCacheAsNormalCanvas(t,e){this.submitStartPos=0,this.submitEndPos=0,this.context=null,this.touches=[],this.submits=[],this.sprite=null,this._mesh=null,this._pathMesh=null,this._triangleMesh=null,this.meshlist=[],this._oldMesh=null,this._oldPathMesh=null,this._oldTriMesh=null,this._oldMeshList=null,this.oldTx=0,this.oldTy=0,this.cachedClipInfo=new p,this.invMat=new p,this.context=t,this.sprite=e,t._globalClipMatrix.copyTo(this.cachedClipInfo)}n(WebGLCacheAsNormalCanvas,"laya.webgl.canvas.WebGLCacheAsNormalCanvas");var t=WebGLCacheAsNormalCanvas.prototype;t.startRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context)),this.touches.length=0,this.context.touches=this.touches,this.context._globalClipMatrix.copyTo(this.cachedClipInfo),this.submits.length=0,this.submitStartPos=this.context._submits._length;for(var t=0,e=this.meshlist.length;t<e;t++){var r=this.meshlist[t];r.canReuse?r.releaseMesh():r.destroy()}this.meshlist.length=0,this._mesh=Mt.getAMesh(),this._pathMesh=Lt.getAMesh(),this._triangleMesh=yt.getAMesh(),this.meshlist.push(this._mesh),this.meshlist.push(this._pathMesh),this.meshlist.push(this._triangleMesh),this.context._curSubmit=P.RENDERBASE,this._oldMesh=this.context._mesh,this._oldPathMesh=this.context._pathMesh,this._oldTriMesh=this.context._triangleMesh,this._oldMeshList=this.context.meshlist,this.context._mesh=this._mesh,this.context._pathMesh=this._pathMesh,this.context._triangleMesh=this._triangleMesh,this.context.meshlist=this.meshlist,this.oldTx=this.context._curMat.tx,this.oldTy=this.context._curMat.ty,this.context._curMat.tx=0,this.context._curMat.ty=0,this.context._curMat.copyTo(this.invMat),this.invMat.invert()},t.endRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));var t=this.context._submits;this.submitEndPos=t._length;for(var e=this.submitEndPos-this.submitStartPos,r=0;r<e;r++)this.submits.push(t[this.submitStartPos+r]);t._length-=e,this.context._mesh=this._oldMesh,this.context._pathMesh=this._oldPathMesh,this.context._triangleMesh=this._oldTriMesh,this.context.meshlist=this._oldMeshList,this.context._curSubmit=P.RENDERBASE,this.context._curMat.tx=this.oldTx,this.context._curMat.ty=this.oldTy,this.context.touches=null},t.isCacheValid=function(){var t=this.context._globalClipMatrix;return t.a==this.cachedClipInfo.a&&t.b==this.cachedClipInfo.b&&t.c==this.cachedClipInfo.c&&t.d==this.cachedClipInfo.d&&t.tx==this.cachedClipInfo.tx&&t.ty==this.cachedClipInfo.ty},t.flushsubmit=function(){var t=P.RENDERBASE;this.submits.forEach(function(e){e!=P.RENDERBASE&&(P.preRender=t,t=e,e.renderSubmit())})},t.releaseMem=function(){},i(WebGLCacheAsNormalCanvas,["matI",function(){return this.matI=new p}])}(),function(){function ConchPropertyAdpt(){}return n(ConchPropertyAdpt,"laya.layagl.ConchPropertyAdpt"),ConchPropertyAdpt.rewriteProperties=function(){laya.layagl.ConchPropertyAdpt.rewriteNumProperty(m.prototype,"x"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(m.prototype,"y"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(m.prototype,"width"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(m.prototype,"height"),laya.layagl.ConchPropertyAdpt.rewriteFunc(m.prototype,"recover")},ConchPropertyAdpt.rewriteNumProperty=function(t,e){Object.defineProperty(t,e,{get:function(){return this["_"+e]||0},set:function(t){this["_"+e]=t,this.onPropertyChanged&&this.onPropertyChanged(this)}})},ConchPropertyAdpt.rewriteFunc=function(t,e){t["__"+e]=t[e],t[e]=function(){t["__"+e].call(this),this.onPropertyChanged&&(this.onPropertyChanged=null)}},ConchPropertyAdpt}()),k=function(){function BlendMode(){}return n(BlendMode,"laya.webgl.canvas.BlendMode"),BlendMode._init_=function(t){BlendMode.fns=[BlendMode.BlendNormal,BlendMode.BlendAdd,BlendMode.BlendMultiply,BlendMode.BlendScreen,BlendMode.BlendOverlay,BlendMode.BlendLight,BlendMode.BlendMask,BlendMode.BlendDestinationOut],BlendMode.targetFns=[BlendMode.BlendNormalTarget,BlendMode.BlendAddTarget,BlendMode.BlendMultiplyTarget,BlendMode.BlendScreenTarget,BlendMode.BlendOverlayTarget,BlendMode.BlendLightTarget,BlendMode.BlendMask,BlendMode.BlendDestinationOut]},BlendMode.BlendNormal=function(t){ct.setBlendFunc(t,1,771)},BlendMode.BlendAdd=function(t){ct.setBlendFunc(t,1,772)},BlendMode.BlendMultiply=function(t){ct.setBlendFunc(t,774,771)},BlendMode.BlendScreen=function(t){ct.setBlendFunc(t,1,1)},BlendMode.BlendOverlay=function(t){ct.setBlendFunc(t,1,769)},BlendMode.BlendLight=function(t){ct.setBlendFunc(t,1,1)},BlendMode.BlendNormalTarget=function(t){ct.setBlendFunc(t,1,771)},BlendMode.BlendAddTarget=function(t){ct.setBlendFunc(t,1,772)},BlendMode.BlendMultiplyTarget=function(t){ct.setBlendFunc(t,774,771)},BlendMode.BlendScreenTarget=function(t){ct.setBlendFunc(t,1,1)},BlendMode.BlendOverlayTarget=function(t){ct.setBlendFunc(t,1,769)},BlendMode.BlendLightTarget=function(t){ct.setBlendFunc(t,1,1)},BlendMode.BlendMask=function(t){ct.setBlendFunc(t,0,770)},BlendMode.BlendDestinationOut=function(t){ct.setBlendFunc(t,0,0)},BlendMode.activeBlendFunction=null,BlendMode.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],BlendMode.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},BlendMode.NORMAL="normal",BlendMode.ADD="add",BlendMode.MULTIPLY="multiply",BlendMode.SCREEN="screen",BlendMode.OVERLAY="overlay",BlendMode.LIGHT="light",BlendMode.MASK="mask",BlendMode.DESTINATIONOUT="destination-out",BlendMode.LIGHTER="lighter",BlendMode.fns=[],BlendMode.targetFns=[],BlendMode}(),X=(function(){function QuickTestTool(){this._renderType=0,this._repaint=0,this._x=NaN,this._y=NaN}n(QuickTestTool,"laya.layagl.QuickTestTool");var t=QuickTestTool.prototype;t.render=function(t,e,r){QuickTestTool._addType(this._renderType),QuickTestTool.showRenderTypeInfo(this._renderType),v.renders[this._renderType]._fun(this,t,e+this._x,r+this._y),this._repaint=0},t._stageRender=function(t,e,i){QuickTestTool._countStart(),QuickTestTool._PreStageRender.call(r.stage,t,e,i),QuickTestTool._countEnd()},QuickTestTool.getMCDName=function(t){return QuickTestTool._typeToNameDic[t]},QuickTestTool.showRenderTypeInfo=function(t,e){if(void 0===e&&(e=!1),e||!QuickTestTool.showedDic[t]){if(QuickTestTool.showedDic[t]=!0,!QuickTestTool._rendertypeToStrDic[t]){var r=[],i=0;for(i=1;i<=t;)i&t&&r.push(QuickTestTool.getMCDName(i&t)),i<<=1;QuickTestTool._rendertypeToStrDic[t]=r.join(",")}console.log("cmd:",QuickTestTool._rendertypeToStrDic[t])}},QuickTestTool.__init__=function(){QuickTestTool._typeToNameDic[1]="ALPHA",QuickTestTool._typeToNameDic[2]="TRANSFORM",QuickTestTool._typeToNameDic[256]="TEXTURE",QuickTestTool._typeToNameDic[512]="GRAPHICS",QuickTestTool._typeToNameDic[4096]="ONECHILD",QuickTestTool._typeToNameDic[8192]="CHILDS",QuickTestTool._typeToNameDic[3]="TRANSFORM|ALPHA",QuickTestTool._typeToNameDic[8]="CANVAS",QuickTestTool._typeToNameDic[4]="BLEND",QuickTestTool._typeToNameDic[16]="FILTERS",QuickTestTool._typeToNameDic[32]="MASK",QuickTestTool._typeToNameDic[64]="CLIP",QuickTestTool._typeToNameDic[1024]="LAYAGL3D"},QuickTestTool._countStart=function(){var t;for(t in QuickTestTool._countDic)QuickTestTool._countDic[t]=0},QuickTestTool._countEnd=function(){QuickTestTool._i++,QuickTestTool._i>60&&(QuickTestTool.showCountInfo(),QuickTestTool._i=0)},QuickTestTool._addType=function(t){QuickTestTool._countDic[t]?QuickTestTool._countDic[t]+=1:QuickTestTool._countDic[t]=1},QuickTestTool.showCountInfo=function(){var t;for(t in console.log("==================="),QuickTestTool._countDic)console.log("count:"+QuickTestTool._countDic[t]),QuickTestTool.showRenderTypeInfo(t,!0)},QuickTestTool.enableQuickTest=function(){QuickTestTool.__init__(),y.prototype.render=QuickTestTool.prototype.render,QuickTestTool._PreStageRender=S.prototype.render,S.prototype.render=QuickTestTool.prototype._stageRender},QuickTestTool.showedDic={},QuickTestTool._rendertypeToStrDic={},QuickTestTool._typeToNameDic={},QuickTestTool._PreStageRender=null,QuickTestTool._countDic={},QuickTestTool._i=0}(),function(){function SubmitTarget(){this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this._ref=1,this.srcRT=null,this._key=new tt}n(SubmitTarget,"laya.webgl.submit.SubmitTarget");var t=SubmitTarget.prototype;return r.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){var t=$.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),R.renderBatch++,R.trianglesFaces+=this._numEle/3,$.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(k.activeBlendFunction!==k.fns[this.blendType]){var t=$.mainContext;t.enable(3042),k.fns[this.blendType](t),k.activeBlendFunction=k.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){if(--this._ref<1){var t=SubmitTarget.POOL;t[t._length++]=this}},t.reUse=function(t,e){return this._startIdx=e,this._ref++,e},SubmitTarget.create=function(t,e,r,i){var n=SubmitTarget.POOL._length?SubmitTarget.POOL[--SubmitTarget.POOL._length]:new SubmitTarget;if(n._mesh=e,n.srcRT=i,n._startIdx=e.indexNum*O.BYTES_PIDX,n._ref=1,n._key.clear(),n._numEle=0,n.blendType=t._nBlendType,n._key.blendShader=n.blendType,n.shaderValue=r,n.shaderValue.setValue(t._shader2D),t._colorFiler){var a=t._colorFiler;r.defines.add(a.type),r.colorMat=a._mat,r.colorAlpha=a._alpha}return n},SubmitTarget.POOL=(SubmitTarget.POOL=[],SubmitTarget.POOL._length=0,SubmitTarget.POOL),SubmitTarget}()),H=function(){function CommandEncoder(t,e,r,i){this._idata=[]}n(CommandEncoder,"laya.layagl.CommandEncoder");var t=CommandEncoder.prototype;return t.getArrayData=function(){return this._idata},t.getPtrID=function(){return 0},t.beginEncoding=function(){},t.endEncoding=function(){},t.clearEncoding=function(){this._idata.length=0},t.getCount=function(){return this._idata.length},t.add_ShaderValue=function(t){this._idata.push(t)},t.addShaderUniform=function(t){this.add_ShaderValue(t)},CommandEncoder}(),z=function(){function ICharRender(){}n(ICharRender,"laya.webgl.resource.ICharRender");var t=ICharRender.prototype;return t.getWidth=function(t,e){return 0},t.scale=function(t,e){},t.getCharBmp=function(t,e,r,i,n,a,s,o,h,u,l){return null},a(0,t,"canvasWidth",function(){return 0},function(t){}),ICharRender}(),Y=function(){function CharRenderInfo(){this.char="",this.tex=null,this.deleted=!1,this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.orix=0,this.oriy=0,this.touchTick=0,this.isSpace=!1,this.uv=new Array(8)}return n(CharRenderInfo,"laya.webgl.resource.CharRenderInfo"),CharRenderInfo.prototype.touch=function(){var t=R.loopCount;this.touchTick!=t&&this.tex.touchRect(this,t),this.touchTick=t},CharRenderInfo}(),Q=function(){function BasePoly(){}return n(BasePoly,"laya.webgl.shapes.BasePoly"),BasePoly.createLine2=function(t,e,r,i,n,a){if(t.length<4)return null;var s=BasePoly.tempData.length>t.length+2?BasePoly.tempData:new Array(t.length+2);s[0]=t[0],s[1]=t[1];var o=2,h=0,u=t.length;for(h=2;h<u;h+=2)Math.abs(t[h]-t[h-2])+Math.abs(t[h+1]-t[h-1])>.01&&(s[o++]=t[h],s[o++]=t[h+1]);a&&Math.abs(t[0]-s[o-2])+Math.abs(t[1]-s[o-1])>.01&&(s[o++]=t[0],s[o++]=t[1]);var l=n;u=o/2;var c,_,d,f,x,p,b,m,T,v,C,g,y,S,R,E,A,M,L,D,w=r/2;d=s[0],f=s[1],v=d-(x=s[2]);T=(T=-(f-(p=s[3])))/(D=Math.sqrt(T*T+v*v))*w,v=v/D*w;for(l.push(d-T,f-v,d+T,f+v),h=1;h<u-1;h++)d=s[2*(h-1)],f=s[2*(h-1)+1],x=s[2*h],p=s[2*h+1],b=s[2*(h+1)],m=s[2*(h+1)+1],v=d-x,g=x-b,R=(-(T=(T=-(f-p))/(D=Math.sqrt(T*T+v*v))*w)+d)*(-(v=v/D*w)+p)-(-T+x)*(-v+f),M=(-(C=(C=-(p-m))/(D=Math.sqrt(C*C+g*g))*w)+b)*(-(g=g/D*w)+p)-(-C+x)*(-g+m),L=(y=-v+f-(-v+p))*(A=-C+x-(-C+b))-(E=-g+m-(-g+p))*(S=-T+x-(-T+d)),Math.abs(L)<.1?(L+=10.1,l.push(x-T,p-v,x+T,p+v)):(((c=(S*M-A*R)/L)-x)*(c-x)+((_=(E*R-y*M)/L)-p)+(_-p),l.push(c,_,x-(c-x),p-(_-p)));for(d=s[o-4],f=s[o-3],v=d-(x=s[o-2]),T=(T=-(f-(p=s[o-1])))/(D=Math.sqrt(T*T+v*v))*w,v=v/D*w,l.push(x-T,p-v,x+T,p+v),h=1;h<u;h++)e.push(i+2*(h-1),i+2*(h-1)+1,i+2*h+1,i+2*h+1,i+2*h,i+2*(h-1));return l},BasePoly.createLineTriangle=function(t,e,r,i,n,a,s){var o=t.slice(),h=o.length,u=o[0],l=o[1],c=o[2],_=(o[2],0),d=0,f=0,x=0,p=h/2;if(!(p<=1)&&2!=p){for(var b=new Array(4*p),m=0,T=0,v=0;v<p-1;v++)u=o[T++],l=o[T++],c=o[T++],x=o[T++]-l,0!=(f=c-u)&&0!=x&&(_=Math.sqrt(f*f+x*x))>.001&&(b[d=4*m]=u,b[d+1]=l,b[d+2]=f/_,b[d+3]=x/_,m++);for(i?(u=o[h-2],l=o[h-1],c=o[0],x=o[1]-l,0!=(f=c-u)&&0!=x&&(_=Math.sqrt(f*f+x*x))>.001&&(b[d=4*m]=u,b[d+1]=l,b[d+2]=f/_,b[d+3]=x/_,m++)):(b[d=4*m]=u,b[d+1]=l,b[d+2]=f/_,b[d+3]=x/_,m++),T=0,v=0;v<p;v++){u=o[T],l=o[T+1],c=o[T+2],o[T+3];o[T+4],o[T+5]}}},i(BasePoly,["tempData",function(){return this.tempData=new Array(256)}]),BasePoly}(),j=function(){function SaveMark(){this._saveuse=0}n(SaveMark,"laya.webgl.canvas.save.SaveMark");var t=SaveMark.prototype;return r.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,SaveMark.POOL[SaveMark.POOL._length++]=this},SaveMark.Create=function(t){var e=SaveMark.POOL,r=e._length>0?e[--e._length]:new SaveMark;return r._saveuse=0,r._preSaveMark=t._saveMark,t._saveMark=r,r},SaveMark.POOL=D._createArray(),SaveMark}(),K=function(){function TextAtlas(){this.texWidth=1024,this.texHeight=1024,this.atlasgrid=null,this.protectDist=1,this.texture=null,this.charMaps={},this.texHeight=this.texWidth=lt.atlasWidth,this.texture=Bt.getTextTexture(this.texWidth,this.texHeight),this.texWidth/TextAtlas.atlasGridW>256&&(TextAtlas.atlasGridW=Math.ceil(this.texWidth/256)),this.atlasgrid=new et(this.texWidth/TextAtlas.atlasGridW,this.texHeight/TextAtlas.atlasGridW,this.texture.id)}n(TextAtlas,"laya.webgl.text.TextAtlas");var t=TextAtlas.prototype;return t.setProtecteDist=function(t){this.protectDist=t},t.getAEmpty=function(t,e,r){var i=this.atlasgrid.addRect(1,Math.ceil(t/TextAtlas.atlasGridW),Math.ceil(e/TextAtlas.atlasGridW),r);return i&&(r.x*=TextAtlas.atlasGridW,r.y*=TextAtlas.atlasGridW),i},t.destroy=function(){for(var t in this.charMaps){this.charMaps[t].deleted=!0}this.texture.discard()},t.printDebugInfo=function(){},a(0,t,"usedRate",function(){return this.atlasgrid._used}),TextAtlas.atlasGridW=16,TextAtlas}(),Z=function(){function LayaGLRunner(){}return n(LayaGLRunner,"laya.layagl.LayaGLRunner"),LayaGLRunner.uploadShaderUniforms=function(t,e,r,i){for(var n=r._data,a=e.getArrayData(),s=0,o=0,h=a.length;o<h;o++){var u=a[o];if(i||-1!==u.textureID){var l=n[u.dataOffset];null!=l&&(s+=u.fun.call(u.caller,u,l))}}return s},LayaGLRunner.uploadCustomUniform=function(t,e,r,i){var n=0,a=e[r];return a&&null!=i&&(n+=a.fun.call(a.caller,a,i)),n},LayaGLRunner.uploadShaderUniformsForNative=function(t,e,r){var i=0;r._runtimeCopyValues.length>0&&(i=1);var n=r._data;return t.uploadShaderUniforms(e,n,i)},LayaGLRunner}(),q=function(){function BufferStateBase(){this._nativeVertexArrayObject=null,this._bindedIndexBuffer=null,this._nativeVertexArrayObject=V.instance.createVertexArray()}n(BufferStateBase,"laya.webgl.BufferStateBase");var t=BufferStateBase.prototype;return t.bind=function(){BufferStateBase._curBindedBufferState!==this&&(V.instance.bindVertexArray(this._nativeVertexArrayObject),BufferStateBase._curBindedBufferState=this)},t.unBind=function(){if(BufferStateBase._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";V.instance.bindVertexArray(null),BufferStateBase._curBindedBufferState=null},t.bindForNative=function(){V.instance.bindVertexArray(this._nativeVertexArrayObject),BufferStateBase._curBindedBufferState=this},t.unBindForNative=function(){V.instance.bindVertexArray(null),BufferStateBase._curBindedBufferState=null},t.destroy=function(){V.instance.deleteVertexArray(this._nativeVertexArrayObject)},BufferStateBase._curBindedBufferState=null,BufferStateBase}(),$=function(){function WebGL(){}return n(WebGL,"laya.webgl.WebGL"),WebGL._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),r=0;r<t;r++)e[r]=this[r];return e},WebGL._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),r=0;r<t;r++)e[r]=this[r];return e},WebGL._uint16ArraySlice=function(t){var e,r=arguments,i=0,n=0;if(0===r.length)for(i=this.length,e=new Uint16Array(i),n=0;n<i;n++)e[n]=this[n];else if(2===r.length){var a=r[0],s=r[1];if(s>a)for(i=s-a,e=new Uint16Array(i),n=a;n<s;n++)e[n-a]=this[n];else e=new Uint16Array(0)}return e},WebGL._nativeRender_enable=function(){WebGL.isNativeRender_enable||(WebGL.isNativeRender_enable=!0,x.create=function(t,e){var r=new Nt(t,e,1,!1,!1);return r.wrapModeU=1,r.wrapModeV=1,r},ct.__init_native(),Pt.prototype.uploadTexture2D=function(t){var e=ct;e.bindTexture(laya.webgl.WebGL.mainContext,e.TEXTURE_2D,t)},ot.width=h.window.innerWidth,ot.height=h.window.innerHeight,g.measureText=function(e,r){return t.conchTextCanvas.font=r,t.conchTextCanvas.measureText(e)},g.enableNative=function(){T.supportWebGLPlusRendering&&(Z.uploadShaderUniforms=Z.uploadShaderUniformsForNative,H=t.GLCommandEncoder,V=t.LayaGLContext);var e=S;e.prototype.render=e.prototype.renderToNative,T.isConchApp&&U.rewriteProperties()},g.clear=function(t){var e=u.create(t).arrColor,r=V.instance;e&&r.clearColor(e[0],e[1],e[2],e[3]),r.clear(17664)},g.drawToCanvas=function(t,e,r,i,n,a){n-=t.x,a-=t.y,n|=0,a|=0,r|=0,i|=0;var s=new f(!1),o=s.getContext("2d");return s.size(r,i),o.asBitmap=!0,o._targets.start(),v.renders[e]._fun(t,o,n,a),o.flush(),o._targets.end(),o._targets.restore(),s},Ot.prototype.getData=function(t,e,r,i,n){var a=V.instance;a.bindFramebuffer(36160,this._frameBuffer),a.readPixelsAsync(t,e,r,i,6408,5121,function(t){n(t)}),a.bindFramebuffer(36160,null)},Ot.prototype._uv=Ot.flipyuv,Object.defineProperty(Ot.prototype,"uv",{get:function(){return this._uv},set:function(t){this._uv=t}}),f.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=Ot.flipyuv,this._texture.bitmap=this._texture),this._texture})},WebGL._webglRender_enable=function(){T.isWebGL||(T.isWebGL=!0,g.initRender=function(t,e,r){var i=V.instance=laya.webgl.WebGL.mainContext=function(t){var e,r=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];l.useWebGL2||r.shift();for(var i=0;i<r.length;i++){try{e=t.getContext(r[i],{stencil:l.isStencil,alpha:l.isAlpha,antialias:l.isAntialias,premultipliedAlpha:l.premultipliedAlpha,preserveDrawingBuffer:l.preserveDrawingBuffer})}catch(t){}if(e)return"webgl2"===r[i]&&(laya.webgl.WebGL._isWebGL2=!0),new V,e}return null}(T._mainCanvas.source);if(!i)return!1;t.size(e,r),ct.__init__(i),bt.__init__(),P.__init__();var n=new bt;T._context=n,t._setContext(n),laya.webgl.WebGL.shaderHighPrecision=!1;try{i.getShaderPrecisionFormat(35632,36338).precision?WebGL.shaderHighPrecision=!0:WebGL.shaderHighPrecision=!1}catch(t){}return V.instance=i,A.__init__(),At.__init__(),w.__init__(),B.__init__(),Ct.__int__(i),k._init_(i),!0},x.create=function(t,e,r){var i=new Nt(t,e,r,!1,!1);return i.wrapModeU=1,i.wrapModeV=1,i},g.createRenderSprite=function(t,e){return new pt(t,e)},g.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},g.clear=function(t){bt.set2DRenderConfig(),ot.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=T.context,i=0==e._submits._length||l.preserveDrawingBuffer?u.create(t).arrColor:r.stage._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),ot.clear()},g.drawToCanvas=function(t,e,r,i,n,a){n-=t.x,a-=t.y,n|=0,a|=0,r|=0,i|=0;var s=new bt;s.size(r,i),s.asBitmap=!0,s._targets.start(),v.renders[e]._fun(t,s,n,a),s.flush(),s._targets.end(),s._targets.restore();var o=s._targets.getData(0,0,r,i);s.destroy();for(var h=new ImageData(r,i),u=4*r,l=(new Uint8Array(u),h.data),c=i-1,_=c*u,d=0;c>=0;c--)l.set(o.subarray(d,d+u),_),_-=u,d+=u;var x=new f(!0);return x.size(r,i),x.getContext("2d").putImageData(h,0,0),x},g.getTexturePixels=function(t,e,r,i,n){var a=0,s=0,o=0,h=t.bitmap,u=h.width,l=h.height;if(e+i>u&&(i-=e+i-u),r+n>l&&(n-=r+n-l),i<=0||n<=0)return null;var c=4*i,_=null;try{_=h.getPixels()}catch(t){}if(_){if(0==e&&0==r&&i==u&&n==l)return _;var d=new Uint8Array(i*n*4);for(a=4*e,s=(r+n-1)*(c=4*u)+4*e,o=n-1;o>=0;o--)d.set(v.slice(s,s+4*i),a),a+=c,s-=c;return d}var f=new bt;f.size(i,n),f.asBitmap=!0;var x=null;if(0!=e||0!=r||i!=u||n!=l){var p=(x=t.uv.concat())[0],b=x[1],m=(x[2]-p)/u,T=(x[7]-b)/l;x=[p+e*m,b+r*T,p+(e+i)*m,b+r*T,p+(e+i)*m,b+(r+n)*T,p+e*m,b+(r+n)*T]}f._drawTextureM(t,0,0,i,n,null,1,x),f._targets.start(),f.flush(),f._targets.end(),f._targets.restore();var v=f._targets.getData(0,0,i,n);for(f.destroy(),d=new Uint8Array(i*n*4),a=0,s=(n-1)*c,o=n-1;o>=0;o--)d.set(v.slice(s,s+c),a),a+=c,s-=c;return d},_._filter=function(t,e,r,i){var n=e,a=this._next;if(a){var s=t.filters,o=s.length;if(1==o&&32==s[0].type)return e.save(),e.setColorFilter(s[0]),a._fun.call(a,t,e,r,i),void e.restore();var h,u=w.create(1,0),l=b.TEMP,c=n._curMat,_=p.create();c.copyTo(_);var d=0,f=0,x=null,T=t._cacheStyle.filterCache||null;if(T&&0==t.getRepaint()){if((t._cacheStyle.hasGlowFilter||!1)&&(d=50,f=25),(h=t.getBounds()).width<=0||h.height<=0)return;h.width+=d,h.height+=d,l.x=h.x*_.a+h.y*_.c,l.y=h.y*_.d+h.x*_.b,h.x=l.x,h.y=l.y,l.x=h.width*_.a+h.height*_.c,l.y=h.height*_.d+h.width*_.b,h.width=l.x,h.height=l.y}else{t._isHaveGlowFilter()&&(d=50,f=25),(h=new m).copyFrom(t.getSelfBounds()),h.x+=t.x,h.y+=t.y,h.x-=t.pivotX+4,h.y-=t.pivotY+4;var v=h.x,C=h.y;if(h.width+=d+8,h.height+=d+8,l.x=h.x*_.a+h.y*_.c,l.y=h.y*_.d+h.x*_.b,h.x=l.x,h.y=l.y,l.x=h.width*_.a+h.height*_.c,l.y=h.height*_.d+h.width*_.b,h.width=l.x,h.height=l.y,h.width<=0||h.height<=0)return;T&&at.releaseRT(T),x=at.getRT(h.width,h.height);var g=T=at.getRT(h.width,h.height);t._getCacheStyle().filterCache=T,n.pushRT(),n.useRT(x);var y=t.x-v+f,S=t.y-C+f;a._fun.call(a,t,e,y,S),n.useRT(g);for(var R=0;R<o;R++){0!=R&&(n.useRT(x),n.drawTarget(g,0,0,h.width,h.height,p.TEMP.identity(),u,null,k.TOINT.overlay),n.useRT(g));var E=s[R];switch(E.type){case 16:case 8:E._glRender&&E._glRender.render(x,e,h.width,h.height,E);break;case 32:n.setColorFilter(E),n.drawTarget(x,0,0,h.width,h.height,p.EMPTY.identity(),w.create(1,0)),n.setColorFilter(null)}}n.popRT()}if(r=r-f-t.x,i=i-f-t.y,l.setTo(r,i),_.transformPoint(l),r=l.x+h.x,i=l.y+h.y,n._drawRenderTexture(T,r,i,h.width,h.height,p.TEMP.identity(),1,Ot.defuv),x){var A=it.create([x],function(t){t.destroy()},this);x=null,e.addRenderObject(A)}_.destroy()}},f.prototype.getTexture=function(){if(!this._texture){var t=new Nt;t.loadImageSource(this.source),this._texture=new M(t)}return this._texture},Float32Array.prototype.slice||(Float32Array.prototype.slice=WebGL._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=WebGL._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=WebGL._uint8ArraySlice))},WebGL.enable=function(){return h.__init__(),!!h._supportWebGL&&(WebGL._webglRender_enable(),T.isConchApp&&WebGL._nativeRender_enable(),!0)},WebGL.onStageResize=function(t,e){null!=WebGL.mainContext&&(WebGL.mainContext.viewport(0,0,t,e),ot.width=t,ot.height=e)},WebGL.mainContext=null,WebGL.shaderHighPrecision=!1,WebGL._isWebGL2=!1,WebGL.isNativeRender_enable=!1,WebGL}(),J=function(){function SkinMeshBuffer(){this.ib=null,this.vb=null;$.mainContext;this.ib=Wt.create(35048),this.vb=Gt.create(8)}n(SkinMeshBuffer,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var t=SkinMeshBuffer.prototype;return t.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},t.reset=function(){this.vb.clear(),this.ib.clear()},SkinMeshBuffer.getInstance=function(){return SkinMeshBuffer.instance=SkinMeshBuffer.instance||new SkinMeshBuffer},SkinMeshBuffer.instance=null,SkinMeshBuffer}(),tt=function(){function SubmitKey(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}n(SubmitKey,"laya.webgl.submit.SubmitKey");var t=SubmitKey.prototype;return t.clear=function(){this.submitType=-1,this.blendShader=this.other=0},t.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},t.copyFrom2=function(t,e,r){this.other=r,this.submitType=e},t.equal3_2=function(t,e,r){return this.submitType===e&&this.other===r&&this.blendShader===t.blendShader},t.equal4_2=function(t,e,r){return this.submitType===e&&this.other===r&&this.blendShader===t.blendShader},t.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},t.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},SubmitKey}(),et=function(){function AtlasGrid(t,e,r){this.atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._used=0,void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this._cells=null,this._rowInfo=null,this.atlasID=r,this._init(t,e)}n(AtlasGrid,"laya.webgl.text.AtlasGrid");var t=AtlasGrid.prototype;return t.addRect=function(t,e,r,i){return!!this._get(e,r,i)&&(this._fill(i.x,i.y,e,r,t),this._texCount++,!0)},t._release=function(){this._cells=null,this._rowInfo=null},t._init=function(t,e){return this._width=t,this._height=e,this._release(),0!=this._width&&(this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=new Uint8Array(this._height),this._used=0,this._clear(),!0)},t._get=function(t,e,r){if(t>this._width||e>this._height)return!1;for(var i=-1,n=-1,a=this._width,s=this._height,o=this._cells,h=0;h<s;h++)if(!(this._rowInfo[h]<t))for(var u=0;u<a;){var l=3*(h*a+u);if(0!=o[l]||o[l+1]<t||o[l+2]<e)u+=o[l+1];else{i=u,n=h;for(var c=0;c<t;c++)if(o[3*c+l+2]<e){i=-1;break}if(!(i<0))return r.x=i,r.y=n,!0;u+=o[l+1]}}return!1},t._fill=function(t,e,r,i,n){var a=this._width,s=this._height;this._check(t+r<=a&&e+i<=s);for(var o=e;o<i+e;++o){this._check(this._rowInfo[o]>=r),this._rowInfo[o]-=r;for(var h=0;h<r;h++){var u=3*(t+o*a+h);this._check(0==this._cells[u]),this._cells[u]=n,this._cells[u+1]=r,this._cells[u+2]=i}}if(t>0)for(o=0;o<i;++o){var l=0;for(h=t-1;h>=0&&0==this._cells[3*((e+o)*a+h)];--h,++l);for(h=l;h>0;--h)this._cells[3*((e+o)*a+t-h)+1]=h,this._check(h>0)}if(e>0)for(h=t;h<t+r;++h){for(l=0,o=e-1;o>=0&&0==this._cells[3*(h+o*a)];--o,l++);for(o=l;o>0;--o)this._cells[3*(h+(e-o)*a)+2]=o,this._check(o>0)}this._used+=r*i/(this._width*this._height)},t._check=function(t){0==t&&console.log("xtexMerger 错误啦")},t._clear=function(){this._texCount=0;for(var t=0;t<this._height;t++)this._rowInfo[t]=this._width;for(var e=0;e<this._height;e++)for(var r=0;r<this._width;r++){var i=3*(e*this._width+r);this._cells[i]=0,this._cells[i+1]=this._width-r,this._cells[i+2]=this._width-e}},AtlasGrid}(),rt=function(){function Earcut(){}return n(Earcut,"laya.webgl.shapes.Earcut"),Earcut.earcut=function(t,e,r){r=r||2;var i,n,a,s,o,h,u,l=e&&e.length,c=l?e[0]*r:t.length,_=Earcut.linkedList(t,0,c,r,!0),d=[];if(!_)return d;if(l&&(_=Earcut.eliminateHoles(t,e,_,r)),t.length>80*r){i=a=t[0],n=s=t[1];for(var f=r;f<c;f+=r)(o=t[f])<i&&(i=o),(h=t[f+1])<n&&(n=h),o>a&&(a=o),h>s&&(s=h);u=0!==(u=Math.max(a-i,s-n))?1/u:0}return Earcut.earcutLinked(_,d,r,i,n,u),d},Earcut.linkedList=function(t,e,r,i,n){var a,s;if(n===Earcut.signedArea(t,e,r,i)>0)for(a=e;a<r;a+=i)s=Earcut.insertNode(a,t[a],t[a+1],s);else for(a=r-i;a>=e;a-=i)s=Earcut.insertNode(a,t[a],t[a+1],s);return s&&Earcut.equals(s,s.next)&&(Earcut.removeNode(s),s=s.next),s},Earcut.filterPoints=function(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!Earcut.equals(i,i.next)&&0!==Earcut.area(i.prev,i,i.next))i=i.next;else{if(Earcut.removeNode(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e},Earcut.earcutLinked=function(t,e,r,i,n,a,s){if(t){!s&&a&&Earcut.indexCurve(t,i,n,a);for(var o,h,u=t;t.prev!==t.next;)if(o=t.prev,h=t.next,a?Earcut.isEarHashed(t,i,n,a):Earcut.isEar(t))e.push(o.i/r),e.push(t.i/r),e.push(h.i/r),Earcut.removeNode(t),t=h.next,u=h.next;else if((t=h)===u){s?1===s?(t=Earcut.cureLocalIntersections(t,e,r),Earcut.earcutLinked(t,e,r,i,n,a,2)):2===s&&Earcut.splitEarcut(t,e,r,i,n,a):Earcut.earcutLinked(Earcut.filterPoints(t,null),e,r,i,n,a,1);break}}},Earcut.isEar=function(t){var e=t.prev,r=t,i=t.next;if(Earcut.area(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Earcut.pointInTriangle(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&Earcut.area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0},Earcut.isEarHashed=function(t,e,r,i){var n=t.prev,a=t,s=t.next;if(Earcut.area(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,h=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,u=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,l=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,c=Earcut.zOrder(o,h,e,r,i),_=Earcut.zOrder(u,l,e,r,i),d=t.nextZ;d&&d.z<=_;){if(d!==t.prev&&d!==t.next&&Earcut.pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,d.x,d.y)&&Earcut.area(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&Earcut.pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,d.x,d.y)&&Earcut.area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0},Earcut.cureLocalIntersections=function(t,e,r){var i=t;do{var n=i.prev,a=i.next.next;!Earcut.equals(n,a)&&Earcut.intersects(n,i,i.next,a)&&Earcut.locallyInside(n,a)&&Earcut.locallyInside(a,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(a.i/r),Earcut.removeNode(i),Earcut.removeNode(i.next),i=t=a),i=i.next}while(i!==t);return i},Earcut.splitEarcut=function(t,e,r,i,n,a){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Earcut.isValidDiagonal(s,o)){var h=Earcut.splitPolygon(s,o);return s=Earcut.filterPoints(s,s.next),h=Earcut.filterPoints(h,h.next),Earcut.earcutLinked(s,e,r,i,n,a),void Earcut.earcutLinked(h,e,r,i,n,a)}o=o.next}s=s.next}while(s!==t)},Earcut.eliminateHoles=function(t,e,r,i){var n,a,s,o,h,u=[];for(n=0,a=e.length;n<a;n++)s=e[n]*i,o=n<a-1?e[n+1]*i:t.length,(h=Earcut.linkedList(t,s,o,i,!1))===h.next&&(h.steiner=!0),u.push(Earcut.getLeftmost(h));for(u.sort(Earcut.compareX),n=0;n<u.length;n++)Earcut.eliminateHole(u[n],r),r=Earcut.filterPoints(r,r.next);return r},Earcut.compareX=function(t,e){return t.x-e.x},Earcut.eliminateHole=function(t,e){if(e=Earcut.findHoleBridge(t,e)){var r=Earcut.splitPolygon(e,t);Earcut.filterPoints(r,r.next)}},Earcut.findHoleBridge=function(t,e){var r,i=e,n=t.x,a=t.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>s){if(s=o,o===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===s)return r.prev;var h,u=r,l=r.x,c=r.y,_=1/0;for(i=r.next;i!==u;)n>=i.x&&i.x>=l&&n!==i.x&&Earcut.pointInTriangle(a<c?n:s,a,l,c,a<c?s:n,a,i.x,i.y)&&((h=Math.abs(a-i.y)/(n-i.x))<_||h===_&&i.x>r.x)&&Earcut.locallyInside(i,t)&&(r=i,_=h),i=i.next;return r},Earcut.indexCurve=function(t,e,r,i){var n=t;do{null===n.z&&(n.z=Earcut.zOrder(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,Earcut.sortLinked(n)},Earcut.sortLinked=function(t){var e,r,i,n,a,s,o,h,u=1;do{for(r=t,t=null,a=null,s=0;r;){for(s++,i=r,o=0,e=0;e<u&&(o++,i=i.nextZ);e++);for(h=u;o>0||h>0&&i;)0!==o&&(0===h||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,h--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;r=i}a.nextZ=null,u*=2}while(s>1);return t},Earcut.zOrder=function(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1},Earcut.getLeftmost=function(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r},Earcut.pointInTriangle=function(t,e,r,i,n,a,s,o){return(n-s)*(e-o)-(t-s)*(a-o)>=0&&(t-s)*(i-o)-(r-s)*(e-o)>=0&&(r-s)*(a-o)-(n-s)*(i-o)>=0},Earcut.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Earcut.intersectsPolygon(t,e)&&Earcut.locallyInside(t,e)&&Earcut.locallyInside(e,t)&&Earcut.middleInside(t,e)},Earcut.area=function(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)},Earcut.equals=function(t,e){return t.x===e.x&&t.y===e.y},Earcut.intersects=function(t,e,r,i){return!!(Earcut.equals(t,e)&&Earcut.equals(r,i)||Earcut.equals(t,i)&&Earcut.equals(r,e))||Earcut.area(t,e,r)>0!=Earcut.area(t,e,i)>0&&Earcut.area(r,i,t)>0!=Earcut.area(r,i,e)>0},Earcut.intersectsPolygon=function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Earcut.intersects(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1},Earcut.locallyInside=function(t,e){return Earcut.area(t.prev,t,t.next)<0?Earcut.area(t,e,t.next)>=0&&Earcut.area(t,t.prev,e)>=0:Earcut.area(t,e,t.prev)<0||Earcut.area(t,t.next,e)<0},Earcut.middleInside=function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i},Earcut.splitPolygon=function(t,e){var r=new st(t.i,t.x,t.y),i=new st(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i},Earcut.insertNode=function(t,e,r,i){var n=new st(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n},Earcut.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},Earcut.signedArea=function(t,e,r,i){for(var n=0,a=e,s=r-i;a<r;a+=i)n+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return n},Earcut}(),it=function(){function SubmitCMD(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new tt}n(SubmitCMD,"laya.webgl.submit.SubmitCMD");var t=SubmitCMD.prototype;return r.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},t.getRenderType=function(){return 0},t.reUse=function(t,e){return this._ref++,e},t.releaseRender=function(){if(--this._ref<1){var t=SubmitCMD.POOL;t[t._length++]=this}},t.clone=function(t,e,r){return null},SubmitCMD.create=function(t,e,r){var i=SubmitCMD.POOL._length?SubmitCMD.POOL[--SubmitCMD.POOL._length]:new SubmitCMD;return i.fun=e,i.args=t,i._this=r,i._ref=1,i._key.clear(),i},SubmitCMD.POOL=(SubmitCMD.POOL=[],SubmitCMD.POOL._length=0,SubmitCMD.POOL),SubmitCMD}(),nt=function(){function InlcudeFile(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,r=0,i=0;!((e=t.indexOf("#begin",e))<0);){for(i=e+5;!((i=t.indexOf("#end",i))<0)&&"i"===t.charAt(i+4);)i+=5;if(i<0)throw"add include err,no #end:"+t;r=t.indexOf("\n",e);var n=N.splitToWords(t.substr(e,r-e),null);"code"==n[1]?this.codes[n[2]]=t.substr(r+1,i-r-1):"function"==n[1]&&(r=t.indexOf("function",e),r+="function".length,this.funs[n[3]]=t.substr(r+1,i-r-1),this.funnames+=n[3]+";"),e=i+1}}n(InlcudeFile,"laya.webgl.utils.InlcudeFile");var t=InlcudeFile.prototype;return t.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},t.getFunsScript=function(t){var e="";for(var r in this.funs)t.indexOf(r+";")>=0&&(e+=this.funs[r]);return e},InlcudeFile}(),at=(function(){function ShaderValue(){}n(ShaderValue,"laya.webgl.shader.ShaderValue")}(),function(){function WebGLRTMgr(){}return n(WebGLRTMgr,"laya.webgl.resource.WebGLRTMgr"),WebGLRTMgr.getRT=function(t,e){e|=0,(t|=0)>=1e4&&console.error("getRT error! w too big");var r,i=1e4*e+t,n=WebGLRTMgr.dict[i];return n&&n.length>0?((r=n.pop())._mgrKey=i,r):((r=new Ot(t,e,1,-1))._mgrKey=i,r)},WebGLRTMgr.releaseRT=function(t){if(!(t._mgrKey<=0)){var e=WebGLRTMgr.dict[t._mgrKey];!e&&(e=[],WebGLRTMgr.dict[t._mgrKey]=e),t._mgrKey=0,e.push(t)}},WebGLRTMgr.dict={},WebGLRTMgr}()),st=function(){function EarcutNode(t,e,r){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return n(EarcutNode,"laya.webgl.shapes.EarcutNode"),EarcutNode}(),ot=function(){function RenderState2D(){}return n(RenderState2D,"laya.webgl.utils.RenderState2D"),RenderState2D.mat2MatArray=function(t,e){var r=t,i=e;return i[0]=r.a,i[1]=r.b,i[2]=RenderState2D.EMPTYMAT4_ARRAY[2],i[3]=RenderState2D.EMPTYMAT4_ARRAY[3],i[4]=r.c,i[5]=r.d,i[6]=RenderState2D.EMPTYMAT4_ARRAY[6],i[7]=RenderState2D.EMPTYMAT4_ARRAY[7],i[8]=RenderState2D.EMPTYMAT4_ARRAY[8],i[9]=RenderState2D.EMPTYMAT4_ARRAY[9],i[10]=RenderState2D.EMPTYMAT4_ARRAY[10],i[11]=RenderState2D.EMPTYMAT4_ARRAY[11],i[12]=r.tx,i[13]=r.ty,i[14]=RenderState2D.EMPTYMAT4_ARRAY[14],i[15]=RenderState2D.EMPTYMAT4_ARRAY[15],e},RenderState2D.restoreTempArray=function(){RenderState2D.TEMPMAT4_ARRAY[0]=1,RenderState2D.TEMPMAT4_ARRAY[1]=0,RenderState2D.TEMPMAT4_ARRAY[4]=0,RenderState2D.TEMPMAT4_ARRAY[5]=1,RenderState2D.TEMPMAT4_ARRAY[12]=0,RenderState2D.TEMPMAT4_ARRAY[13]=0},RenderState2D.clear=function(){RenderState2D.worldScissorTest=!1,RenderState2D.worldAlpha=1},RenderState2D._MAXSIZE=99999999,RenderState2D.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RenderState2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY,RenderState2D.matWVP=null,RenderState2D.worldAlpha=1,RenderState2D.worldScissorTest=!1,RenderState2D.worldShaderDefines=null,RenderState2D.worldFilters=null,RenderState2D.width=0,RenderState2D.height=0,i(RenderState2D,["worldMatrix",function(){return this.worldMatrix=new p}]),RenderState2D}(),ht=function(){function SaveClipRect(){this._clipInfoID=-1,this._globalClipMatrix=new p,this._clipRect=new m}n(SaveClipRect,"laya.webgl.canvas.save.SaveClipRect");var t=SaveClipRect.prototype;return r.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._globalClipMatrix.copyTo(t._globalClipMatrix),this._clipRect.clone(t._clipRect),t._clipInfoID=this._clipInfoID,SaveClipRect.POOL[SaveClipRect.POOL._length++]=this},SaveClipRect.save=function(t){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var e=SaveClipRect.POOL,r=e._length>0?e[--e._length]:new SaveClipRect;t._globalClipMatrix.copyTo(r._globalClipMatrix),t._clipRect.clone(r._clipRect),r._clipInfoID=t._clipInfoID;var i=t._save;i[i._length++]=r}},SaveClipRect.POOL=D._createArray(),SaveClipRect}(),ut=function(){var t;function Path(){this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}n(Path,"laya.webgl.canvas.Path");var e=Path.prototype;return e.beginPath=function(e){this.paths.length=1,this._curPath=this.paths[0]=new t,this._curPath.convex=e},e.closePath=function(){this._curPath.loop=!0},e.newPath=function(){this._curPath=new t,this.paths.push(this._curPath)},e.addPoint=function(t,e){this._curPath.path.push(t,e)},e.push=function(e,r){this._curPath?this._curPath.path.length>0&&(this._curPath=new t,this.paths.push(this._curPath)):(this._curPath=new t,this.paths.push(this._curPath));var i=this._curPath;i.path=e.slice(),i.convex=r},e.reset=function(){this.paths.length=0},Path.__init$=function(){t=function(){function renderPath(){this.path=[],this.loop=!1,this.convex=!1}return n(renderPath,""),renderPath}()},Path}(),lt=function(){function TextRender(){this.fontSizeInfo={},this.charRender=null,this.mapFont={},this.fontID=0,this.mapColor=[],this.colorID=0,this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.bmpData32=null,this.lastFont=null,this.fontSizeW=0,this.fontSizeH=0,this.fontSizeOffX=0,this.fontSizeOffY=0,this.renderPerChar=!0,this.textureMem=0,this.fontStr=null,this.textAtlases=[],this.isoTextures=[],this.tmpAtlasPos=new b;var t=!1,e=r.MiniAdpter;e&&e.systemInfo&&e.systemInfo.system&&(t="ios 10.1.1"===e.systemInfo.system.toLowerCase()),h.onMiniGame&&!t&&(TextRender.isWan1Wan=!0),h.onLimixiu&&(TextRender.isWan1Wan=!0),this.charRender=T.isConchApp?new Et:new Rt(TextRender.atlasWidth,TextRender.atlasWidth,TextRender.scaleFontWithCtx,!TextRender.isWan1Wan,!1),TextRender.textRenderInst=this,r.textRender=this,TextRender.atlasWidth2=TextRender.atlasWidth*TextRender.atlasWidth}n(TextRender,"laya.webgl.text.TextRender");var t=TextRender.prototype;return t.setFont=function(t){if(this.lastFont!=t){this.lastFont=t;var e=this.getFontSizeInfo(t._family),r=e>>24,i=e>>16&255,n=e>>8&255,a=255&e,s=t._size/TextRender.standardFontSize;this.fontSizeOffX=Math.ceil(r*s),this.fontSizeOffY=Math.ceil(i*s),this.fontSizeW=Math.ceil(n*s),this.fontSizeH=Math.ceil(a*s),this.fontStr=t._font.replace("italic","")}},t.getNextChar=function(t){var e=t.length,r=this._curStrPos;if(r>=e)return null;for(var i=r,n=0;i<e;i++){var a=t.charCodeAt(i);if(a>>>11==27){if(1==n)break;n=1,i++}else if(65038===a||65039===a);else if(8205==a)n=2;else if(0==n)n=1;else if(1==n)break}return this._curStrPos=i,t.substring(r,i)},t.filltext=function(t,e,r,i,n,a,s,o,h,u){if(void 0===u&&(u=0),!(e.length<=0)){var l=d.Parse(n),_=0;switch(h){case"center":_=c.ENUM_TEXTALIGN_CENTER;break;case"right":_=c.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,r,i,l,a,s,o,_,u)}},t.fillWords=function(t,e,r,i,n,a,s,o){if(e&&!(e.length<=0)){var h=d.Parse(n);this._fast_filltext(t,null,e,r,i,h,a,s,o,0,0)}},t._fast_filltext=function(t,e,r,i,n,a,s,o,h,u,l){if(void 0===l&&(l=0),!(e&&e.length<1||r&&r.length<1)){if(h<0&&(h=0),this.setFont(a),this.fontScaleX=this.fontScaleY=1,!T.isConchApp&&TextRender.scaleFontWithCtx){var _=1,d=1;if(T.isConchApp?(_=t._curMat.getScaleX(),d=t._curMat.getScaleY()):(_=t.getMatScaleX(),d=t.getMatScaleY()),_<1e-4||d<.1)return;_>1&&(this.fontScaleX=_),d>1&&(this.fontScaleY=d)}a._italic&&(t._italicDeg=13);var f=e,x=!r&&e instanceof laya.utils.WordText,p=e,b=!!r,m=x?f.pageChars:[],v=0;switch(x?(p=f._text,(v=f.width)<0&&(v=f.width=this.charRender.getWidth(this.fontStr,p))):v=p?this.charRender.getWidth(this.fontStr,p):0,u){case c.ENUM_TEXTALIGN_CENTER:i-=v/2;break;case c.ENUM_TEXTALIGN_RIGHT:i-=v}f&&m&&this.hasFreedText(m)&&(m=f.pageChars=[]);var C=null,g=(x||TextRender.forceWholeRender,this.renderPerChar=!x||TextRender.forceSplitRender||b);if(!m||m.length<1)if(g){var y,S=0,R=0;for(this._curStrPos=0;;){if(b){var E=r[this._curStrPos++];E?(y=E.char,S=E.x,R=E.y):y=null}else y=this.getNextChar(p);if(!y)break;if(!(C=this.getCharRenderInfo(y,a,s,o,h,!1)))break;if(C.isSpace);else{var A=m[C.tex.id];A||(m[C.tex.id]=A=[]),T.isConchApp?A.push({ri:C,x:S,y:R,w:C.bmpWidth/this.fontScaleX,h:C.bmpHeight/this.fontScaleY}):A.push({ri:C,x:S+1/this.fontScaleX,y:R/this.fontScaleY,w:(C.bmpWidth-2)/this.fontScaleX,h:(C.bmpHeight-1)/this.fontScaleY}),S+=C.width}}}else{var M=TextRender.noAtlas||v*this.fontScaleX>TextRender.atlasWidth;C=this.getCharRenderInfo(p,a,s,o,h,M),T.isConchApp?m[0]=[{ri:C,x:0,y:0,w:C.bmpWidth/this.fontScaleX,h:C.bmpHeight/this.fontScaleY}]:m[0]=[{ri:C,x:1/this.fontScaleX,y:0/this.fontScaleY,w:(C.bmpWidth-2)/this.fontScaleX,h:(C.bmpHeight-1)/this.fontScaleY}]}this._drawResortedWords(t,i,n,m),t._italicDeg=0}},t._drawResortedWords=function(t,e,r,i){var n=t._charSubmitCache&&t._charSubmitCache._enbale;for(var a in i){var s=i[a],o=s.length;if(!(o<=0))for(var h=0;h<o;h++){var u=s[h],l=u.ri;l.isSpace||(l.touch(),t.drawTexAlign=!0,T.isConchApp?t._drawTextureM(l.tex.texture,e+u.x-l.orix,r+u.y-l.oriy,u.w,u.h,null,1,l.uv):t._inner_drawTexture(l.tex.texture,l.tex.texture.bitmap.id,e+u.x-l.orix,r+u.y-l.oriy,u.w,u.h,null,l.uv,1,n),t.touches&&t.touches.push(l))}}},t.hasFreedText=function(t){for(var e in t)for(var r=t[e],i=0,n=r.length;i<n;i++){var a=r[i].ri;if(a.deleted||a.tex.__destroyed)return!0}return!1},t.getCharRenderInfo=function(t,e,r,i,n,a){void 0===a&&(a=!1);var s=this.mapFont[e._family];null==s&&(this.mapFont[e._family]=s=this.fontID++);var o=t+"_"+s+"_"+e._size+"_"+r;n>0&&(o+="_"+i+n),e._bold&&(o+="P"),1==this.fontScaleX&&1==this.fontScaleY||(o+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0));var h=0,u=this.textAtlases.length,l=null,c=null;if(!a)for(h=0;h<u;h++)if(l=(c=this.textAtlases[h]).charMaps[o])return l.touch(),l;l=new Y,this.charRender.scale(this.fontScaleX,this.fontScaleY),l.char=t,l.height=e._size;var _=e._size/3|0,d=null,f=Math.ceil(this.charRender.getWidth(this.fontStr,t)*this.fontScaleX);if(f>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,f+2*_)),a){d=this.charRender.getCharBmp(t,this.fontStr,n,r,i,l,_,_,_,_,null);var x=Bt.getTextTexture(d.width,d.height);x.addChar(d,0,0,l.uv),l.tex=x,l.orix=_,l.oriy=_,x.ri=l,this.isoTextures.push(x)}else{var p=t.length,b=1*n,m=Math.ceil((this.fontSizeW+2*b)*this.fontScaleX),T=Math.ceil((this.fontSizeH+2*b)*this.fontScaleY);TextRender.imgdtRect[0]=(_-this.fontSizeOffX-b)*this.fontScaleX|0,TextRender.imgdtRect[1]=(_-this.fontSizeOffY-b)*this.fontScaleY|0,this.renderPerChar||1==p?(TextRender.imgdtRect[2]=Math.max(f,m),TextRender.imgdtRect[3]=Math.max(f,T)):(TextRender.imgdtRect[2]=-1,TextRender.imgdtRect[3]=T),d=this.charRender.getCharBmp(t,this.fontStr,n,r,i,l,_,_,_,_,TextRender.imgdtRect),c=this.addBmpData(d,l),TextRender.isWan1Wan?(l.orix=_,l.oriy=_):(l.orix=this.fontSizeOffX+b,l.oriy=this.fontSizeOffY+b),c.charMaps[o]=l}return l},t.addBmpData=function(t,e){for(var r=t.width,i=t.height,n=this.textAtlases.length,a=null,s=!1,o=0;o<n&&!(s=(a=this.textAtlases[o]).getAEmpty(r,i,this.tmpAtlasPos));o++);if(!s){if(a=new K,this.textAtlases.push(a),!(s=a.getAEmpty(r,i,this.tmpAtlasPos)))throw"err1";this.cleanAtlases()}return s&&(a.texture.addChar(t,this.tmpAtlasPos.x,this.tmpAtlasPos.y,e.uv),e.tex=a.texture),a},t.GC=function(t){for(var e=0,r=this.textAtlases.length,i=TextRender.destroyAtlasDt,n=0,a=-1,s=0,o=null,h=null;e<r;e++){if(o=(h=this.textAtlases[e]).texture){o.curUsedCovRate,n+=o.curUsedCovRateAtlas;var u=h.usedRate-o.curUsedCovRateAtlas;s<u&&(s=u,a=e)}R.loopCount-h.texture.lastTouchTm>i&&(TextRender.showLog&&console.log(h.texture.id),h.destroy(),this.textAtlases[e]=this.textAtlases[r-1],r--,e--)}for(this.textAtlases.length=r,r=this.isoTextures.length,e=0;e<r;e++)o=this.isoTextures[e],R.loopCount-o.lastTouchTm>TextRender.destroyUnusedTextureDt&&(o.ri.deleted=!0,o.ri.tex=null,o.destroy(),this.isoTextures[e]=this.isoTextures[r-1],r--,e--);var l=this.textAtlases.length>1&&this.textAtlases.length-n>=2;(TextRender.atlasWidth*TextRender.atlasWidth*4*this.textAtlases.length>TextRender.cleanMem||l||TextRender.simClean)&&(TextRender.simClean=!1,TextRender.showLog&&console.log("清理使用率低的贴图。总使用率:",n,":",this.textAtlases.length,"最差贴图:"+a),a>=0&&((h=this.textAtlases[a]).destroy(),this.textAtlases[a]=this.textAtlases[this.textAtlases.length-1],this.textAtlases.length=this.textAtlases.length-1)),Bt.clean()},t.cleanAtlases=function(){},t.getCharBmp=function(t){},t.checkBmpLine=function(t,e,r,i){this.bmpData32.buffer!=t.data.buffer&&(this.bmpData32=new Uint32Array(t.data.buffer));for(var n=t.width*e+r,a=r;a<i;a++)if(0!=this.bmpData32[n++])return!0;return!1},t.updateBbx=function(t,e,r){void 0===r&&(r=!1);var i=t.width,n=t.height,a=0,s=e[1],o=0,h=s;if(this.checkBmpLine(t,s,0,i))for(;;){if((h=(s+o)/2|0)+1>=s){e[1]=h;break}this.checkBmpLine(t,h,0,i)?s=h:o=h}if(e[3]>n)e[3]=n;else if(h=s=e[3],o=n,this.checkBmpLine(t,s,0,i))for(;;){if((h=(s+o)/2|0)-1<=s){e[3]=h;break}this.checkBmpLine(t,h,0,i)?s=h:o=h}if(!r){var u=e[0],l=i*e[1];for(h=e[1];h<e[3];h++){for(a=0;a<u;a++)if(0!=this.bmpData32[l+a]){u=a;break}l+=i}e[0]=u;var c=e[2];for(l=i*e[1],h=e[1];h<e[3];h++){for(a=c;a<i;a++)if(0!=this.bmpData32[l+a]){c=a;break}l+=i}e[2]=c}},t.getFontSizeInfo=function(t){var e=this.fontSizeInfo[t];if(null!=e)return e;var r="bold "+TextRender.standardFontSize+"px "+t;if(TextRender.isWan1Wan){this.fontSizeW=1.5*this.charRender.getWidth(r,"有"),this.fontSizeH=1.5*TextRender.standardFontSize;var i=this.fontSizeW<<8|this.fontSizeH;return this.fontSizeInfo[t]=i,i}TextRender.pixelBBX[0]=TextRender.standardFontSize/2,TextRender.pixelBBX[1]=TextRender.standardFontSize/2,TextRender.pixelBBX[2]=TextRender.standardFontSize,TextRender.pixelBBX[3]=TextRender.standardFontSize;var n=16,a=16;this.charRender.scale(1,1),TextRender.tmpRI.height=TextRender.standardFontSize;var s=this.charRender.getCharBmp("g",r,0,"red",null,TextRender.tmpRI,n,a,16,16);T.isConchApp&&(s.data=new Uint8ClampedArray(s.data)),this.bmpData32=new Uint32Array(s.data.buffer),this.updateBbx(s,TextRender.pixelBBX,!1),s=this.charRender.getCharBmp("有",r,0,"red",null,TextRender.tmpRI,a,a,16,16),T.isConchApp&&(s.data=new Uint8ClampedArray(s.data)),this.bmpData32=new Uint32Array(s.data.buffer),TextRender.pixelBBX[2]<n+TextRender.tmpRI.width&&(TextRender.pixelBBX[2]=n+TextRender.tmpRI.width),this.updateBbx(s,TextRender.pixelBBX,!1),T.isConchApp&&(n=0,a=0);var o=Math.max(n-TextRender.pixelBBX[0],0)<<24|Math.max(a-TextRender.pixelBBX[1],0)<<16|TextRender.pixelBBX[2]-TextRender.pixelBBX[0]<<8|TextRender.pixelBBX[3]-TextRender.pixelBBX[1];return this.fontSizeInfo[t]=o,o},t.printDbgInfo=function(){for(var t in console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+TextRender.atlasWidth+"x"+TextRender.atlasWidth," 用canvas:",TextRender.isWan1Wan),console.log("图集占用空间:"+TextRender.atlasWidth*TextRender.atlasWidth*4/1024/1024*this.textAtlases.length+"M"),console.log("缓存用到的字体:"),this.mapFont){var e=this.getFontSizeInfo(t),r=e>>24,i=e>>16&255,n=e>>8&255,a=255&e;console.log("    "+t," off:",r,i," size:",n,a)}var s=0;console.log("缓存数据:");var o=0,h=0;this.textAtlases.forEach(function(t){var e=t.texture.id,r=R.loopCount-t.texture.lastTouchTm,i=r>0?r+"帧以前":"当前帧";for(var n in o+=t.texture.curUsedCovRate,h+=t.texture.curUsedCovRateAtlas,console.log("--图集(id:"+e+",当前使用率:"+(1e3*t.texture.curUsedCovRate|0)+"‰","当前图集使用率:",(100*t.texture.curUsedCovRateAtlas|0)+"%","图集使用率:",100*t.usedRate|0,"%, 使用于:"+i+")--:"),t.charMaps){var a=t.charMaps[n];console.log("     off:",a.orix,a.oriy," bmp宽高:",a.bmpWidth,a.bmpHeight,"无效:",a.deleted,"touchdt:",R.loopCount-a.touchTick,"位置:",a.uv[0]*TextRender.atlasWidth|0,a.uv[1]*TextRender.atlasWidth|0,"字符:",a.char,"key:",n),s++}}),console.log("独立贴图文字("+this.isoTextures.length+"个):"),this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",R.loopCount-t.lastTouchTm,"char:",t.ri.char)}),console.log("总缓存:",s,"总使用率:",o,"总当前图集使用率:",h)},t.showAtlas=function(t,e,i,n,a,s){if(!this.textAtlases[t])return console.log("没有这个图集"),null;var o=new y,h=this.textAtlases[t].texture,u={width:TextRender.atlasWidth,height:TextRender.atlasWidth,sourceWidth:TextRender.atlasWidth,sourceHeight:TextRender.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return h._getSource()},bitmap:{id:h.id},_uv:M.DEF_UV};return o.size=function(t,r){return this.width=t,this.height=r,o.graphics.clear(),o.graphics.drawRect(0,0,o.width,o.height,e),o.graphics.drawTexture(u,0,0,o.width,o.height),this},o.graphics.drawRect(0,0,a,s,e),o.graphics.drawTexture(u,0,0,a,s),o.pos(i,n),r.stage.addChild(o),o},t.filltext_native=function(t,e,r,i,n,a,s,o,h,u,l){if(void 0===l&&(l=0),!(e&&e.length<=0||r&&r.length<1)){var _=d.Parse(a),f=0;switch(u){case"center":f=c.ENUM_TEXTALIGN_CENTER;break;case"right":f=c.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(t,e,r,i,n,_,s,o,h,f,l)}},TextRender.useOldCharBook=!1,TextRender.atlasWidth=2048,TextRender.noAtlas=!1,TextRender.forceSplitRender=!1,TextRender.forceWholeRender=!1,TextRender.scaleFontWithCtx=!0,TextRender.standardFontSize=32,TextRender.destroyAtlasDt=10,TextRender.checkCleanTextureDt=2e3,TextRender.destroyUnusedTextureDt=3e3,TextRender.cleanMem=104857600,TextRender.isWan1Wan=!1,TextRender.showLog=!1,TextRender.debugUV=!1,TextRender.atlasWidth2=4194304,TextRender.textRenderInst=null,TextRender.simClean=!1,i(TextRender,["tmpRI",function(){return this.tmpRI=new Y},"pixelBBX",function(){return this.pixelBBX=[0,0,0,0]},"imgdtRect",function(){return this.imgdtRect=[0,0,0,0]}]),TextRender}(),ct=function(){function WebGLContext(){}n(WebGLContext,"laya.webgl.WebGLContext");var e=WebGLContext.prototype;return e.getContextAttributes=function(){return null},e.isContextLost=function(){},e.getSupportedExtensions=function(){return null},e.getExtension=function(t){return null},e.activeTexture=function(t){},e.attachShader=function(t,e){},e.bindAttribLocation=function(t,e,r){},e.bindBuffer=function(t,e){},e.bindFramebuffer=function(t,e){},e.bindRenderbuffer=function(t,e){},e.bindTexture=function(t,e){},e.useTexture=function(t){},e.blendColor=function(t,e,r,i){},e.blendEquation=function(t){},e.blendEquationSeparate=function(t,e){},e.blendFunc=function(t,e){},e.blendFuncSeparate=function(t,e,r,i){},e.bufferData=function(t,e,r){},e.bufferSubData=function(t,e,r){},e.checkFramebufferStatus=function(t){return null},e.clear=function(t){},e.clearColor=function(t,e,r,i){},e.clearDepth=function(t){},e.clearStencil=function(t){},e.colorMask=function(t,e,r,i){},e.compileShader=function(t){},e.copyTexImage2D=function(t,e,r,i,n,a,s,o){},e.copyTexSubImage2D=function(t,e,r,i,n,a,s,o){},e.createBuffer=function(){},e.createFramebuffer=function(){},e.createProgram=function(){},e.createRenderbuffer=function(){},e.createShader=function(t){},e.createTexture=function(){return null},e.cullFace=function(t){},e.deleteBuffer=function(t){},e.deleteFramebuffer=function(t){},e.deleteProgram=function(t){},e.deleteRenderbuffer=function(t){},e.deleteShader=function(t){},e.deleteTexture=function(t){},e.depthFunc=function(t){},e.depthMask=function(t){},e.depthRange=function(t,e){},e.detachShader=function(t,e){},e.disable=function(t){},e.disableVertexAttribArray=function(t){},e.drawArrays=function(t,e,r){},e.drawElements=function(t,e,r,i){},e.enable=function(t){},e.enableVertexAttribArray=function(t){},e.finish=function(){},e.flush=function(){},e.framebufferRenderbuffer=function(t,e,r,i){},e.framebufferTexture2D=function(t,e,r,i,n){},e.frontFace=function(t){return null},e.generateMipmap=function(t){return null},e.getActiveAttrib=function(t,e){return null},e.getActiveUniform=function(t,e){return null},e.getAttribLocation=function(t,e){return 0},e.getParameter=function(t){return null},e.getBufferParameter=function(t,e){return null},e.getError=function(){return null},e.getFramebufferAttachmentParameter=function(t,e,r){},e.getProgramParameter=function(t,e){return 0},e.getProgramInfoLog=function(t){return null},e.getRenderbufferParameter=function(t,e){return null},e.getShaderPrecisionFormat=function(t){return null},e.getShaderParameter=function(t,e){},e.getShaderInfoLog=function(t){return null},e.getShaderSource=function(t){return null},e.getTexParameter=function(t,e){},e.getUniform=function(t,e){},e.getUniformLocation=function(t,e){return null},e.getVertexAttrib=function(t,e){return null},e.getVertexAttribOffset=function(t,e){return null},e.hint=function(t,e){},e.isBuffer=function(t){},e.isEnabled=function(t){},e.isFramebuffer=function(t){},e.isProgram=function(t){},e.isRenderbuffer=function(t){},e.isShader=function(t){},e.isTexture=function(t){},e.lineWidth=function(t){},e.linkProgram=function(t){},e.pixelStorei=function(t,e){},e.polygonOffset=function(t,e){},e.readPixels=function(t,e,r,i,n,a,s){},e.renderbufferStorage=function(t,e,r,i){},e.sampleCoverage=function(t,e){},e.scissor=function(t,e,r,i){},e.shaderSource=function(t,e){},e.stencilFunc=function(t,e,r){},e.stencilFuncSeparate=function(t,e,r,i){},e.stencilMask=function(t){},e.stencilMaskSeparate=function(t,e){},e.stencilOp=function(t,e,r){},e.stencilOpSeparate=function(t,e,r,i){},e.texImage2D=function(t){},e.texParameterf=function(t,e,r){},e.texParameteri=function(t,e,r){},e.texSubImage2D=function(t){},e.uniform1f=function(t,e){},e.uniform1fv=function(t,e){},e.uniform1i=function(t,e){},e.uniform1iv=function(t,e){},e.uniform2f=function(t,e,r){},e.uniform2fv=function(t,e){},e.uniform2i=function(t,e,r){},e.uniform2iv=function(t,e){},e.uniform3f=function(t,e,r,i){},e.uniform3fv=function(t,e){},e.uniform3i=function(t,e,r,i){},e.uniform3iv=function(t,e){},e.uniform4f=function(t,e,r,i,n){},e.uniform4fv=function(t,e){},e.uniform4i=function(t,e,r,i,n){},e.uniform4iv=function(t,e){},e.uniformMatrix2fv=function(t,e,r){},e.uniformMatrix3fv=function(t,e,r){},e.uniformMatrix4fv=function(t,e,r){},e.useProgram=function(t){},e.validateProgram=function(t){},e.vertexAttrib1f=function(t,e){},e.vertexAttrib1fv=function(t,e){},e.vertexAttrib2f=function(t,e,r){},e.vertexAttrib2fv=function(t,e){},e.vertexAttrib3f=function(t,e,r,i){},e.vertexAttrib3fv=function(t,e){},e.vertexAttrib4f=function(t,e,r,i,n){},e.vertexAttrib4fv=function(t,e){},e.vertexAttribPointer=function(t,e,r,i,n,a){},e.viewport=function(t,e,r,i){},e.configureBackBuffer=function(t,e,r,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1)},e.compressedTexImage2D=function(t){},e.createVertexArray=function(){throw"not implemented"},e.bindVertexArray=function(t){throw"not implemented"},e.deleteVertexArray=function(t){throw"not implemented"},e.isVertexArray=function(t){throw"not implemented"},WebGLContext.__init__=function(e){if(laya.webgl.WebGLContext._checkExtensions(e),!$._isWebGL2&&!T.isConchApp){t._setupVertexArrayObject&&(h.onBDMiniGame||h.onLimixiu?t._forceSetupVertexArrayObject(e):t._setupVertexArrayObject(e));var r=(e.rawgl||e).getExtension("OES_vertex_array_object");if(r){console.log("EXT:webgl support OES_vertex_array_object！");var i=e;i.createVertexArray=function(){return r.createVertexArrayOES()},i.bindVertexArray=function(t){r.bindVertexArrayOES(t)},i.deleteVertexArray=function(t){r.deleteVertexArrayOES(t)},i.isVertexArray=function(t){r.isVertexArrayOES(t)}}}},WebGLContext._getExtension=function(t,e){var r=WebGLContext._extentionVendorPrefixes;for(var i in r){var n=t.getExtension(r[i]+e);if(n)return n}return null},WebGLContext._checkExtensions=function(t){return WebGLContext._extTextureFilterAnisotropic=WebGLContext._getExtension(t,"EXT_texture_filter_anisotropic"),WebGLContext._compressedTextureS3tc=WebGLContext._getExtension(t,"WEBGL_compressed_texture_s3tc"),WebGLContext._compressedTexturePvrtc=WebGLContext._getExtension(t,"WEBGL_compressed_texture_pvrtc"),WebGLContext._compressedTextureEtc1=WebGLContext._getExtension(t,"WEBGL_compressed_texture_etc1"),null},WebGLContext.__init_native=function(){if(T.supportWebGLPlusRendering){var t=WebGLContext;t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative}},WebGLContext.useProgram=function(t,e){return WebGLContext._useProgram!==e&&(t.useProgram(e),WebGLContext._useProgram=e,!0)},WebGLContext.setDepthTest=function(t,e){e!==WebGLContext._depthTest&&(WebGLContext._depthTest=e,e?t.enable(2929):t.disable(2929))},WebGLContext.setDepthMask=function(t,e){e!==WebGLContext._depthMask&&(WebGLContext._depthMask=e,t.depthMask(e))},WebGLContext.setDepthFunc=function(t,e){e!==WebGLContext._depthFunc&&(WebGLContext._depthFunc=e,t.depthFunc(e))},WebGLContext.setBlend=function(t,e){e!==WebGLContext._blend&&(WebGLContext._blend=e,e?t.enable(3042):t.disable(3042))},WebGLContext.setBlendFunc=function(t,e,r){(e!==WebGLContext._sFactor||r!==WebGLContext._dFactor)&&(WebGLContext._sFactor=e,WebGLContext._dFactor=r,t.blendFunc(e,r))},WebGLContext.setCullFace=function(t,e){e!==WebGLContext._cullFace&&(WebGLContext._cullFace=e,e?t.enable(2884):t.disable(2884))},WebGLContext.setFrontFace=function(t,e){e!==WebGLContext._frontFace&&(WebGLContext._frontFace=e,t.frontFace(e))},WebGLContext.activeTexture=function(t,e){WebGLContext._activedTextureID!==e&&(t.activeTexture(e),WebGLContext._activedTextureID=e)},WebGLContext.bindTexture=function(t,e,r){WebGLContext._activeTextures[WebGLContext._activedTextureID-33984]!==r&&(t.bindTexture(e,r),WebGLContext._activeTextures[WebGLContext._activedTextureID-33984]=r)},WebGLContext.useProgramForNative=function(t,e){return t.useProgram(e),!0},WebGLContext.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},WebGLContext.setDepthMaskForNative=function(t,e){t.depthMask(e)},WebGLContext.setDepthFuncForNative=function(t,e){t.depthFunc(e)},WebGLContext.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},WebGLContext.setBlendFuncForNative=function(t,e,r){t.blendFunc(e,r)},WebGLContext.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},WebGLContext.setFrontFaceForNative=function(t,e){t.frontFace(e)},WebGLContext.activeTextureForNative=function(t,e){t.activeTexture(e)},WebGLContext.bindTextureForNative=function(t,e,r){t.bindTexture(e,r)},WebGLContext.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},WebGLContext.DEPTH_BUFFER_BIT=256,WebGLContext.STENCIL_BUFFER_BIT=1024,WebGLContext.COLOR_BUFFER_BIT=16384,WebGLContext.POINTS=0,WebGLContext.LINES=1,WebGLContext.LINE_LOOP=2,WebGLContext.LINE_STRIP=3,WebGLContext.TRIANGLES=4,WebGLContext.TRIANGLE_STRIP=5,WebGLContext.TRIANGLE_FAN=6,WebGLContext.ZERO=0,WebGLContext.ONE=1,WebGLContext.SRC_COLOR=768,WebGLContext.ONE_MINUS_SRC_COLOR=769,WebGLContext.SRC_ALPHA=770,WebGLContext.ONE_MINUS_SRC_ALPHA=771,WebGLContext.DST_ALPHA=772,WebGLContext.ONE_MINUS_DST_ALPHA=773,WebGLContext.DST_COLOR=774,WebGLContext.ONE_MINUS_DST_COLOR=775,WebGLContext.SRC_ALPHA_SATURATE=776,WebGLContext.FUNC_ADD=32774,WebGLContext.BLEND_EQUATION=32777,WebGLContext.BLEND_EQUATION_RGB=32777,WebGLContext.BLEND_EQUATION_ALPHA=34877,WebGLContext.FUNC_SUBTRACT=32778,WebGLContext.FUNC_REVERSE_SUBTRACT=32779,WebGLContext.BLEND_DST_RGB=32968,WebGLContext.BLEND_SRC_RGB=32969,WebGLContext.BLEND_DST_ALPHA=32970,WebGLContext.BLEND_SRC_ALPHA=32971,WebGLContext.CONSTANT_COLOR=32769,WebGLContext.ONE_MINUS_CONSTANT_COLOR=32770,WebGLContext.CONSTANT_ALPHA=32771,WebGLContext.ONE_MINUS_CONSTANT_ALPHA=32772,WebGLContext.BLEND_COLOR=32773,WebGLContext.ARRAY_BUFFER=34962,WebGLContext.ELEMENT_ARRAY_BUFFER=34963,WebGLContext.ARRAY_BUFFER_BINDING=34964,WebGLContext.ELEMENT_ARRAY_BUFFER_BINDING=34965,WebGLContext.STREAM_DRAW=35040,WebGLContext.STATIC_DRAW=35044,WebGLContext.DYNAMIC_DRAW=35048,WebGLContext.BUFFER_SIZE=34660,WebGLContext.BUFFER_USAGE=34661,WebGLContext.CURRENT_VERTEX_ATTRIB=34342,WebGLContext.FRONT=1028,WebGLContext.BACK=1029,WebGLContext.CULL_FACE=2884,WebGLContext.FRONT_AND_BACK=1032,WebGLContext.BLEND=3042,WebGLContext.DITHER=3024,WebGLContext.STENCIL_TEST=2960,WebGLContext.DEPTH_TEST=2929,WebGLContext.SCISSOR_TEST=3089,WebGLContext.POLYGON_OFFSET_FILL=32823,WebGLContext.SAMPLE_ALPHA_TO_COVERAGE=32926,WebGLContext.SAMPLE_COVERAGE=32928,WebGLContext.NO_ERROR=0,WebGLContext.INVALID_ENUM=1280,WebGLContext.INVALID_VALUE=1281,WebGLContext.INVALID_OPERATION=1282,WebGLContext.OUT_OF_MEMORY=1285,WebGLContext.CW=2304,WebGLContext.CCW=2305,WebGLContext.LINE_WIDTH=2849,WebGLContext.ALIASED_POINT_SIZE_RANGE=33901,WebGLContext.ALIASED_LINE_WIDTH_RANGE=33902,WebGLContext.CULL_FACE_MODE=2885,WebGLContext.FRONT_FACE=2886,WebGLContext.DEPTH_RANGE=2928,WebGLContext.DEPTH_WRITEMASK=2930,WebGLContext.DEPTH_CLEAR_VALUE=2931,WebGLContext.DEPTH_FUNC=2932,WebGLContext.STENCIL_CLEAR_VALUE=2961,WebGLContext.STENCIL_FUNC=2962,WebGLContext.STENCIL_FAIL=2964,WebGLContext.STENCIL_PASS_DEPTH_FAIL=2965,WebGLContext.STENCIL_PASS_DEPTH_PASS=2966,WebGLContext.STENCIL_REF=2967,WebGLContext.STENCIL_VALUE_MASK=2963,WebGLContext.STENCIL_WRITEMASK=2968,WebGLContext.STENCIL_BACK_FUNC=34816,WebGLContext.STENCIL_BACK_FAIL=34817,WebGLContext.STENCIL_BACK_PASS_DEPTH_FAIL=34818,WebGLContext.STENCIL_BACK_PASS_DEPTH_PASS=34819,WebGLContext.STENCIL_BACK_REF=36003,WebGLContext.STENCIL_BACK_VALUE_MASK=36004,WebGLContext.STENCIL_BACK_WRITEMASK=36005,WebGLContext.VIEWPORT=2978,WebGLContext.SCISSOR_BOX=3088,WebGLContext.COLOR_CLEAR_VALUE=3106,WebGLContext.COLOR_WRITEMASK=3107,WebGLContext.UNPACK_ALIGNMENT=3317,WebGLContext.PACK_ALIGNMENT=3333,WebGLContext.MAX_TEXTURE_SIZE=3379,WebGLContext.MAX_VIEWPORT_DIMS=3386,WebGLContext.SUBPIXEL_BITS=3408,WebGLContext.RED_BITS=3410,WebGLContext.GREEN_BITS=3411,WebGLContext.BLUE_BITS=3412,WebGLContext.ALPHA_BITS=3413,WebGLContext.DEPTH_BITS=3414,WebGLContext.STENCIL_BITS=3415,WebGLContext.POLYGON_OFFSET_UNITS=10752,WebGLContext.POLYGON_OFFSET_FACTOR=32824,WebGLContext.TEXTURE_BINDING_2D=32873,WebGLContext.SAMPLE_BUFFERS=32936,WebGLContext.SAMPLES=32937,WebGLContext.SAMPLE_COVERAGE_VALUE=32938,WebGLContext.SAMPLE_COVERAGE_INVERT=32939,WebGLContext.NUM_COMPRESSED_TEXTURE_FORMATS=34466,WebGLContext.COMPRESSED_TEXTURE_FORMATS=34467,WebGLContext.DONT_CARE=4352,WebGLContext.FASTEST=4353,WebGLContext.NICEST=4354,WebGLContext.GENERATE_MIPMAP_HINT=33170,WebGLContext.BYTE=5120,WebGLContext.UNSIGNED_BYTE=5121,WebGLContext.SHORT=5122,WebGLContext.UNSIGNED_SHORT=5123,WebGLContext.INT=5124,WebGLContext.UNSIGNED_INT=5125,WebGLContext.FLOAT=5126,WebGLContext.DEPTH_COMPONENT=6402,WebGLContext.ALPHA=6406,WebGLContext.RGB=6407,WebGLContext.RGBA=6408,WebGLContext.LUMINANCE=6409,WebGLContext.LUMINANCE_ALPHA=6410,WebGLContext.UNSIGNED_SHORT_4_4_4_4=32819,WebGLContext.UNSIGNED_SHORT_5_5_5_1=32820,WebGLContext.UNSIGNED_SHORT_5_6_5=33635,WebGLContext.FRAGMENT_SHADER=35632,WebGLContext.VERTEX_SHADER=35633,WebGLContext.MAX_VERTEX_ATTRIBS=34921,WebGLContext.MAX_VERTEX_UNIFORM_VECTORS=36347,WebGLContext.MAX_VARYING_VECTORS=36348,WebGLContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,WebGLContext.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,WebGLContext.MAX_TEXTURE_IMAGE_UNITS=34930,WebGLContext.MAX_FRAGMENT_UNIFORM_VECTORS=36349,WebGLContext.SHADER_TYPE=35663,WebGLContext.DELETE_STATUS=35712,WebGLContext.LINK_STATUS=35714,WebGLContext.VALIDATE_STATUS=35715,WebGLContext.ATTACHED_SHADERS=35717,WebGLContext.ACTIVE_UNIFORMS=35718,WebGLContext.ACTIVE_ATTRIBUTES=35721,WebGLContext.SHADING_LANGUAGE_VERSION=35724,WebGLContext.CURRENT_PROGRAM=35725,WebGLContext.NEVER=512,WebGLContext.LESS=513,WebGLContext.EQUAL=514,WebGLContext.LEQUAL=515,WebGLContext.GREATER=516,WebGLContext.NOTEQUAL=517,WebGLContext.GEQUAL=518,WebGLContext.ALWAYS=519,WebGLContext.KEEP=7680,WebGLContext.REPLACE=7681,WebGLContext.INCR=7682,WebGLContext.DECR=7683,WebGLContext.INVERT=5386,WebGLContext.INCR_WRAP=34055,WebGLContext.DECR_WRAP=34056,WebGLContext.VENDOR=7936,WebGLContext.RENDERER=7937,WebGLContext.VERSION=7938,WebGLContext.NEAREST=9728,WebGLContext.LINEAR=9729,WebGLContext.NEAREST_MIPMAP_NEAREST=9984,WebGLContext.LINEAR_MIPMAP_NEAREST=9985,WebGLContext.NEAREST_MIPMAP_LINEAR=9986,WebGLContext.LINEAR_MIPMAP_LINEAR=9987,WebGLContext.TEXTURE_MAG_FILTER=10240,WebGLContext.TEXTURE_MIN_FILTER=10241,WebGLContext.TEXTURE_WRAP_S=10242,WebGLContext.TEXTURE_WRAP_T=10243,WebGLContext.TEXTURE_2D=3553,WebGLContext.TEXTURE_3D=32879,WebGLContext.TEXTURE=5890,WebGLContext.TEXTURE_CUBE_MAP=34067,WebGLContext.TEXTURE_BINDING_CUBE_MAP=34068,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_X=34069,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,WebGLContext.MAX_CUBE_MAP_TEXTURE_SIZE=34076,WebGLContext.TEXTURE0=33984,WebGLContext.TEXTURE1=33985,WebGLContext.TEXTURE2=33986,WebGLContext.TEXTURE3=33987,WebGLContext.TEXTURE4=33988,WebGLContext.TEXTURE5=33989,WebGLContext.TEXTURE6=33990,WebGLContext.TEXTURE7=33991,WebGLContext.TEXTURE8=33992,WebGLContext.TEXTURE9=33993,WebGLContext.TEXTURE10=33994,WebGLContext.TEXTURE11=33995,WebGLContext.TEXTURE12=33996,WebGLContext.TEXTURE13=33997,WebGLContext.TEXTURE14=33998,WebGLContext.TEXTURE15=33999,WebGLContext.TEXTURE16=34e3,WebGLContext.TEXTURE17=34001,WebGLContext.TEXTURE18=34002,WebGLContext.TEXTURE19=34003,WebGLContext.TEXTURE20=34004,WebGLContext.TEXTURE21=34005,WebGLContext.TEXTURE22=34006,WebGLContext.TEXTURE23=34007,WebGLContext.TEXTURE24=34008,WebGLContext.TEXTURE25=34009,WebGLContext.TEXTURE26=34010,WebGLContext.TEXTURE27=34011,WebGLContext.TEXTURE28=34012,WebGLContext.TEXTURE29=34013,WebGLContext.TEXTURE30=34014,WebGLContext.TEXTURE31=34015,WebGLContext.ACTIVE_TEXTURE=34016,WebGLContext.REPEAT=10497,WebGLContext.CLAMP_TO_EDGE=33071,WebGLContext.MIRRORED_REPEAT=33648,WebGLContext.FLOAT_VEC2=35664,WebGLContext.FLOAT_VEC3=35665,WebGLContext.FLOAT_VEC4=35666,WebGLContext.INT_VEC2=35667,WebGLContext.INT_VEC3=35668,WebGLContext.INT_VEC4=35669,WebGLContext.BOOL=35670,WebGLContext.BOOL_VEC2=35671,WebGLContext.BOOL_VEC3=35672,WebGLContext.BOOL_VEC4=35673,WebGLContext.FLOAT_MAT2=35674,WebGLContext.FLOAT_MAT3=35675,WebGLContext.FLOAT_MAT4=35676,WebGLContext.SAMPLER_2D=35678,WebGLContext.SAMPLER_CUBE=35680,WebGLContext.VERTEX_ATTRIB_ARRAY_ENABLED=34338,WebGLContext.VERTEX_ATTRIB_ARRAY_SIZE=34339,WebGLContext.VERTEX_ATTRIB_ARRAY_STRIDE=34340,WebGLContext.VERTEX_ATTRIB_ARRAY_TYPE=34341,WebGLContext.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,WebGLContext.VERTEX_ATTRIB_ARRAY_POINTER=34373,WebGLContext.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,WebGLContext.COMPILE_STATUS=35713,WebGLContext.LOW_FLOAT=36336,WebGLContext.MEDIUM_FLOAT=36337,WebGLContext.HIGH_FLOAT=36338,WebGLContext.LOW_INT=36339,WebGLContext.MEDIUM_INT=36340,WebGLContext.HIGH_INT=36341,WebGLContext.FRAMEBUFFER=36160,WebGLContext.RENDERBUFFER=36161,WebGLContext.RGBA4=32854,WebGLContext.RGB5_A1=32855,WebGLContext.RGB565=36194,WebGLContext.DEPTH_COMPONENT16=33189,WebGLContext.STENCIL_INDEX=6401,WebGLContext.STENCIL_INDEX8=36168,WebGLContext.DEPTH_STENCIL=34041,WebGLContext.RENDERBUFFER_WIDTH=36162,WebGLContext.RENDERBUFFER_HEIGHT=36163,WebGLContext.RENDERBUFFER_INTERNAL_FORMAT=36164,WebGLContext.RENDERBUFFER_RED_SIZE=36176,WebGLContext.RENDERBUFFER_GREEN_SIZE=36177,WebGLContext.RENDERBUFFER_BLUE_SIZE=36178,WebGLContext.RENDERBUFFER_ALPHA_SIZE=36179,WebGLContext.RENDERBUFFER_DEPTH_SIZE=36180,WebGLContext.RENDERBUFFER_STENCIL_SIZE=36181,WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,WebGLContext.COLOR_ATTACHMENT0=36064,WebGLContext.DEPTH_ATTACHMENT=36096,WebGLContext.STENCIL_ATTACHMENT=36128,WebGLContext.DEPTH_STENCIL_ATTACHMENT=33306,WebGLContext.NONE=0,WebGLContext.FRAMEBUFFER_COMPLETE=36053,WebGLContext.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,WebGLContext.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,WebGLContext.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,WebGLContext.FRAMEBUFFER_UNSUPPORTED=36061,WebGLContext.FRAMEBUFFER_BINDING=36006,WebGLContext.RENDERBUFFER_BINDING=36007,WebGLContext.MAX_RENDERBUFFER_SIZE=34024,WebGLContext.INVALID_FRAMEBUFFER_OPERATION=1286,WebGLContext.UNPACK_FLIP_Y_WEBGL=37440,WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,WebGLContext.CONTEXT_LOST_WEBGL=37442,WebGLContext.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,WebGLContext.BROWSER_DEFAULT_WEBGL=37444,WebGLContext._extTextureFilterAnisotropic=null,WebGLContext._compressedTextureS3tc=null,WebGLContext._compressedTexturePvrtc=null,WebGLContext._compressedTextureEtc1=null,WebGLContext._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],WebGLContext._useProgram=null,WebGLContext._depthTest=!0,WebGLContext._depthMask=!0,WebGLContext._blend=!1,WebGLContext._cullFace=!1,WebGLContext._activedTextureID=33984,i(WebGLContext,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),WebGLContext}(),_t=function(){function DrawStyle(t){this._color=null,this.setValue(t)}n(DrawStyle,"laya.webgl.canvas.DrawStyle");var t=DrawStyle.prototype;return t.setValue=function(t){this._color=t?t instanceof laya.utils.ColorUtils?t:u.create(t):u.create("#000000")},t.reset=function(){this._color=u.create("#000000")},t.toInt=function(){return this._color.numColor},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.ColorUtils&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},DrawStyle.create=function(t){if(t){var e=t instanceof laya.utils.ColorUtils?t:u.create(t);return e._drawStyle||(e._drawStyle=new DrawStyle(t))}return DrawStyle.DEFAULT},i(DrawStyle,["DEFAULT",function(){return this.DEFAULT=new DrawStyle("#000000")}]),DrawStyle}(),dt=function(){function SaveTranslate(){this._mat=new p}n(SaveTranslate,"laya.webgl.canvas.save.SaveTranslate");var t=SaveTranslate.prototype;return r.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._mat.copyTo(t._curMat),SaveTranslate.POOL[SaveTranslate.POOL._length++]=this},SaveTranslate.save=function(t){var e=SaveTranslate.POOL,r=e._length>0?e[--e._length]:new SaveTranslate;t._curMat.copyTo(r._mat);var i=t._save;i[i._length++]=r},SaveTranslate.POOL=D._createArray(),SaveTranslate}(),ft=function(){function CharSubmitCache(){this._data=[],this._ndata=0,this._tex=null,this._imgId=0,this._clipid=-1,this._enbale=!1,this._colorFiler=null,this._clipMatrix=new p}n(CharSubmitCache,"laya.webgl.text.CharSubmitCache");var t=CharSubmitCache.prototype;return t.clear=function(){this._tex=null,this._imgId=-1,this._ndata=0,this._enbale=!1,this._colorFiler=null},t.destroy=function(){this.clear(),this._data.length=0,this._data=null},t.add=function(t,e,r,i,n,a){this._ndata>0&&(this._tex!=e||this._imgId!=r||this._clipid>=0&&this._clipid!=t._clipInfoID)&&this.submit(t),this._clipid=t._clipInfoID,t._globalClipMatrix.copyTo(this._clipMatrix),this._tex=e,this._imgId=r,this._colorFiler=t._colorFiler,this._data[this._ndata]=i,this._data[this._ndata+1]=n,this._data[this._ndata+2]=a,this._ndata+=3},t.getPos=function(){return 0==CharSubmitCache.__nPosPool?new Array(8):CharSubmitCache.__posPool[--CharSubmitCache.__nPosPool]},t.enable=function(t,e){t!==this._enbale&&(this._enbale=t,this._enbale||this.submit(e))},t.submit=function(t){var e=this._ndata;if(e){var r=t._mesh,i=t._colorFiler;t._colorFiler=this._colorFiler;var n=gt.create(t,r,w.create(1,0));t._submits[t._submits._length++]=t._curSubmit=n,n.shaderValue.textureHost=this._tex,n._key.other=this._imgId,t._colorFiler=i,t._copyClipInfo(n,this._clipMatrix),n.clipInfoID=this._clipid;for(var a=0;a<e;a+=3)r.addQuad(this._data[a],this._data[a+1],this._data[a+2],!0),CharSubmitCache.__posPool[CharSubmitCache.__nPosPool++]=this._data[a];e/=3,n._numEle+=6*e,r.indexNum+=6*e,r.vertNum+=4*e,t._drawCount+=e,this._ndata=0,R.loopCount%100==0&&(this._data.length=0)}},CharSubmitCache.__posPool=[],CharSubmitCache.__nPosPool=0,CharSubmitCache}(),xt=function(){function ShaderNode(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}n(ShaderNode,"laya.webgl.utils.ShaderNode");var t=ShaderNode.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++ShaderNode.__id)},t._toscript=function(t,e,r){if(this.childs.length<1&&!this.text)return e;e.length;if(this.condition){var i=!!this.condition.call(t);if(2===this.conditionType&&(i=!i),!i)return e}if(this.text&&e.push(this.text),this.childs.length>0&&this.childs.forEach(function(i,n,a){i._toscript(t,e,r)}),this.includefiles.length>0&&this.useFuns.length>0)for(var n,a=0,s=this.includefiles.length;a<s;a++)this.includefiles[a].curUseID!=r&&(n=this.includefiles[a].file.getFunsScript(this.useFuns)).length>0&&(this.includefiles[a].curUseID=r,e[0]=n+e[0]);return e},ShaderNode.__id=1,ShaderNode}(),pt=(function(){function CharInternalTexture(t){this._par=null,this._loaded=!0,this.bitmap={},this.bitmap.id=t.id,this._par=t}n(CharInternalTexture,"laya.webgl.resource.CharInternalTexture"),CharInternalTexture.prototype._getSource=function(){return this._par._source}}(),function(t){function RenderSprite3D(t,e){RenderSprite3D.__super.call(this,t,e)}n(RenderSprite3D,"laya.webgl.utils.RenderSprite3D",v);var e=RenderSprite3D.prototype;return e.onCreate=function(t){switch(t){case 4:return void(this._fun=this._blend)}},e._mask=function(t,e,r,i){var n=this._next,a=t.mask,s=e;if(a){s.save();var o=s.globalCompositeOperation,h=new m;if(h.copyFrom(a.getBounds()),h.width=Math.round(h.width),h.height=Math.round(h.height),h.x=Math.round(h.x),h.y=Math.round(h.y),h.width>0&&h.height>0){var u=h.width,l=h.height,c=at.getRT(u,l);s.breakNextMerge(),s.pushRT(),s.addRenderObject(it.create([s,c,u,l],laya.webgl.utils.RenderSprite3D.tmpTarget,this)),a.render(s,-h.x,-h.y),s.breakNextMerge(),s.popRT(),s.save(),s.clipRect(r+h.x-t.getStyle().pivotX,i+h.y-t.getStyle().pivotY,u,l),n._fun.call(n,t,s,r,i),s.restore(),o=s.globalCompositeOperation,s.addRenderObject(it.create(["mask"],laya.webgl.utils.RenderSprite3D.setBlendMode,this));var _=w.create(1,0),d=M.INV_UV;s.drawTarget(c,r+h.x-t.getStyle().pivotX,i+h.y-t.getStyle().pivotY,u,l,p.TEMP.identity(),_,d,6),s.addRenderObject(it.create([c],laya.webgl.utils.RenderSprite3D.recycleTarget,this)),s.addRenderObject(it.create([o],laya.webgl.utils.RenderSprite3D.setBlendMode,this))}s.restore()}else n._fun.call(n,t,e,r,i)},e._blend=function(t,e,r,i){var n=t._style,a=this._next;n.blendMode?(e.save(),e.globalCompositeOperation=n.blendMode,a._fun.call(a,t,e,r,i),e.restore()):a._fun.call(a,t,e,r,i)},RenderSprite3D.tmpTarget=function(t,e,r,i){e.start(),e.clear(0,0,0,0)},RenderSprite3D.recycleTarget=function(t){at.releaseRT(t)},RenderSprite3D.setBlendMode=function(t){var e=$.mainContext;k.targetFns[k.TOINT[t]](e)},i(RenderSprite3D,["tempUV",function(){return this.tempUV=new Array(8)}]),RenderSprite3D}()),bt=function(t){var e;function WebGLContext2D(){if(this._drawTriUseAbsMatrix=!1,this._id=++WebGLContext2D._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this.meshlist=[],this._clipInfoID=0,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._saveMark=null,this._drawTextureUseColor=!1,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this.drawTexAlign=!1,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,WebGLContext2D.__super.call(this),this._width=99999999,this._height=99999999,this._submitKey=new tt,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=WebGLContext2D.MAXCLIPRECT,this._globalClipMatrix=new p(99999999,0,0,99999999,0,0),this._shader2D=new B,this.mOutPoint,WebGLContext2D._contextcount++,!WebGLContext2D.defTexture){var t=new Nt(2,2);t.setPixels(new Uint8Array(16)),WebGLContext2D.defTexture=new M(t)}this._lastTex=WebGLContext2D.defTexture,this.clear()}n(WebGLContext2D,"laya.webgl.canvas.WebGLContext2D",c);var o=WebGLContext2D.prototype;return o.clearBG=function(t,e,r,i){var n=$.mainContext;n.clearColor(t,e,r,i),n.clear(16384)},o._getSubmits=function(){return this._submits},o._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null,this._charSubmitCache.clear();for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null;var r;for(t=0,r=this.meshlist.length;t<r;t++){this.meshlist[t].destroy()}this.meshlist.length=0,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}},o.destroy=function(){--WebGLContext2D._contextcount,this.sprite=null,this._releaseMem(),this._charSubmitCache.destroy(),this._targets&&this._targets.destroy(),this._targets=null,this._mesh.destroy()},o.clear=function(){this._submits||(this._other=e.DEFAULT,this._curMat=p.create(),this._charSubmitCache=new ft,this._mesh=Mt.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=Lt.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=yt.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[j.Create(this)],this._save.length=10,this._shader2D=new B),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=e.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=WebGLContext2D.MAXCLIPRECT,this._curSubmit=P.RENDERBASE,P.RENDERBASE._ref=16777215,P.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=_t.DEFAULT;for(var t=0,r=this._submits._length;t<r;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},o.size=function(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new Ot(t,e,1,-1)),T._context==this&&($.mainContext.viewport(0,0,t,e),ot.width=t,ot.height=e)),0===t&&0===e&&this._releaseMem()},o.getMatScaleX=function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b?this._lastMatScaleX:(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b,this._lastMatScaleX)},o.getMatScaleY=function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d?this._lastMatScaleY:(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d,this._lastMatScaleY)},o.setFillColor=function(t){this._fillColor=t},o.getFillColor=function(){return this._fillColor},o.translate=function(t,e){0===t&&0===e||(dt.save(this),this._curMat._bTransform?(I.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},o.save=function(){this._save[this._save._length++]=j.Create(this)},o.restore=function(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var r=t-1;r>=0;r--){var i=this._save[r];if(i.restore(this),i.isSaveMark())return void(this._save._length=r)}e!=this._nBlendType&&(this._curSubmit=P.RENDERBASE)}},o.fillText=function(t,e,r,i,n,a){this._fillText(t,null,e,r,i,n,null,0,null)},o._fillText=function(t,e,r,i,n,a,s,o,h,u){void 0===u&&(u=0),t?WebGLContext2D._textRender.filltext(this,t,r,i,n,a,s,o,h,u):e&&WebGLContext2D._textRender.fillWords(this,e,r,i,n,a,s,o)},o._fast_filltext=function(t,e,r,i,n,a,s,o,h){void 0===h&&(h=0),WebGLContext2D._textRender._fast_filltext(this,t,null,e,r,i,n,a,s,o,h)},o.fillWords=function(t,e,r,i,n){this._fillText(null,t,e,r,i,n,null,-1,null,0)},o.fillBorderWords=function(t,e,r,i,n,a,s){this._fillBorderText(null,t,e,r,i,n,a,s,null)},o.drawText=function(t,e,r,i,n,a){this._fillText(t,null,e,r,i,u.create(n).strColor,null,-1,a)},o.strokeWord=function(t,e,r,i,n,a,s){this._fillText(t,null,e,r,i,null,u.create(n).strColor,a||1,s)},o.fillBorderText=function(t,e,r,i,n,a,s,o){this._fillBorderText(t,null,e,r,i,u.create(n).strColor,u.create(a).strColor,s,o)},o._fillBorderText=function(t,e,r,i,n,a,s,o,h){this._fillText(t,e,r,i,n,a,s,o||1,h)},o._fillRect=function(t,e,r,i,n){var a=this._curSubmit,s=a&&2===a._key.submitType&&a._key.blendShader===this._nBlendType;this._mesh.vertNum+4>65535&&(this._mesh=Mt.getAMesh(),this.meshlist.push(this._mesh),s=!1),s&&(s=s&&this.isSameClipInfo(a)),this.transformQuad(t,e,r,i,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,M.NO_UV,n,!1),s||(a=this._curSubmit=gt.create(this,this._mesh,w.create(1,0)),this._submits[this._submits._length++]=a,this._copyClipInfo(a,this._globalClipMatrix),a.shaderValue.textureHost=this._lastTex,a._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,a._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},o.fillRect=function(t,e,r,i,n){var a=n?_t.create(n):this._shader2D.fillStyle,s=this.mixRGBandAlpha(a.toInt());this._fillRect(t,e,r,i,s)},o.fillTexture=function(t,e,i,n,a,s,o,h){if(t._getSource()){var u=this._curSubmit;this._mesh.vertNum+4>65535&&(this._mesh=Mt.getAMesh(),this.meshlist.push(this._mesh),!1);t.bitmap;var l=!0,c=!0;switch(s){case"repeat":break;case"repeat-x":c=!1;break;case"repeat-y":l=!1;break;case"no-repeat":l=c=!1}var _=this._temp4Points,d=0,f=0,x=0,p=0,b=0,m=0;if(o.x<0?(x=e,d=-o.x%t.width/t.width):x=e+o.x,o.y<0?(p=i,f=-o.y%t.height/t.height):p=i+o.y,b=e+n,m=i+a,!l&&(b=Math.min(b,e+o.x+t.width)),!c&&(m=Math.min(m,i+o.y+t.height)),!(b<e||m<i||x>b||p>m)){var T=(b-e-o.x)/t.width,v=(m-i-o.y)/t.height;if(this.transformQuad(x,p,b-x,m-p,0,this._curMat,this._transedPoints),_[0]=d,_[1]=f,_[2]=T,_[3]=f,_[4]=T,_[5]=v,_[6]=d,_[7]=v,!this.clipedOff(this._transedPoints)){var C=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,_,C,!0);var g=w.create(1,0);g.defines.add(256),g.u_TexRange=t.uvrect,u=this._curSubmit=gt.create(this,this._mesh,g),this._submits[this._submits._length++]=u,this._copyClipInfo(u,this._globalClipMatrix),u.shaderValue.textureHost=t,u._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}}else this.sprite&&r.systemTimer.callLater(this,this._repaintSprite)},o.setColorFilter=function(t){D.save(this,8388608,this,!0),this._colorFiler=t,this._curSubmit=P.RENDERBASE},o.drawTexture=function(t,e,r,i,n){this._drawTextureM(t,e,r,i,n,null,1,null)},o.drawTextures=function(t,e,i,n){if(t._getSource())for(var a=e.length/2,s=0,o=0;o<a;o++)this._inner_drawTexture(t,t.bitmap.id,e[s++]+i,e[s++]+n,0,0,null,null,1,!1);else this.sprite&&r.systemTimer.callLater(this,this._repaintSprite)},o._drawTextureAddSubmit=function(t,e){var r=null;r=gt.create(this,this._mesh,w.create(1,0)),this._submits[this._submits._length++]=r,r.shaderValue.textureHost=e,r._key.other=t,r._renderType=10016,this._curSubmit=r},o._drawTextureM=function(t,e,i,n,a,s,o,h){return t._getSource()?this._inner_drawTexture(t,t.bitmap.id,e,i,n,a,s,h,o,!1):(this.sprite&&r.systemTimer.callLater(this,this._repaintSprite),!1)},o._drawRenderTexture=function(t,e,r,i,n,a,s,o){return this._inner_drawTexture(t,-1,e,r,i,n,a,o,1,!1)},o.submitDebugger=function(){this._submits[this._submits._length++]=it.create([],function(){},this)},o._copyClipInfo=function(t,e){var r=t.shaderValue.clipMatDir;r[0]=e.a,r[1]=e.b,r[2]=e.c,r[3]=e.d;var i=t.shaderValue.clipMatPos;i[0]=e.tx,i[1]=e.ty,t.clipInfoID=this._clipInfoID},o.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},o._useNewTex2DSubmit=function(t,e){this._mesh.vertNum+e>65535&&(this._mesh=Mt.getAMesh(),this.meshlist.push(this._mesh));var r=gt.create(this,this._mesh,w.create(1,0));this._submits[this._submits._length++]=this._curSubmit=r,r.shaderValue.textureHost=t,this._copyClipInfo(r,this._globalClipMatrix)},o._drawTexRect=function(t,e,r,i,n){this.transformQuad(t,e,r,i,this._italicDeg,this._curMat,this._transedPoints);var a=this._transedPoints;a[0]=a[0]+.5|0,a[1]=a[1]+.5|0,a[2]=a[2]+.5|0,a[3]=a[3]+.5|0,a[4]=a[4]+.5|0,a[5]=a[5]+.5|0,a[6]=a[6]+.5|0,a[7]=a[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,n,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},o.drawCallOptimize=function(t){return this._charSubmitCache.enable(t,this),t},o._inner_drawTexture=function(t,e,r,i,n,a,s,o,h,u){var l=this._curSubmit._key;if(o=o||t._uv,4===l.submitType&&l.other===e){var c=WebGLContext2D._drawTexToDrawTri_Vert;return c[0]=r,c[1]=i,c[2]=r+n,c[3]=i,c[4]=r+n,c[5]=i+a,c[6]=r,c[7]=i+a,this._drawTriUseAbsMatrix=!0,this.drawTriangles(t,0,0,c,o,WebGLContext2D._drawTexToDrawTri_Index,s,h,null,"normal"),this._drawTriUseAbsMatrix=!1,!0}var _=u?this._charSubmitCache.getPos():this._transedPoints;this.transformQuad(r,i,n||t.width,a||t.height,this._italicDeg,s||this._curMat,_),this.drawTexAlign&&(_[0]=Math.round(_[0]),_[1]=Math.round(_[1]),_[2]=Math.round(_[2]),_[3]=Math.round(_[3]),_[4]=Math.round(_[4]),_[5]=Math.round(_[5]),_[6]=Math.round(_[6]),_[7]=Math.round(_[7]),this.drawTexAlign=!1);var d=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h);if(u)return this._charSubmitCache.add(this,t,e,_,o,d),!0;this._drawCount++;var f=e>=0&&2===l.submitType&&l.other===e;if(f&&(f=f&&this.isSameClipInfo(this._curSubmit)),this._lastTex=t,this._mesh.vertNum+4>65535&&(this._mesh=Mt.getAMesh(),this.meshlist.push(this._mesh),f=!1),!this.clipedOff(this._transedPoints)){if(this._mesh.addQuad(_,o,d,!0),!f){var x=gt.create(this,this._mesh,w.create(1,0));this._submits[this._submits._length++]=this._curSubmit=x,x.shaderValue.textureHost=t,x._key.other=e,this._copyClipInfo(x,this._globalClipMatrix)}return this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,!0}return!1},o.transform4Points=function(t,e,r){var i=e.tx,n=e.ty;e._bTransform?(r[0]=t[0]*e.a+t[1]*e.c+i,r[1]=t[0]*e.b+t[1]*e.d+n,r[2]=t[2]*e.a+t[3]*e.c+i,r[3]=t[2]*e.b+t[3]*e.d+n,r[4]=t[4]*e.a+t[5]*e.c+i,r[5]=t[4]*e.b+t[5]*e.d+n,r[6]=t[6]*e.a+t[7]*e.c+i,r[7]=t[6]*e.b+t[7]*e.d+n):(r[0]=t[0]+i,r[1]=t[1]+n,r[2]=t[2]+i,r[3]=t[3]+n,r[4]=t[4]+i,r[5]=t[5]+n,r[6]=t[6]+i,r[7]=t[7]+n)},o.clipedOff=function(t){return this._clipRect.width<=0||this._clipRect.height<=0},o.transformQuad=function(t,e,r,i,n,a,s){var o=0;0!=n&&(o=Math.tan(n*Math.PI/180)*i);var h=t+r,u=e+i;this._temp4Points[0]=t+o,this._temp4Points[1]=e,this._temp4Points[2]=h+o,this._temp4Points[3]=e,this._temp4Points[4]=h,this._temp4Points[5]=u,this._temp4Points[6]=t,this._temp4Points[7]=u,this.transform4Points(this._temp4Points,a,s)},o.pushRT=function(){this.addRenderObject(it.create(null,Ot.pushRT,this))},o.popRT=function(){this.addRenderObject(it.create(null,Ot.popRT,this)),this.breakNextMerge()},o.useRT=function(t){this.addRenderObject(it.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()},o.RTRestore=function(t){this.addRenderObject(it.create([t],function(t){t.restore()},this)),this.breakNextMerge()},o.breakNextMerge=function(){this._curSubmit=P.RENDERBASE},o._repaintSprite=function(){this.sprite&&this.sprite.repaint()},o.drawTextureWithTransform=function(t,e,r,i,n,a,s,o,h,u,l){var c=null;u&&(c=this.globalCompositeOperation,this.globalCompositeOperation=u);var _=this._colorFiler;if(l&&this.setColorFilter(l),!a)return this._drawTextureM(t,e+s,r+o,i,n,null,h,null),u&&(this.globalCompositeOperation=c),void(l&&this.setColorFilter(_));var d=this._curMat;WebGLContext2D._tmpMatrix.a=a.a,WebGLContext2D._tmpMatrix.b=a.b,WebGLContext2D._tmpMatrix.c=a.c,WebGLContext2D._tmpMatrix.d=a.d,WebGLContext2D._tmpMatrix.tx=a.tx+s,WebGLContext2D._tmpMatrix.ty=a.ty+o,WebGLContext2D._tmpMatrix._bTransform=a._bTransform,a&&d._bTransform?(p.mul(WebGLContext2D._tmpMatrix,d,WebGLContext2D._tmpMatrix),(a=WebGLContext2D._tmpMatrix)._bTransform=!0):a=WebGLContext2D._tmpMatrix,this._drawTextureM(t,e,r,i,n,a,h,null),u&&(this.globalCompositeOperation=c),l&&this.setColorFilter(_)},o._flushToTarget=function(t,e){ot.worldScissorTest=!1,$.mainContext.disable(3089);var r=ot.worldAlpha,i=ot.worldMatrix4,n=ot.worldMatrix;ot.worldShaderDefines;ot.worldMatrix=p.EMPTY,ot.restoreTempArray(),ot.worldMatrix4=ot.TEMPMAT4_ARRAY,ot.worldAlpha=1,wt.activeShader=null,e.start(),t._submits._length>0&&e.clear(0,0,0,0),t._curSubmit=P.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=P.RENDERBASE,wt.activeShader=null,ot.worldAlpha=r,ot.worldMatrix4=i,ot.worldMatrix=n},o.drawCanvas=function(t,e,r,i,n){if(t){var a,s=t.context;if(s._targets)s._submits._length>0&&(a=it.create([s,s._targets],this._flushToTarget,this),this._submits[this._submits._length++]=a),this._drawRenderTexture(s._targets,e,r,i,n,null,1,Ot.flipyuv),this._curSubmit=P.RENDERBASE;else{var o=t;o.touches&&o.touches.forEach(function(t){t.touch()}),a=St.create(t,this._shader2D.ALPHA,this._shader2D.filters),this._submits[this._submits._length++]=a,a._key.clear();var h=a._matrix;this._curMat.copyTo(h);var u=h.tx,l=h.ty;h.tx=h.ty=0,h.transformPoint(b.TEMP.setTo(e,r)),h.translate(b.TEMP.x+u,b.TEMP.y+l),p.mul(o.invMat,h,h),this._curSubmit=P.RENDERBASE}}},o.drawTarget=function(t,e,r,i,n,a,s,o,h){void 0===h&&(h=-1),this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);if(this._mesh.vertNum+4>65535&&(this._mesh=Mt.getAMesh(),this.meshlist.push(this._mesh)),this.transformQuad(e,r,i,n,0,a||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,o||M.DEF_UV,4294967295,!0);var u=this._curSubmit=X.create(this,this._mesh,s,t);return u.blendType=-1==h?this._nBlendType:h,this._copyClipInfo(u,this._globalClipMatrix),u._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._maxNumEle=Math.max(this._maxNumEle,u._numEle),this._submits[this._submits._length++]=u,this._curSubmit=P.RENDERBASE,!0}return this._curSubmit=P.RENDERBASE,!1},o.drawTriangles=function(t,e,i,n,a,s,o,h,u,l){if(t._getSource()){this._drawCount++;var c=null,_=!1;u&&(c=this._colorFiler,this._colorFiler=u,this._curSubmit=P.RENDERBASE,_=c!=u);var d=t.bitmap,f=this._curSubmit._key,x=4===f.submitType&&f.other===d.id&&f.blendShader==this._nBlendType,b=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h),m=n.length/2,T=s.length;if(this._triangleMesh.vertNum+m>65535&&(this._triangleMesh=yt.getAMesh(),this.meshlist.push(this._triangleMesh),x=!1),!x){var v=this._curSubmit=gt.create(this,this._triangleMesh,w.create(1,0));v.shaderValue.textureHost=t,v._renderType=10016,v._key.submitType=4,v._key.other=d.id,this._copyClipInfo(v,this._globalClipMatrix),this._submits[this._submits._length++]=v}o?(WebGLContext2D._tmpMatrix.a=o.a,WebGLContext2D._tmpMatrix.b=o.b,WebGLContext2D._tmpMatrix.c=o.c,WebGLContext2D._tmpMatrix.d=o.d,WebGLContext2D._tmpMatrix.tx=o.tx+e,WebGLContext2D._tmpMatrix.ty=o.ty+i):(WebGLContext2D._tmpMatrix.a=1,WebGLContext2D._tmpMatrix.b=0,WebGLContext2D._tmpMatrix.c=0,WebGLContext2D._tmpMatrix.d=1,WebGLContext2D._tmpMatrix.tx=e,WebGLContext2D._tmpMatrix.ty=i),this._drawTriUseAbsMatrix||p.mul(WebGLContext2D._tmpMatrix,this._curMat,WebGLContext2D._tmpMatrix),this._triangleMesh.addData(n,a,s,WebGLContext2D._tmpMatrix,b,this),this._curSubmit._numEle+=T,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),_&&(this._colorFiler=c,this._curSubmit=P.RENDERBASE)}else this.sprite&&r.systemTimer.callLater(this,this._repaintSprite)},o.transform=function(t,e,r,i,n,a){I.save(this),p.mul(p.TEMP.setTo(t,e,r,i,n,a),this._curMat,this._curMat),this._curMat._checkTransform()},o._transformByMatrix=function(t,e,r){t.setTranslate(e,r),p.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},o.setTransformByMatrix=function(t){t.copyTo(this._curMat)},o.rotate=function(t){I.save(this),this._curMat.rotateEx(t)},o.scale=function(t,e){I.save(this),this._curMat.scaleEx(t,e)},o.clipRect=function(t,e,r,i){ht.save(this),this._clipRect==WebGLContext2D.MAXCLIPRECT?this._clipRect=new m(t,e,r,i):(this._clipRect.width=r,this._clipRect.height=i,this._clipRect.x=t,this._clipRect.y=e),WebGLContext2D._clipID_Gen++,WebGLContext2D._clipID_Gen%=1e4,this._clipInfoID=WebGLContext2D._clipID_Gen;var n=this._globalClipMatrix,a=n.tx,s=n.ty,o=a+n.a,h=s+n.d;if(this._clipRect.width>=99999999?(n.a=n.d=99999999,n.b=n.c=n.tx=n.ty=0):this._curMat._bTransform?(n.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,n.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,n.a=this._clipRect.width*this._curMat.a,n.b=this._clipRect.width*this._curMat.b,n.c=this._clipRect.height*this._curMat.c,n.d=this._clipRect.height*this._curMat.d):(n.tx=this._clipRect.x+this._curMat.tx,n.ty=this._clipRect.y+this._curMat.ty,n.a=this._clipRect.width,n.b=n.c=0,n.d=this._clipRect.height),n.a>0&&n.d>0){var u=n.tx+n.a,l=n.ty+n.d;u<=a||l<=s||n.tx>=o||n.ty>=h?(n.a=-.1,n.d=-.1):(n.tx<a&&(n.a-=a-n.tx,n.tx=a),u>o&&(n.a-=u-o),n.ty<s&&(n.d-=s-n.ty,n.ty=s),l>h&&(n.d-=l-h),n.a<=0&&(n.a=-.1),n.d<=0&&(n.d=-.1))}},o.drawMesh=function(t,e,r,i,n,a,s,o,h){void 0===h&&(h=0)},o.addRenderObject=function(t){this._submits[this._submits._length++]=t},o.submitElement=function(t,e){T._context;var r=this._submits,i=r._length;e<0&&(e=r._length);for(var n=P.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,r[t]!==P.RENDERBASE?(P.preRender=n,t+=(n=r[t]).renderSubmit()):t++;return i},o.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),J.instance&&J.getInstance().reset(),this._curSubmit=P.RENDERBASE;for(var e=0,i=this.meshlist.length;e<i;e++){var n=this.meshlist[e];n.canReuse?n.releaseMesh():n.destroy()}if(this.meshlist.length=0,this._mesh=Mt.getAMesh(),this._pathMesh=Lt.getAMesh(),this._triangleMesh=yt.getAMesh(),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%60==0&&T._context==this){var a=r.textRender;a&&a.GC(!1)}return t},o.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=L.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},o.beginPath=function(t){void 0===t&&(t=!1),this._getPath().beginPath(t)},o.closePath=function(){this._path.closePath()},o.addPath=function(t,e,r,i,n){for(var a=0,s=0,o=t.length/2;s<o;s++){var h=t[a]+i,u=t[a+1]+n;t[a]=h,t[a+1]=u,a+=2}this._getPath().push(t,r)},o.fill=function(){var t=this._curMat,e=this._getPath(),r=this._curSubmit,i=3===r._key.submitType&&r._key.blendShader===this._nBlendType;i&&(i=i&&this.isSameClipInfo(r)),i||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var n,a=this.mixRGBandAlpha(this.fillStyle.toInt()),s=0,o=0,h=e.paths.length;o<h;o++){var u=e.paths[o],l=u.path.length/2;if(!(l<3||3==l&&!u.convex)){var c=u.path.concat(),_=0,d=0,f=0,x=NaN,p=NaN;if(t._bTransform)for(_=0;_<l;_++)f=(d=_<<1)+1,x=c[d],p=c[f],c[d]=t.a*x+t.c*p+t.tx,c[f]=t.b*x+t.d*p+t.ty;else for(_=0;_<l;_++)f=(d=_<<1)+1,x=c[d],p=c[f],c[d]=x+t.tx,c[f]=p+t.ty;this._pathMesh.vertNum+l>65535&&(this._curSubmit._numEle+=s,s=0,this._pathMesh=Lt.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));var b=this._pathMesh.vertNum;if(u.convex){var m=l-2;n=new Array(3*m);for(var T=0,v=0;v<m;v++)n[T++]=b,n[T++]=v+1+b,n[T++]=v+2+b}else if(n=rt.earcut(c,null,2),b>0)for(var C=0;C<n.length;C++)n[C]+=b;this._pathMesh.addVertAndIBToMesh(this,c,a,n),s+=n.length}}this._curSubmit._numEle+=s},o.addVGSubmit=function(t){var e=P.createShape(this,t,0,w.create(4,0));return e._key.submitType=3,this._submits[this._submits._length++]=e,this._copyClipInfo(e,this._globalClipMatrix),e},o.stroke=function(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),r=this._curSubmit,i=3===r._key.submitType&&r._key.blendShader===this._nBlendType;i&&(i=i&&this.isSameClipInfo(r)),i||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var n=0,a=0,s=e.paths.length;a<s;a++){var o=e.paths[a];if(!(o.path.length<=0)){var h=[],u=[],l=2*o.path.length;if(!(l<2)){this._pathMesh.vertNum+l>65535&&(this._curSubmit._numEle+=n,n=0,this._pathMesh=Lt.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),Q.createLine2(o.path,h,this.lineWidth,this._pathMesh.vertNum,u,o.loop);var c=u.length/2,_=this._curMat,d=0,f=0,x=0,p=NaN,b=NaN;if(_._bTransform)for(d=0;d<c;d++)x=(f=d<<1)+1,p=u[f],b=u[x],u[f]=_.a*p+_.c*b+_.tx,u[x]=_.b*p+_.d*b+_.ty;else for(d=0;d<c;d++)x=(f=d<<1)+1,p=u[f],b=u[x],u[f]=p+_.tx,u[x]=b+_.ty;this._pathMesh.addVertAndIBToMesh(this,u,t,h),n+=h.length}}}this._curSubmit._numEle+=n}},o.moveTo=function(t,e){var r=this._getPath();r.newPath(),r._lastOriX=t,r._lastOriY=e,r.addPoint(t,e)},o.lineTo=function(t,e){var r=this._getPath();Math.abs(t-r._lastOriX)<.001&&Math.abs(e-r._lastOriY)<.001||(r._lastOriX=t,r._lastOriY=e,r.addPoint(t,e))},o.arcTo=function(t,e,r,i,n){var a=0,s=0,o=0,h=this._path._lastOriX-t,u=this._path._lastOriY-e,l=Math.sqrt(h*h+u*u);if(!(l<=1e-6)){var c=h/l,_=u/l,d=r-t,f=i-e,x=d*d+f*f,p=Math.sqrt(x);if(!(p<=1e-6)){var b=d/p,m=f/p,T=c+b,v=_+m,C=Math.sqrt(T*T+v*v);if(!(C<=1e-6)){var g=T/C,y=v/C,S=Math.acos(g*c+y*_),R=Math.PI/2-S,E=(l=n/Math.tan(R))*c+t,A=l*_+e,M=Math.sqrt(l*l+n*n),L=t+g*M,D=e+y*M,w=0,B=0;if(c*m-_*b>=0){var G=2*R/WebGLContext2D.SEGNUM;w=Math.sin(G),B=Math.cos(G)}else G=2*-R/WebGLContext2D.SEGNUM,w=Math.sin(G),B=Math.cos(G);var W=this._path._lastOriX,I=this._path._lastOriY,P=E,O=A;(Math.abs(P-this._path._lastOriX)>.1||Math.abs(O-this._path._lastOriY)>.1)&&(s=P,o=O,W=P,I=O,this._path.addPoint(s,o));var N=E-L,F=A-D;for(a=0;a<WebGLContext2D.SEGNUM;a++){var V=N*B+F*w,U=-N*w+F*B;s=V+L,o=U+D,(Math.abs(W-s)>.1||Math.abs(I-o)>.1)&&(this._path.addPoint(s,o),W=s,I=o),N=V,F=U}}}}},o.arc=function(t,e,r,i,n,a,s){void 0===a&&(a=!1),void 0===s&&(s=!0);var o,h,u=0,l=0,c=0,_=0,d=0,f=0,x=0;if(l=n-i,a)if(Math.abs(l)>=2*Math.PI)l=2*-Math.PI;else for(;l>0;)l-=2*Math.PI;else if(Math.abs(l)>=2*Math.PI)l=2*Math.PI;else for(;l<0;)l+=2*Math.PI;var p=this.getMatScaleX(),b=this.getMatScaleY(),m=r*(p>b?p:b),T=2*Math.PI*m;o=l/(h=0|Math.max(T/10,10))/2,c=Math.abs(4/3*(1-Math.cos(o))/Math.sin(o)),a&&(c=-c);var v=this._getPath();for(x=0;x<=h;x++)u=i+l*(x/h),_=Math.cos(u),f=e+Math.sin(u)*r,(d=t+_*r)==this._path._lastOriX&&f==this._path._lastOriY||v.addPoint(d,f);_=Math.cos(n),f=e+Math.sin(n)*r,(d=t+_*r)==this._path._lastOriX&&f==this._path._lastOriY||v.addPoint(d,f)},o.quadraticCurveTo=function(t,e,r,i){for(var n=s.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,r,i],30,2),a=0,o=n.length/2;a<o;a++)this.lineTo(n[2*a],n[2*a+1]);this.lineTo(r,i)},o.rect=function(t,e,r,i){this._other=this._other.make(),this._other.path||(this._other.path=new ut),this._other.path.rect(t,e,r,i)},o.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},o._mixRGBandAlpha=function(t,e){var r=(4278190080&t)>>>24;return 0!=r?r*=e:r=255*e,16777215&t|r<<24},o.strokeRect=function(t,e,r,i,n){if(this.lineWidth>0){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor),s=this.lineWidth/2;this._fillRect(t-s,e-s,r+this.lineWidth,this.lineWidth,a),this._fillRect(t-s,e-s+i,r+this.lineWidth,this.lineWidth,a),this._fillRect(t-s,e+s,this.lineWidth,i-this.lineWidth,a),this._fillRect(t-s+r,e+s,this.lineWidth,i-this.lineWidth,a)}},o.clip=function(){},o.drawParticle=function(t,e,r){r.x=t,r.y=e,this._submits[this._submits._length++]=r},o._getPath=function(){return this._path||(this._path=new ut)},a(0,o,"globalCompositeOperation",function(){return k.NAMES[this._nBlendType]},function(t){var e=k.TOINT[t];null==e||this._nBlendType===e||(D.save(this,65536,this,!0),this._curSubmit=P.RENDERBASE,this._nBlendType=e)}),a(0,o,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(D.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=_t.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),a(0,o,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(D.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=t)}),a(0,o,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new Ot(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}),a(0,o,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(D.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=_t.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),a(0,o,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),D.save(this,32768,this._other,!1),this._other.textAlign=t)}),a(0,o,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),D.save(this,256,this._other,!1),this._other.lineWidth=t)}),a(0,o,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),D.save(this,16384,this._other,!1),this._other.textBaseline=t)}),a(0,o,"font",null,function(t){this._other=this._other.make(),D.save(this,8,this._other,!1)}),a(0,o,"canvas",function(){return this._canvas}),WebGLContext2D.__init__=function(){e.DEFAULT=new e},WebGLContext2D.set2DRenderConfig=function(){var t=V.instance;ct.setBlend(t,!0),ct.setBlendFunc(t,1,771),ct.setDepthTest(t,!1),ct.setCullFace(t,!1),ct.setDepthMask(t,!0),ct.setFrontFace(t,2305),t.viewport(0,0,ot.width,ot.height)},WebGLContext2D._tempPoint=new b,WebGLContext2D._SUBMITVBSIZE=32e3,WebGLContext2D._MAXSIZE=99999999,WebGLContext2D._MAXVERTNUM=65535,WebGLContext2D.MAXCLIPRECT=new m(0,0,99999999,99999999),WebGLContext2D._COUNT=0,WebGLContext2D._tmpMatrix=new p,WebGLContext2D.SEGNUM=32,WebGLContext2D._contextcount=0,WebGLContext2D._clipID_Gen=0,WebGLContext2D.defTexture=null,i(WebGLContext2D,["_drawStyleTemp",function(){return this._drawStyleTemp=new _t(null)},"_keyMap",function(){return this._keyMap=new E},"_drawTexToDrawTri_Vert",function(){return this._drawTexToDrawTri_Vert=new Float32Array(8)},"_drawTexToDrawTri_Index",function(){return this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3])},"_textRender",function(){return this._textRender=new lt}]),WebGLContext2D.__init$=function(){e=function(){function ContextParams(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null}n(ContextParams,"");var t=ContextParams.prototype;return t.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null},t.make=function(){return this===ContextParams.DEFAULT?new ContextParams:this},ContextParams.DEFAULT=null,ContextParams}()},WebGLContext2D}(),mt=function(t){function SkinSV(t){this.texcoord=null,this.position=null,this.offsetX=300,this.offsetY=0,SkinSV.__super.call(this,512,0);var e=8*O.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*O.BYTES_PE],this.color=[4,5126,!1,e,4*O.BYTES_PE]}return n(SkinSV,"laya.webgl.shader.d2.skinAnishader.SkinSV",w),SkinSV}(),Tt=function(t){function PrimitiveSV(t){PrimitiveSV.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return n(PrimitiveSV,"laya.webgl.shader.d2.value.PrimitiveSV",w),PrimitiveSV}(),vt=function(t){function TextureSV(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),TextureSV.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}return n(TextureSV,"laya.webgl.shader.d2.value.TextureSV",w),TextureSV.prototype.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+($.shaderHighPrecision?1024:0)},TextureSV}(),Ct=function(t){function Buffer2D(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,Buffer2D.__super.call(this)}n(Buffer2D,"laya.webgl.utils.Buffer2D",G);var e=Buffer2D.prototype;return e.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},e.needSize=function(t){var e=this._byteLength;if(t){var r=this._byteLength+t;r<=this._bufferSize||this._resizeBuffer(r<<1,!0),this._byteLength=r}return e},e._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),R.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,V.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),V.instance.bufferSubData(this._bufferType,0,this._buffer)},e._bufferSubData=function(t,e,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this._maxsize=Math.max(this._maxsize,this._byteLength),R.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,V.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),e||r){var i=this._buffer.slice(e,r);V.instance.bufferSubData(this._bufferType,t,i)}else V.instance.bufferSubData(this._bufferType,t,this._buffer)},e._checkArrayUse=function(){},e._bind_uploadForVAO=function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)},e._bind_upload=function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)},e._bind_subUpload=function(t,e,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(t,e,r),!0)},e._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(e&&this._buffer&&this._buffer.byteLength>0){var r=new ArrayBuffer(t),i=this._u8Array&&this._u8Array.buffer==this._buffer?this._u8Array:new Uint8Array(this._buffer);this._u8Array=new Uint8Array(r),this._u8Array.set(i,0),this._buffer=r}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this._bufferSize=this._buffer.byteLength,this},e.append=function(t){this._upload=!0;var e,r;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),r=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),r=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),r=new Float32Array(this._buffer,this._byteLength)),r.set(t,0),this._byteLength+=e,this._checkArrayUse()},e.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var r=new Uint16Array(this._buffer,this._byteLength,e),i=0;i<e;i++)r[i]=t[i];this._byteLength+=2*e,this._checkArrayUse()},e.appendEx=function(t,e){this._upload=!0;var r;r=t.byteLength,this._resizeBuffer(this._byteLength+r,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=r,this._checkArrayUse()},e.appendEx2=function(t,e,r,i){void 0===i&&(i=1),this._upload=!0;var n,a;n=r*i,this._resizeBuffer(this._byteLength+n,!0),a=new e(this._buffer,this._byteLength);var s=0;for(s=0;s<r;s++)a[s]=t[s];this._byteLength+=n,this._checkArrayUse()},e.getBuffer=function(){return this._buffer},e.setNeedUpload=function(){this._upload=!0},e.getNeedUpload=function(){return this._upload},e.upload=function(){var t=this._bind_upload();return V.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(G._bindedVertexBuffer=null),34963==this._bufferType&&(G._bindedIndexBuffer=null),wt.activeShader=null,t},e.subUpload=function(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0);var i=this._bind_subUpload();return V.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(G._bindedVertexBuffer=null),34963==this._bufferType&&(G._bindedIndexBuffer=null),wt.activeShader=null,i},e._disposeResource=function(){this._upload=!0,this._uploadSize=0},e.clear=function(){this._byteLength=0,this._upload=!0},a(0,e,"bufferLength",function(){return this._buffer.byteLength}),a(0,e,"byteLength",null,function(t){this.setByteLength(t)}),Buffer2D.__int__=function(t){},Buffer2D.FLOAT32=4,Buffer2D.SHORT=2,Buffer2D}(),gt=function(t){function SubmitTexture(t){void 0===t&&(t=1e4),SubmitTexture.__super.call(this,t)}n(SubmitTexture,"laya.webgl.submit.SubmitTexture",P);var e=SubmitTexture.prototype;return e.clone=function(t,e,r){var i=SubmitTexture._poolSize?SubmitTexture.POOL[--SubmitTexture._poolSize]:new SubmitTexture;return this._cloneInit(i,t,e,r),i},e.releaseRender=function(){--this._ref<1&&(SubmitTexture.POOL[SubmitTexture._poolSize++]=this,this.shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var r=$.mainContext;this._mesh.useMesh(r);var i=P.preRender,n=P.preRender._key;return 0===this._key.blendShader&&this._key.submitType===n.submitType&&this._key.blendShader===n.blendShader&&wt.activeShader&&P.preRender.clipInfoID==this.clipInfoID&&i.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&At.NOOPTMASK)?wt.activeShader.uploadTexture2D(e):(k.activeBlendFunction!==this._blendFn&&(ct.setBlend(r,!0),this._blendFn(r),k.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),r.drawElements(4,this._numEle,5123,this._startIdx),R.renderBatch++,R.trianglesFaces+=this._numEle/3,1},SubmitTexture.create=function(t,e,r){var i=SubmitTexture._poolSize?SubmitTexture.POOL[--SubmitTexture._poolSize]:new SubmitTexture(10016);i._mesh=e,i._key.clear(),i._key.submitType=2,i._ref=1,i._startIdx=e.indexNum*O.BYTES_PIDX,i._numEle=0;var n=t._nBlendType;if(i._key.blendShader=n,i._blendFn=t._targets?k.targetFns[n]:k.fns[n],i.shaderValue=r,t._colorFiler){var a=t._colorFiler;r.defines.add(a.type),r.colorMat=a._mat,r.colorAlpha=a._alpha}return i},SubmitTexture._poolSize=0,SubmitTexture.POOL=[],SubmitTexture}(),yt=(function(t){function MeshParticle2D(t){MeshParticle2D.__super.call(this,laya.webgl.utils.MeshParticle2D.const_stride,4*t*MeshParticle2D.const_stride,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo),this.createQuadIB(t),this._quadNum=t}n(MeshParticle2D,"laya.webgl.utils.MeshParticle2D",F);var e=MeshParticle2D.prototype;e.setMaxParticleNum=function(t){this._vb._resizeBuffer(4*t*MeshParticle2D.const_stride,!1),this.createQuadIB(t)},e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshParticle2D._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()},MeshParticle2D.getAMesh=function(t){if(laya.webgl.utils.MeshParticle2D._POOL.length){var e=laya.webgl.utils.MeshParticle2D._POOL.pop();return e.setMaxParticleNum(t),e}return new MeshParticle2D(t)},MeshParticle2D.const_stride=116,MeshParticle2D._POOL=[],i(MeshParticle2D,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}])}(),function(t){function MeshTexture(){MeshTexture.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}n(MeshTexture,"laya.webgl.utils.MeshTexture",F);var e=MeshTexture.prototype;return e.addData=function(t,e,r,i,n,a){for(var s=t.length/2,o=this._vb.needSize(s*MeshTexture.const_stride)>>2,h=this._vb._floatArray32||this._vb.getFloat32Array(),u=this._vb._uint32Array,l=0,c=0;c<s;c++){var _=t[l],d=t[l+1],f=_*i.a+d*i.c+i.tx,x=_*i.b+d*i.d+i.ty;h[o++]=f,h[o++]=x,h[o++]=e[l],h[o++]=e[l+1],l+=2,u[o++]=n,u[o++]=255}this._vb.setNeedUpload();var p=this.vertNum;if(p>0){var b=r.length;b>MeshTexture.tmpIdx.length&&(MeshTexture.tmpIdx=new Uint16Array(b));for(var m=0;m<b;m++)MeshTexture.tmpIdx[m]=r[m]+p;this._ib.appendU16Array(MeshTexture.tmpIdx,r.length)}else this._ib.append(r);this._ib.setNeedUpload(),this.vertNum+=s,this.indexNum+=r.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},MeshTexture.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new MeshTexture},MeshTexture.const_stride=24,MeshTexture._POOL=[],i(MeshTexture,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),MeshTexture}()),St=function(t){function SubmitCanvas(){this._matrix=new p,this._matrix4=O.defaultMatrix4.concat(),SubmitCanvas.__super.call(this,1e4),this.shaderValue=new w(0,0)}n(SubmitCanvas,"laya.webgl.submit.SubmitCanvas",P);var e=SubmitCanvas.prototype;return e.renderSubmit=function(){var t=ot.worldAlpha,e=ot.worldMatrix4,r=ot.worldMatrix,i=ot.worldFilters,n=ot.worldShaderDefines,a=this.shaderValue,s=this._matrix,o=this._matrix4,h=p.TEMP;return p.mul(s,r,h),o[0]=h.a,o[1]=h.b,o[4]=h.c,o[5]=h.d,o[12]=h.tx,o[13]=h.ty,ot.worldMatrix=h.clone(),ot.worldMatrix4=o,ot.worldAlpha=ot.worldAlpha*a.alpha,a.filters&&a.filters.length&&(ot.worldFilters=a.filters,ot.worldShaderDefines=a.defines),this.canv.flushsubmit(),ot.worldAlpha=t,ot.worldMatrix4=e,ot.worldMatrix.destroy(),ot.worldMatrix=r,ot.worldFilters=i,ot.worldShaderDefines=n,1},e.releaseRender=function(){if(--this._ref<1){var t=SubmitCanvas.POOL;this._mesh=null,t[t._length++]=this}},e.clone=function(t,e,r){return null},e.getRenderType=function(){return 10003},SubmitCanvas.create=function(t,e,r){var i=SubmitCanvas.POOL._length?SubmitCanvas.POOL[--SubmitCanvas.POOL._length]:new SubmitCanvas;i.canv=t,i._ref=1,i._numEle=0;var n=i.shaderValue;return n.alpha=e,n.defines.setValue(0),r&&r.length&&n.setFilters(r),i},SubmitCanvas.POOL=(SubmitCanvas.POOL=[],SubmitCanvas.POOL._length=0,SubmitCanvas.POOL),SubmitCanvas}(),Rt=function(r){function CharRender_Canvas(r,i,n,a,s){this.lastScaleX=1,this.lastScaleY=1,this.needResetScale=!1,this.maxTexW=0,this.maxTexH=0,this.scaleFontSize=!0,this.showDbgInfo=!1,this.supportImageData=!0,CharRender_Canvas.__super.call(this),void 0===n&&(n=!0),void 0===a&&(a=!0),void 0===s&&(s=!1),this.maxTexW=r,this.maxTexH=i,this.scaleFontSize=n,this.supportImageData=a,this.showDbgInfo=s,CharRender_Canvas.canvas||(CharRender_Canvas.canvas=t.document.createElement("canvas"),CharRender_Canvas.canvas.width=1024,CharRender_Canvas.canvas.height=512,CharRender_Canvas.canvas.style.left="-10000px",CharRender_Canvas.canvas.style.position="absolute",e.body.appendChild(CharRender_Canvas.canvas),CharRender_Canvas.ctx=CharRender_Canvas.canvas.getContext("2d"))}n(CharRender_Canvas,"laya.webgl.resource.CharRender_Canvas",z);var i=CharRender_Canvas.prototype;return i.getWidth=function(t,e){return CharRender_Canvas.ctx?(CharRender_Canvas.ctx._lastFont!=t&&(CharRender_Canvas.ctx.font=t,CharRender_Canvas.ctx._lastFont=t),CharRender_Canvas.ctx.measureText(e).width):0},i.scale=function(t,e){if(!this.supportImageData)return this.lastScaleX=t,void(this.lastScaleY=e);this.lastScaleX==t&&this.lastScaleY==e||(CharRender_Canvas.ctx.setTransform(t,0,0,e,0,0),this.lastScaleX=t,this.lastScaleY=e)},i.getCharBmp=function(t,e,r,i,n,a,s,o,h,u,l){if(!this.supportImageData)return this.getCharCanvas(t,e,r,i,n,a,s,o,h,u);CharRender_Canvas.ctx.font!=e&&(CharRender_Canvas.ctx.font=e,CharRender_Canvas.ctx._lastFont=e),a.width=CharRender_Canvas.ctx.measureText(t).width;var c=a.width*this.lastScaleX,_=a.height*this.lastScaleY;c+=(s+h)*this.lastScaleX,_+=(o+u)*this.lastScaleY,c=Math.ceil(c),_=Math.ceil(_);var d=(c=Math.min(c,laya.webgl.resource.CharRender_Canvas.canvas.width))+2*r+1,f=(_=Math.min(_,laya.webgl.resource.CharRender_Canvas.canvas.height))+2*r+1;l&&(d=Math.max(d,l[0]+l[2]+1),f=Math.max(f,l[1]+l[3]+1)),CharRender_Canvas.ctx.clearRect(0,0,d,f),CharRender_Canvas.ctx.save(),CharRender_Canvas.ctx.textBaseline="top",r>0&&(CharRender_Canvas.ctx.strokeStyle=n,CharRender_Canvas.ctx.lineWidth=r,CharRender_Canvas.ctx.strokeText(t,s,o)),CharRender_Canvas.ctx.fillStyle=i,CharRender_Canvas.ctx.fillText(t,s,o),this.showDbgInfo&&(CharRender_Canvas.ctx.strokeStyle="#ff0000",CharRender_Canvas.ctx.strokeRect(0,0,c,_),CharRender_Canvas.ctx.strokeStyle="#00ff00",CharRender_Canvas.ctx.strokeRect(s,o,a.width,a.height)),l&&-1==l[2]&&(l[2]=Math.ceil((a.width+2*r)*this.lastScaleX));var x=l?CharRender_Canvas.ctx.getImageData(l[0],l[1],l[2],l[3]):CharRender_Canvas.ctx.getImageData(0,0,c,_);return CharRender_Canvas.ctx.restore(),a.bmpWidth=x.width,a.bmpHeight=x.height,x},i.getCharCanvas=function(t,e,r,i,n,a,s,o,h,u){CharRender_Canvas.ctx.font!=e&&(CharRender_Canvas.ctx.font=e,CharRender_Canvas.ctx._lastFont=e),a.width=CharRender_Canvas.ctx.measureText(t).width;var l=a.width*this.lastScaleX,c=a.height*this.lastScaleY;return l+=(s+h)*this.lastScaleX,c+=(o+u)*this.lastScaleY+1,l=Math.min(l,this.maxTexW),c=Math.min(c,this.maxTexH),CharRender_Canvas.canvas.width=Math.min(l+1,this.maxTexW),CharRender_Canvas.canvas.height=Math.min(c+1,this.maxTexH),CharRender_Canvas.ctx.font=e,CharRender_Canvas.ctx.clearRect(0,0,l+1+r,c+1+r),CharRender_Canvas.ctx.setTransform(1,0,0,1,0,0),CharRender_Canvas.ctx.save(),this.scaleFontSize&&CharRender_Canvas.ctx.scale(this.lastScaleX,this.lastScaleY),CharRender_Canvas.ctx.translate(s,o),CharRender_Canvas.ctx.textAlign="left",CharRender_Canvas.ctx.textBaseline="top",r>0?(CharRender_Canvas.ctx.strokeStyle=n,CharRender_Canvas.ctx.fillStyle=i,CharRender_Canvas.ctx.lineWidth=r,CharRender_Canvas.ctx.fillAndStrokeText?CharRender_Canvas.ctx.fillAndStrokeText(t,0,0):(CharRender_Canvas.ctx.strokeText(t,0,0),CharRender_Canvas.ctx.fillText(t,0,0))):(CharRender_Canvas.ctx.fillStyle=i,CharRender_Canvas.ctx.fillText(t,0,0)),this.showDbgInfo&&(CharRender_Canvas.ctx.strokeStyle="#ff0000",CharRender_Canvas.ctx.strokeRect(0,0,l,c),CharRender_Canvas.ctx.strokeStyle="#00ff00",CharRender_Canvas.ctx.strokeRect(0,0,a.width,a.height)),CharRender_Canvas.ctx.restore(),a.bmpWidth=CharRender_Canvas.canvas.width,a.bmpHeight=CharRender_Canvas.canvas.height,CharRender_Canvas.canvas},a(0,i,"canvasWidth",function(){return CharRender_Canvas.canvas.width},function(t){CharRender_Canvas.canvas.width!=t&&(CharRender_Canvas.canvas.width=t,t>2048&&console.warn("画文字设置的宽度太大，超过2048了"),CharRender_Canvas.ctx.setTransform(1,0,0,1,0,0),CharRender_Canvas.ctx.scale(this.lastScaleX,this.lastScaleY))}),CharRender_Canvas.canvas=null,CharRender_Canvas.ctx=null,CharRender_Canvas}(),Et=function(e){function CharRender_Native(){this.lastFont="",CharRender_Native.__super.call(this)}n(CharRender_Native,"laya.webgl.resource.CharRender_Native",z);var r=CharRender_Native.prototype;return r.getWidth=function(e,r){return t.conchTextCanvas?(t.conchTextCanvas.font=e,this.lastFont=e,t.conchTextCanvas.measureText(r).width):0},r.scale=function(t,e){},r.getCharBmp=function(e,r,i,n,a,s,o,h,l,c,_){if(!t.conchTextCanvas)return null;t.conchTextCanvas.font=r,this.lastFont=r;s.width=t.conchTextCanvas.measureText(e).width,s.height;var d=u.create(a).numColor,f=u.create(n).numColor,x=t.conchTextCanvas.getTextBitmapData(e,f,i>2?2:i,d);return s.bmpWidth=x.width,s.bmpHeight=x.height,x},CharRender_Native}(),At=function(t){function ShaderDefines2D(){ShaderDefines2D.__super.call(this,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name,ShaderDefines2D.__int2nameMap)}return n(ShaderDefines2D,"laya.webgl.shader.d2.ShaderDefines2D",W),ShaderDefines2D.__init__=function(){ShaderDefines2D.reg("TEXTURE2D",1),ShaderDefines2D.reg("PRIMITIVE",4),ShaderDefines2D.reg("GLOW_FILTER",8),ShaderDefines2D.reg("BLUR_FILTER",16),ShaderDefines2D.reg("COLOR_FILTER",32),ShaderDefines2D.reg("COLOR_ADD",64),ShaderDefines2D.reg("WORLDMAT",128),ShaderDefines2D.reg("FILLTEXTURE",256),ShaderDefines2D.reg("FSHIGHPRECISION",1024),ShaderDefines2D.reg("MVP3D",2048)},ShaderDefines2D.reg=function(t,e){W._reg(t,e,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name)},ShaderDefines2D.toText=function(t,e,r){return W._toText(t,e,r)},ShaderDefines2D.toInt=function(t){return W._toInt(t,ShaderDefines2D.__name2int)},ShaderDefines2D.TEXTURE2D=1,ShaderDefines2D.PRIMITIVE=4,ShaderDefines2D.FILTERGLOW=8,ShaderDefines2D.FILTERBLUR=16,ShaderDefines2D.FILTERCOLOR=32,ShaderDefines2D.COLORADD=64,ShaderDefines2D.WORLDMAT=128,ShaderDefines2D.FILLTEXTURE=256,ShaderDefines2D.SKINMESH=512,ShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION=1024,ShaderDefines2D.MVP3D=2048,ShaderDefines2D.NOOPTMASK=312,ShaderDefines2D.__name2int={},ShaderDefines2D.__int2name=[],ShaderDefines2D.__int2nameMap=[],ShaderDefines2D}(),Mt=function(t){function MeshQuadTexture(){MeshQuadTexture.__super.call(this,laya.webgl.utils.MeshQuadTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=MeshQuadTexture._maxIB):(this.createQuadIB(MeshQuadTexture._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}n(MeshQuadTexture,"laya.webgl.utils.MeshQuadTexture",F);var e=MeshQuadTexture.prototype;return e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},e.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},e.addQuad=function(t,e,r,i){var n=this._vb,a=n._byteLength>>2;n.setByteLength(a+laya.webgl.utils.MeshQuadTexture.const_stride<<2);var s=n._floatArray32||n.getFloat32Array(),o=n._uint32Array,h=a,u=i?255:0;s[h++]=t[0],s[h++]=t[1],s[h++]=e[0],s[h++]=e[1],o[h++]=r,o[h++]=u,s[h++]=t[2],s[h++]=t[3],s[h++]=e[2],s[h++]=e[3],o[h++]=r,o[h++]=u,s[h++]=t[4],s[h++]=t[5],s[h++]=e[4],s[h++]=e[5],o[h++]=r,o[h++]=u,s[h++]=t[6],s[h++]=t[7],s[h++]=e[6],s[h++]=e[7],o[h++]=r,o[h++]=u,n._upload=!0},MeshQuadTexture.getAMesh=function(){return laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new MeshQuadTexture},MeshQuadTexture.const_stride=24,MeshQuadTexture._fixib=null,MeshQuadTexture._maxIB=16384,MeshQuadTexture._POOL=[],i(MeshQuadTexture,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),MeshQuadTexture}(),Lt=function(t){function MeshVG(){MeshVG.__super.call(this,laya.webgl.utils.MeshVG.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}n(MeshVG,"laya.webgl.utils.MeshVG",F);var e=MeshVG.prototype;return e.addVertAndIBToMesh=function(t,e,r,i){for(var n=this._vb.needSize(e.length/2*MeshVG.const_stride)>>2,a=this._vb._floatArray32||this._vb.getFloat32Array(),s=this._vb._uint32Array,o=0,h=e.length/2,u=0;u<h;u++)a[n++]=e[o],a[n++]=e[o+1],o+=2,s[n++]=r;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(i)),this._ib.setNeedUpload(),this.vertNum+=h,this.indexNum+=i.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},MeshVG.getAMesh=function(){return laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new MeshVG},MeshVG.const_stride=12,MeshVG._POOL=[],i(MeshVG,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),MeshVG}(),Dt=function(t){function BufferState2D(){BufferState2D.__super.call(this)}return n(BufferState2D,"laya.webgl.BufferState2D",q),BufferState2D}(),wt=function(t){function BaseShader(){BaseShader.__super.call(this)}return n(BaseShader,"laya.webgl.shader.BaseShader",C),BaseShader.activeShader=null,BaseShader.bindShader=null,BaseShader}(),Bt=function(t){function TextTexture(t,e){this._source=null,this._texW=0,this._texH=0,this.__destroyed=!1,this._discardTm=0,this.genID=0,this.bitmap={id:0,_glTexture:null},this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=0,this.ri=null,TextTexture.__super.call(this),this._texW=t||lt.atlasWidth,this._texH=e||lt.atlasWidth,this.bitmap.id=this.id,this.lock=!0}n(TextTexture,"laya.webgl.text.TextTexture",C);var e=TextTexture.prototype;return e.recreateResource=function(){if(!this._source){var t=T.isConchApp?V.instance.getDefaultCommandEncoder():$.mainContext,e=this._source=t.createTexture();this.bitmap._glTexture=e,ct.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),lt.debugUV&&this.fillWhite()}},e.addChar=function(t,e,r,i){if(lt.isWan1Wan)return this.addCharCanvas(t,e,r,i);!this._source&&this.recreateResource();var n=T.isConchApp?V.instance.getDefaultCommandEncoder():$.mainContext;ct.bindTexture(n,3553,this._source),!T.isConchApp&&n.pixelStorei(37441,!0);var a=t.data;t.data instanceof Uint8ClampedArray&&(a=new Uint8Array(a.buffer)),n.texSubImage2D(3553,0,e,r,t.width,t.height,6408,5121,a),!T.isConchApp&&n.pixelStorei(37441,!1);var s=NaN,o=NaN,h=NaN,u=NaN;return T.isConchApp?(s=e/this._texW,o=r/this._texH,h=(e+t.width)/this._texW,u=(r+t.height)/this._texH):(s=(e+1)/this._texW,o=r/this._texH,h=(e+t.width-1)/this._texW,u=(r+t.height-1)/this._texH),(i=i||new Array(8))[0]=s,i[1]=o,i[2]=h,i[3]=o,i[4]=h,i[5]=u,i[6]=s,i[7]=u,i},e.addCharCanvas=function(t,e,r,i){!this._source&&this.recreateResource();var n=T.isConchApp?V.instance.getDefaultCommandEncoder():$.mainContext;ct.bindTexture(n,3553,this._source),!T.isConchApp&&n.pixelStorei(37441,!0),n.texSubImage2D(3553,0,e,r,6408,5121,t),!T.isConchApp&&n.pixelStorei(37441,!1);var a=NaN,s=NaN,o=NaN,h=NaN;return T.isConchApp?(a=e/this._texW,s=r/this._texH,o=(e+t.width)/this._texW,h=(r+t.height)/this._texH):(a=(e+1)/this._texW,s=(r+1)/this._texH,o=(e+t.width-1)/this._texW,h=(r+t.height-1)/this._texH),(i=i||new Array(8))[0]=a,i[1]=s,i[2]=o,i[3]=s,i[4]=o,i[5]=h,i[6]=a,i[7]=h,i},e.fillWhite=function(){!this._source&&this.recreateResource();var t=T.isConchApp?V.instance.getDefaultCommandEncoder():$.mainContext,e=new Uint8Array(this._texW*this._texH*4);e.fill(255),t.texSubImage2D(3553,0,0,0,this._texW,this._texH,6408,5121,e)},e.discard=function(){this._texW==lt.atlasWidth&&this._texH==lt.atlasWidth?(this.genID++,TextTexture.poolLen>=TextTexture.pool.length&&(TextTexture.pool=TextTexture.pool.concat(new Array(10))),this._discardTm=r.stage.getFrameTm(),TextTexture.pool[TextTexture.poolLen++]=this):this.destroy()},e.destroy=function(){console.log("destroy TextTexture"),this.__destroyed=!0;var t=T.isConchApp?V.instance.getDefaultCommandEncoder():$.mainContext;this._source&&t.deleteTexture(this._source),this._source=null},e.touchRect=function(t,e){this.lastTouchTm!=e&&(this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=e);var r=lt.atlasWidth*lt.atlasWidth,i=K.atlasGridW*K.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/r,this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/K.atlasGridW)*Math.ceil(t.bmpHeight/K.atlasGridW)/(r/i)},e._getSource=function(){return this._source},e.drawOnScreen=function(t,e){},a(0,e,"texture",function(){return this}),TextTexture.getTextTexture=function(t,e){if(t!=lt.atlasWidth||t!=lt.atlasWidth)return new TextTexture(t,e);if(TextTexture.poolLen>0){var r=TextTexture.pool[--TextTexture.poolLen];return TextTexture.poolLen>0&&TextTexture.clean(),r}return new TextTexture(t,e)},TextTexture.clean=function(){var t=r.stage.getFrameTm();if(0===TextTexture.cleanTm&&(TextTexture.cleanTm=t),t-TextTexture.cleanTm>=lt.checkCleanTextureDt){for(var e=0;e<TextTexture.poolLen;e++){var i=TextTexture.pool[e];t-i._discardTm>=lt.destroyUnusedTextureDt&&(i.destroy(),TextTexture.pool[e]=TextTexture.pool[TextTexture.poolLen-1],TextTexture.poolLen--,e--)}TextTexture.cleanTm=t}},TextTexture.poolLen=0,TextTexture.cleanTm=0,i(TextTexture,["pool",function(){return this.pool=new Array(10)}]),TextTexture}(),Gt=function(t){function VertexBuffer2D(t,e){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,VertexBuffer2D.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}n(VertexBuffer2D,"laya.webgl.utils.VertexBuffer2D",Ct);var e=VertexBuffer2D.prototype;return e.getFloat32Array=function(){return this._floatArray32},e.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length),this.getFloat32Array().set(t,e),this._upload=!0},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},e.deleteBuffer=function(){this._disposeResource()},e._bindForVAO=function(){V.instance.bindBuffer(34962,this._glBuffer)},e.bind=function(){return G._bindedVertexBuffer!==this._glBuffer&&(V.instance.bindBuffer(34962,this._glBuffer),G._bindedVertexBuffer=this._glBuffer,!0)},e.destroy=function(){laya.webgl.utils.Buffer.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},a(0,e,"vertexStride",function(){return this._vertexStride}),VertexBuffer2D.create=function(t,e){return void 0===e&&(e=35048),new VertexBuffer2D(t,e)},VertexBuffer2D}(),Wt=function(t){function IndexBuffer2D(t){this._uint16Array=null,void 0===t&&(t=35044),IndexBuffer2D.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}n(IndexBuffer2D,"laya.webgl.utils.IndexBuffer2D",Ct);var e=IndexBuffer2D.prototype;return e._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},e.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},e._bindForVAO=function(){V.instance.bindBuffer(34963,this._glBuffer)},e.bind=function(){return G._bindedIndexBuffer!==this._glBuffer&&(V.instance.bindBuffer(34963,this._glBuffer),G._bindedIndexBuffer=this._glBuffer,!0)},e.destory=function(){this._uint16Array=null,this._buffer=null},e.disposeResource=function(){this._disposeResource()},IndexBuffer2D.create=function(t){return void 0===t&&(t=35044),new IndexBuffer2D(t)},IndexBuffer2D}(),It=function(t){function BaseTexture(t,e){BaseTexture.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=e,this._anisoLevel=1,this._glTexture=V.instance.createTexture()}n(BaseTexture,"laya.webgl.resource.BaseTexture",o);var e=BaseTexture.prototype;return e._isPot=function(t){return 0==(t&t-1)},e._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(!ct._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=ct._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 4:if(!ct._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=ct._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 5:if(!ct._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=ct._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case 9:if(!ct._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=ct._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 10:if(!ct._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=ct._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 11:if(!ct._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=ct._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 12:if(!ct._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=ct._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t},e._setFilterMode=function(t){var e=V.instance;switch(ct.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},e._setWarpMode=function(t,e){var r=V.instance;if(ct.bindTexture(r,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:r.texParameteri(this._glTextureType,t,10497);break;case 1:r.texParameteri(this._glTextureType,t,33071)}else r.texParameteri(this._glTextureType,t,33071)},e._setAnisotropy=function(t){var e=ct._extTextureFilterAnisotropic;if(e&&!h.onLimixiu){t=Math.max(t,1);var r=V.instance;ct.bindTexture(r,this._glTextureType,this._glTexture),t=Math.min(r.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),r.texParameterf(this._glTextureType,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}},e._disposeResource=function(){this._glTexture&&(V.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},e._getSource=function(){return this._readyed?this._glTexture:null},a(0,e,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),a(0,e,"mipmap",function(){return this._mipmap}),a(0,e,"format",function(){return this._format}),a(0,e,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),a(0,e,"defaulteTexture",function(){throw"BaseTexture:must override it."}),a(0,e,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),a(0,e,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),BaseTexture.WARPMODE_REPEAT=0,BaseTexture.WARPMODE_CLAMP=1,BaseTexture.FILTERMODE_POINT=0,BaseTexture.FILTERMODE_BILINEAR=1,BaseTexture.FILTERMODE_TRILINEAR=2,BaseTexture.FORMAT_R8G8B8=0,BaseTexture.FORMAT_R8G8B8A8=1,BaseTexture.FORMAT_ALPHA8=2,BaseTexture.FORMAT_DXT1=3,BaseTexture.FORMAT_DXT5=4,BaseTexture.FORMAT_ETC1RGB=5,BaseTexture.FORMAT_PVRTCRGB_2BPPV=9,BaseTexture.FORMAT_PVRTCRGBA_2BPPV=10,BaseTexture.FORMAT_PVRTCRGB_4BPPV=11,BaseTexture.FORMAT_PVRTCRGBA_4BPPV=12,BaseTexture.FORMAT_DEPTH_16=0,BaseTexture.FORMAT_STENCIL_8=1,BaseTexture.FORMAT_DEPTHSTENCIL_16_8=2,BaseTexture.FORMAT_DEPTHSTENCIL_NONE=3,BaseTexture}(),Pt=function(t){function Shader(t,e,r,i,n){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},Shader.__super.call(this),!t||!e)throw"Shader Error";this._attribInfo=n,this._id=++Shader._count,this._vs=t,this._ps=e,this._nameMap=i||{},null!=r&&(Shader.sharders[r]=this),this.recreateResource(),this.lock=!0}n(Shader,"laya.webgl.shader.Shader",wt);var e=Shader.prototype;return e.recreateResource=function(){this._compile(),this._setGPUMemory(0)},e._disposeResource=function(){$.mainContext.deleteShader(this._vshader),$.mainContext.deleteShader(this._pshader),$.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){var t;this._reCompile=!0,this._params=[],this.customCompile&&(t=N.preGetParams(this._vs,this._ps));var e=$.mainContext;this._program=e.createProgram(),this._vshader=Shader._createShader(e,this._vs,35633),this._pshader=Shader._createShader(e,this._ps,35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader);var r,i,n=0,a=this._attribInfo?this._attribInfo.length:0;for(n=0;n<a;n+=2)e.bindAttribLocation(this._program,this._attribInfo[n+1],this._attribInfo[n]);if(e.linkProgram(this._program),!this.customCompile&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var s=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,35718);for(n=0;n<s;n++){var o=this.customCompile?t.uniforms[n]:e.getActiveUniform(this._program,n);(r={vartype:"uniform",glfun:null,ivartype:1,location:e.getUniformLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")>0&&(r.name=r.name.substr(0,r.name.length-3),r.isArray=!0,r.location=e.getUniformLocation(this._program,r.name)),this._params.push(r)}for(n=0,i=this._params.length;n<i;n++)switch((r=this._params[n]).indexOfParams=n,r.index=1,r.value=[r.location,null],r.codename=r.name,r.name=this._nameMap[r.codename]?this._nameMap[r.codename]:r.codename,this._paramsMap[r.name]=r,r._this=this,r.uploadedValue=[],r.type){case 5124:r.fun=r.isArray?this._uniform1iv:this._uniform1i;break;case 5126:r.fun=r.isArray?this._uniform1fv:this._uniform1f;break;case 35664:r.fun=r.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:r.fun=r.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:r.fun=r.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:r.fun=this._uniform_sampler2D;break;case 35680:r.fun=this._uniform_samplerCube;break;case 35676:r.glfun=e.uniformMatrix4fv,r.fun=this._uniformMatrix4fv;break;case 35670:r.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}}},e.getUniform=function(t){return this._paramsMap[t]},e._uniform1f=function(t,e){var r=t.uploadedValue;return r[0]!==e?($.mainContext.uniform1f(t.location,r[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var r=t.uploadedValue;return r[0]!==e[0]||r[1]!==e[1]||r[2]!==e[2]||r[3]!==e[3]?($.mainContext.uniform1fv(t.location,e),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],1):0}return $.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var r=t.uploadedValue;return r[0]!==e[0]||r[1]!==e[1]?($.mainContext.uniform2f(t.location,r[0]=e[0],r[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var r=t.uploadedValue;return r[0]!==e[0]||r[1]!==e[1]||r[2]!==e[2]||r[3]!==e[3]?($.mainContext.uniform2fv(t.location,e),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],1):0}return $.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var r=t.uploadedValue;return r[0]!==e[0]||r[1]!==e[1]||r[2]!==e[2]?($.mainContext.uniform3f(t.location,r[0]=e[0],r[1]=e[1],r[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return $.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var r=t.uploadedValue;return r[0]!==e[0]||r[1]!==e[1]||r[2]!==e[2]||r[3]!==e[3]?($.mainContext.uniform4f(t.location,r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return $.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return $.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return $.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return $.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var r=t.uploadedValue;return r[0]!==e?($.mainContext.uniform1i(t.location,r[0]=e),1):0},e._uniform1iv=function(t,e){return $.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var r=t.uploadedValue;return r[0]!==e[0]||r[1]!==e[1]?($.mainContext.uniform2i(t.location,r[0]=e[0],r[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return $.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var r=t.uploadedValue;return r[0]!==e[0]||r[1]!==e[1]||r[2]!==e[2]?($.mainContext.uniform3i(t.location,r[0]=e[0],r[1]=e[1],r[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return $.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var r=t.uploadedValue;return r[0]!==e[0]||r[1]!==e[1]||r[2]!==e[2]||r[3]!==e[3]?($.mainContext.uniform4i(t.location,r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return $.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var r=$.mainContext,i=t.uploadedValue;return null==i[0]?(i[0]=this._curActTexIndex,r.uniform1i(t.location,this._curActTexIndex),ct.activeTexture(r,33984+this._curActTexIndex),ct.bindTexture(r,3553,e),this._curActTexIndex++,1):(ct.activeTexture(r,33984+i[0]),ct.bindTexture(r,3553,e),0)},e._uniform_samplerCube=function(t,e){var r=$.mainContext,i=t.uploadedValue;return null==i[0]?(i[0]=this._curActTexIndex,r.uniform1i(t.location,this._curActTexIndex),ct.activeTexture(r,33984+this._curActTexIndex),ct.bindTexture(r,34067,e),this._curActTexIndex++,1):(ct.activeTexture(r,33984+i[0]),ct.bindTexture(r,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){ct.useProgram($.mainContext,this._program);var r=this._paramsMap[t];r.fun.call(this,r,e)},e.uploadTexture2D=function(t){var e=ct;e._activeTextures[0]!==t&&(e.bindTexture($.mainContext,e.TEXTURE_2D,t),e._activeTextures[0]=t)},e.upload=function(t,e){wt.activeShader=wt.bindShader=this;var r=$.mainContext;ct.useProgram(r,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var i,n,a=e.length,s=0,o=0;o<a;o++)null!==(n=t[(i=e[o]).name])&&(s+=i.fun.call(this,i,n));R.shaderCall+=s},e.uploadArray=function(t,e,r){wt.activeShader=this,wt.bindShader=this,ct.useProgram($.mainContext,this._program);this._params;for(var i,n,a=0,s=e-2;s>=0;s-=2)(n=this._paramsMap[t[s]])&&null!=(i=t[s+1])&&(r&&r[n.name]&&r[n.name].bind(),a+=n.fun.call(this,n,i));R.shaderCall+=a},e.getParams=function(){return this._params},e.setAttributesLocation=function(t){this._attribInfo=t},Shader.getShader=function(t){return Shader.sharders[t]},Shader.create=function(t,e,r,i,n){return new Shader(t,e,r,i,n)},Shader.withCompile=function(t,e,r,i){if(r&&Shader.sharders[r])return Shader.sharders[r];var n=Shader._preCompileShader[2e-4*t];if(!n)throw new Error("withCompile shader err!"+t);return n.createShader(e,r,i,null)},Shader.withCompile2D=function(t,e,r,i,n,a){if(i&&Shader.sharders[i])return Shader.sharders[i];var s=Shader._preCompileShader[2e-4*t+e];if(!s)throw new Error("withCompile shader err!"+t+" "+e);return s.createShader(r,i,n,a)},Shader.addInclude=function(t,e){N.addInclude(t,e)},Shader.preCompile=function(t,e,r,i){var n=2e-4*t;Shader._preCompileShader[n]=new N(e,r,i)},Shader.preCompile2D=function(t,e,r,i,n){var a=2e-4*t+e;Shader._preCompileShader[a]=new N(r,i,n)},Shader._createShader=function(t,e,r){var i=t.createShader(r);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,35713)?i:(console.log(t.getShaderInfoLog(i)),null)},Shader._count=0,Shader._preCompileShader={},Shader.SHADERNAME2ID=2e-4,Shader.sharders=new Array(32),i(Shader,["nameKey",function(){return this.nameKey=new E}]),Shader}(),Ot=function(t){function RenderTexture2D(t,e,r,i){this._mgrKey=0,void 0===r&&(r=0),void 0===i&&(i=0),RenderTexture2D.__super.call(this,r,!1),this._glTextureType=3553,this._width=t,this._height=e,this._depthStencilFormat=i,this._create(t,e)}n(RenderTexture2D,"laya.webgl.resource.RenderTexture2D",It);var e=RenderTexture2D.prototype;return e.getIsReady=function(){return!0},e._create=function(t,e){var r=V.instance;this._frameBuffer=r.createFramebuffer(),ct.bindTexture(r,this._glTextureType,this._glTexture);var i=this._getGLFormat();if(r.texImage2D(this._glTextureType,0,i,t,e,0,i,5121,null),this._setGPUMemory(t*e*4),r.bindFramebuffer(36160,this._frameBuffer),r.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=r.createRenderbuffer(),r.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:r.renderbufferStorage(36161,33189,t,e),r.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:r.renderbufferStorage(36161,36168,t,e),r.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:r.renderbufferStorage(36161,34041,t,e),r.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}r.bindFramebuffer(36160,null),r.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,V.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},e.start=function(){var t=V.instance;V.instance.bindFramebuffer(36160,this._frameBuffer),this._lastRT=RenderTexture2D._currentActive,RenderTexture2D._currentActive=this,this._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=ot.width,this._lastHeight=ot.height,ot.width=this._width,ot.height=this._height,wt.activeShader=null},e.end=function(){V.instance.bindFramebuffer(36160,null),RenderTexture2D._currentActive=null,this._readyed=!0},e.restore=function(){var t=V.instance;this._lastRT!=RenderTexture2D._currentActive&&(V.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),RenderTexture2D._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),ot.width=this._lastWidth,ot.height=this._lastHeight,wt.activeShader=null},e.clear=function(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1);var n=V.instance;n.clearColor(t,e,r,i);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}n.clear(a)},e.getData=function(t,e,r,i){var n=V.instance;if(n.bindFramebuffer(36160,this._frameBuffer),!(36053===n.checkFramebufferStatus(36160)))return n.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._width*this._height*4),s=this._getGLFormat();return n.readPixels(t,e,r,i,s,5121,a),n.bindFramebuffer(36160,null),a},e.recycle=function(){},e._disposeResource=function(){if(this._frameBuffer){var t=V.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},a(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),a(0,e,"defaulteTexture",function(){return Nt.grayTexture}),a(0,e,"sourceWidth",function(){return this._width}),a(0,e,"sourceHeight",function(){return this._height}),a(0,e,"offsetX",function(){return 0}),a(0,e,"offsetY",function(){return 0}),a(1,RenderTexture2D,"currentActive",function(){return RenderTexture2D._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),RenderTexture2D.pushRT=function(){RenderTexture2D.rtStack.push({rt:RenderTexture2D._currentActive,w:ot.width,h:ot.height})},RenderTexture2D.popRT=function(){var t=V.instance,e=RenderTexture2D.rtStack.pop();e&&(RenderTexture2D._currentActive!=e.rt&&(V.instance.bindFramebuffer(36160,e.rt?e.rt._frameBuffer:null),RenderTexture2D._currentActive=e.rt),t.viewport(0,0,e.w,e.h),ot.width=e.w,ot.height=e.h)},RenderTexture2D._currentActive=null,RenderTexture2D.rtStack=[],i(RenderTexture2D,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),RenderTexture2D}(),Nt=function(t){function Texture2D(t,e,r,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===i&&(i=!0),void 0===n&&(n=!1),Texture2D.__super.call(this,r,i),this._glTextureType=3553,this._width=t,this._height=e,this._canRead=n,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),l.is2DPixelArtGame&&(this._filterMode=0),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel)}n(Texture2D,"laya.webgl.resource.Texture2D",It);var e=Texture2D.prototype;return e._calcualatesCompressedDataSize=function(t,e,r){switch(t){case 3:case 5:return(e+3>>2)*(r+3>>2)*8;case 4:return(e+3>>2)*(r+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(r,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(r,8)*2+7)/8);default:return 0}},e._pharseDDS=function(t){var e=new Int32Array(t,0,31);if(542327876!=e[0])throw"Invalid magic number in DDS header";if(!(4&e[20]))throw"Unsupported format, must contain a FourCC code";var r=e[21];switch(this._format){case 3:if(827611204!==r)throw"the FourCC code is not same with texture format.";break;case 4:if(894720068!==r)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var i=1;if(131072&e[2]){if(i=Math.max(1,e[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var n=e[4],a=e[3];this._width=n,this._height=a;var s=e[1]+4;this._upLoadCompressedTexImage2D(t,n,a,i,s,0)},e._pharseKTX=function(t){var e=new Uint8Array(t,0,12);if(171!=e[0]||75!=e[1]||84!=e[2]||88!=e[3]||32!=e[4]||49!=e[5]||49!=e[6]||187!=e[7]||13!=e[8]||10!=e[9]||26!=e[10]||10!=e[11])throw"Invalid fileIdentifier in KTX header";var r=new Int32Array(e.buffer,e.length,13);switch(r[4]){case ct._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=5;break;default:throw"unknown texture format."}var i=r[11],n=r[6],a=r[7];this._width=n,this._height=a;var s=64+r[12];this._upLoadCompressedTexImage2D(t,n,a,i,s,4)},e._pharsePVR=function(t){var e=new Int32Array(t,0,13);if(55727696!=e[0])throw"Invalid magic number in PVR header";switch(e[2]){case 0:this._format=9;break;case 2:this._format=11;break;case 1:this._format=10;break;case 3:this._format=12;break;default:throw"Texture2D:unknown PVR format."}var r=e[11],i=e[7],n=e[6];this._width=i,this._height=n;var a=e[12]+52;this._upLoadCompressedTexImage2D(t,i,n,r,a,0)},e._upLoadCompressedTexImage2D=function(t,e,r,i,n,a){var s=V.instance,o=this._glTextureType;ct.bindTexture(s,o,this._glTexture);for(var h=this._getGLFormat(),u=n,l=0;l<i;l++){u+=a;var c=this._calcualatesCompressedDataSize(this._format,e,r),_=new Uint8Array(t,u,c);s.compressedTexImage2D(o,l,h,e,r,0,_),e=Math.max(e>>1,1),r=Math.max(r>>1,1),u+=c}var d=u;this._setGPUMemory(d),this._readyed=!0,this._activeResource()},e.loadImageSource=function(t,e){void 0===e&&(e=!1);var r=t.width,i=t.height;this._width=r,this._height=i,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode);var n=V.instance;ct.bindTexture(n,this._glTextureType,this._glTexture);var a=this._getGLFormat();T.isConchApp?(t.setPremultiplyAlpha(e),n.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&n.pixelStorei(37441,!0),n.texImage2D(this._glTextureType,0,a,a,5121,t),e&&n.pixelStorei(37441,!1)),this._mipmap&&this._isPot(r)&&this._isPot(i)?(n.generateMipmap(this._glTextureType),this._setGPUMemory(r*i*4*(1+1/3))):this._setGPUMemory(r*i*4),this._canRead&&(T.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,r,i)):(h.canvas.size(r,i),h.canvas.clear(),h.context.drawImage(t,0,0,r,i),this._pixels=new Uint8Array(h.context.getImageData(0,0,r,i).data.buffer))),this._readyed=!0,this._activeResource()},e.setPixels=function(t,e){if(void 0===e&&(e=0),!t)throw"Texture2D:pixels can't be null.";var r=this._width,i=this._height,n=V.instance,a=this._glTextureType;ct.bindTexture(n,a,this._glTexture);var s=this._getGLFormat();n.texImage2D(a,e,s,r,i,0,s,5121,t),this._mipmap&&this._isPot(r)&&this._isPot(i)?(n.generateMipmap(a),this._setGPUMemory(r*i*4*(1+1/3))):this._setGPUMemory(r*i*4),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()},e.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}},e._recoverResource=function(){},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},a(0,e,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture}),Texture2D.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,Texture2D.grayTexture=new Texture2D(1,1,0,!1,!1),Texture2D.grayTexture.setPixels(t),Texture2D.grayTexture.lock=!0},Texture2D._parse=function(t,e,r){var i=r?new Texture2D(r[0],r[1],r[2],r[3],r[4]):new Texture2D(0,0);switch(e&&(i.wrapModeU=e.wrapModeU,i.wrapModeV=e.wrapModeV,i.filterMode=e.filterMode,i.anisoLevel=e.anisoLevel),i._format){case 0:case 1:i.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:i.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return i},Texture2D.load=function(t,e){r.loader.create(t,e,null,"TEXTURE2D")},Texture2D.grayTexture=null,Texture2D}(),Ft=function(t){function Shader2X(t,e,r,i,n){this._params2dQuick2=null,this._shaderValueWidth=0,this._shaderValueHeight=0,Shader2X.__super.call(this,t,e,r,i,n)}n(Shader2X,"laya.webgl.shader.d2.Shader2X",t);var e=Shader2X.prototype;return e._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,r=0,i=e.length;r<i;r++)"size"!==(t=e[r]).name&&this._params2dQuick2.push(t)}return this._params2dQuick2},Shader2X.create=function(t,e,r,i,n){return new Shader2X(t,e,r,i,n)},Shader2X}(Pt);r.__init([ut,bt])}(window,document,Laya);