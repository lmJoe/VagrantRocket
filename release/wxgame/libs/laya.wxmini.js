window=window||global,window.layalib||(window.layalib=function(i,e){(window._layalibs||(window._layalibs=[])).push({f:i,i:e})}),window.layalib(function(i,e,n){n.un,n.uns;var t=n.static,o=n.class,a=n.getset,r=(n.__newvec,laya.utils.Browser),l=(laya.events.Event,laya.events.EventDispatcher),s=laya.resource.HTMLImage,d=laya.utils.Handler,u=laya.display.Input,c=laya.net.Loader,f=laya.net.LocalStorage,h=laya.maths.Matrix,M=laya.renders.Render,p=laya.utils.RunDriver,g=laya.media.SoundChannel,v=laya.media.SoundManager,m=(laya.display.Stage,laya.net.URL),F=laya.utils.Utils,w=(function(){function MiniLocation(){}o(MiniLocation,"laya.wx.mini.MiniLocation"),MiniLocation.__init__=function(){x.window.navigator.geolocation.getCurrentPosition=MiniLocation.getCurrentPosition,x.window.navigator.geolocation.watchPosition=MiniLocation.watchPosition,x.window.navigator.geolocation.clearWatch=MiniLocation.clearWatch},MiniLocation.getCurrentPosition=function(i,e,n){var t;(t={}).success=function(e){null!=i&&i(e)},t.fail=e,x.window.wx.getLocation(t)},MiniLocation.watchPosition=function(i,e,t){var o;return MiniLocation._curID++,(o={}).success=i,o.error=e,MiniLocation._watchDic[MiniLocation._curID]=o,n.systemTimer.loop(1e3,null,MiniLocation._myLoop),MiniLocation._curID},MiniLocation.clearWatch=function(i){delete MiniLocation._watchDic[i],MiniLocation._hasWatch()||n.systemTimer.clear(null,MiniLocation._myLoop)},MiniLocation._hasWatch=function(){var i;for(i in MiniLocation._watchDic)if(MiniLocation._watchDic[i])return!0;return!1},MiniLocation._myLoop=function(){MiniLocation.getCurrentPosition(MiniLocation._mySuccess,MiniLocation._myError)},MiniLocation._mySuccess=function(i){var e,n={};for(e in n.coords=i,n.timestamp=r.now(),MiniLocation._watchDic)MiniLocation._watchDic[e].success&&MiniLocation._watchDic[e].success(n)},MiniLocation._myError=function(i){var e;for(e in MiniLocation._watchDic)MiniLocation._watchDic[e].error&&MiniLocation._watchDic[e].error(i)},MiniLocation._watchDic={},MiniLocation._curID=0}(),function(){function MiniFileMgr(){}return o(MiniFileMgr,"laya.wx.mini.MiniFileMgr"),MiniFileMgr.isLocalNativeFile=function(i){for(var e=0,n=x.nativefiles.length;e<n;e++)if(-1!=i.indexOf(x.nativefiles[e]))return!0;return!1},MiniFileMgr.getFileInfo=function(i){var e=i,n=MiniFileMgr.fakeObj[e];return null==n?null:n},MiniFileMgr.read=function(i,e,n,t,o,a){var r;void 0===e&&(e="utf8"),void 0===t&&(t=""),void 0===o&&(o=!1),void 0===a&&(a=""),r=""==t||-1==t.indexOf("http://")&&-1==t.indexOf("https://")?i:MiniFileMgr.getFileNativePath(i),r=m.getAdptedFilePath(r),MiniFileMgr.fs.readFile({filePath:r,encoding:e,success:function(i){null!=n&&n.runWith([0,i])},fail:function(i){i&&""!=t?MiniFileMgr.downFiles(t,e,n,t,o,a):null!=n&&n.runWith([1])}})},MiniFileMgr.downFiles=function(i,e,n,t,o,a,r){void 0===e&&(e="ascii"),void 0===t&&(t=""),void 0===o&&(o=!1),void 0===a&&(a=""),void 0===r&&(r=!0),MiniFileMgr.wxdown({url:i,success:function(l){200===l.statusCode?MiniFileMgr.readFile(l.tempFilePath,e,n,t,o,a,r):403===l.statusCode?null!=n&&n.runWith([0,i]):null!=n&&n.runWith([1,l])},fail:function(i){null!=n&&n.runWith([1,i])}}).onProgressUpdate(function(i){null!=n&&n.runWith([2,i.progress])})},MiniFileMgr.readFile=function(i,e,n,t,o,a,r){void 0===e&&(e="utf8"),void 0===t&&(t=""),void 0===o&&(o=!1),void 0===a&&(a=""),void 0===r&&(r=!0),i=m.getAdptedFilePath(i),MiniFileMgr.fs.readFile({filePath:i,encoding:e,success:function(a){(-1!=i.indexOf("http://")||-1!=i.indexOf("https://"))&&(x.autoCacheFile||o)?(null!=n&&n.runWith([0,a]),MiniFileMgr.copyFile(i,t,null,e,r)):null!=n&&n.runWith([0,a])},fail:function(i){i&&null!=n&&n.runWith([1,i])}})},MiniFileMgr.downOtherFiles=function(i,e,n,t,o){void 0===n&&(n=""),void 0===t&&(t=!1),void 0===o&&(o=!0),MiniFileMgr.wxdown({url:i,success:function(i){200===i.statusCode?(x.autoCacheFile||t)&&-1==n.indexOf("qlogo.cn")&&-1==n.indexOf(".php")?(null!=e&&e.runWith([0,i.tempFilePath]),MiniFileMgr.copyFile(i.tempFilePath,n,null,"",o)):null!=e&&e.runWith([0,i.tempFilePath]):null!=e&&e.runWith([1,i])},fail:function(i){null!=e&&e.runWith([1,i])}})},MiniFileMgr.downLoadFile=function(i,e,t,o){void 0===e&&(e=""),void 0===o&&(o="ascii"),x.window.navigator.userAgent.indexOf("MiniGame")<0?n.loader.load(i,t):"image"==e||"sound"==e?MiniFileMgr.downOtherFiles(i,t,i,!0,!1):MiniFileMgr.downFiles(i,o,t,i,!0,e,!1)},MiniFileMgr.copyFile=function(i,e,n,t,o){void 0===t&&(t=""),void 0===o&&(o=!0);var a=i.split("/"),l=a[a.length-1],s=e,d=MiniFileMgr.getFileInfo(e),u=MiniFileMgr.getFileNativePath(l);MiniFileMgr.fakeObj[s]={md5:l,readyUrl:e,size:0,times:r.now(),encoding:t};var c=MiniFileMgr.getCacheUseSize();d?d.readyUrl!=e?MiniFileMgr.fs.getFileInfo({filePath:i,success:function(i){o&&c+4194304+i.size>=52428800&&(i.size>x.minClearSize&&(x.minClearSize=i.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.deleteFile(l,e,n,t,i.size)},fail:function(i){null!=n&&n.runWith([1,i])}}):null!=n&&n.runWith([0]):MiniFileMgr.fs.getFileInfo({filePath:i,success:function(a){o&&c+4194304+a.size>=52428800&&(a.size>x.minClearSize&&(x.minClearSize=a.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.fs.copyFile({srcPath:i,destPath:u,success:function(i){MiniFileMgr.onSaveFile(e,l,!0,t,n,a.size)},fail:function(i){null!=n&&n.runWith([1,i])}})},fail:function(i){null!=n&&n.runWith([1,i])}})},MiniFileMgr.onClearCacheRes=function(){var i=x.minClearSize,e=[];for(var n in MiniFileMgr.filesListObj)e.push(MiniFileMgr.filesListObj[n]);MiniFileMgr.sortOn(e,"times",16);for(var t=0,o=1,a=e.length;o<a;o++){var r=e[o];if(t>=i)break;t+=r.size,MiniFileMgr.deleteFile("",r.readyUrl)}},MiniFileMgr.sortOn=function(i,e,n){return void 0===n&&(n=0),16==n?i.sort(function(i,n){return i[e]-n[e]}):18==n?i.sort(function(i,n){return n[e]-i[e]}):i.sort(function(i,n){return i[e]-n[e]})},MiniFileMgr.getFileNativePath=function(i){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+i},MiniFileMgr.deleteFile=function(i,e,n,t,o){void 0===e&&(e=""),void 0===t&&(t=""),void 0===o&&(o=0);var a=MiniFileMgr.getFileInfo(e),r=MiniFileMgr.getFileNativePath(a.md5);MiniFileMgr.fs.unlink({filePath:r,success:function(a){var r=""!=i;if(""!=i){var l=MiniFileMgr.getFileNativePath(i);MiniFileMgr.fs.copyFile({srcPath:i,destPath:l,success:function(o){MiniFileMgr.onSaveFile(e,i,r,t,n,o.size)},fail:function(i){null!=n&&n.runWith([1,i])}})}else MiniFileMgr.onSaveFile(e,i,r,t,n,o)},fail:function(i){}})},MiniFileMgr.deleteAll=function(){var i=[];for(var e in MiniFileMgr.filesListObj)i.push(MiniFileMgr.filesListObj[e]);for(var n=1,t=i.length;n<t;n++){var o=i[n];MiniFileMgr.deleteFile("",o.readyUrl)}laya.wx.mini.MiniFileMgr.filesListObj&&laya.wx.mini.MiniFileMgr.filesListObj.fileUsedSize&&(laya.wx.mini.MiniFileMgr.filesListObj.fileUsedSize=0),laya.wx.mini.MiniFileMgr.writeFilesList("",JSON.stringify({}),!1)},MiniFileMgr.onSaveFile=function(i,e,n,t,o,a){void 0===n&&(n=!0),void 0===t&&(t=""),void 0===a&&(a=0);var l=i;if(null==MiniFileMgr.filesListObj.fileUsedSize&&(MiniFileMgr.filesListObj.fileUsedSize=0),n){MiniFileMgr.getFileNativePath(e);MiniFileMgr.filesListObj[l]={md5:e,readyUrl:i,size:a,times:r.now(),encoding:t},MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)+a,MiniFileMgr.writeFilesList(l,JSON.stringify(MiniFileMgr.filesListObj),!0),null!=o&&o.runWith([0])}else if(MiniFileMgr.filesListObj[l]){var s=parseInt(MiniFileMgr.filesListObj[l].size);MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)-s,delete MiniFileMgr.filesListObj[l],MiniFileMgr.writeFilesList(l,JSON.stringify(MiniFileMgr.filesListObj),!1),null!=o&&o.runWith([0])}},MiniFileMgr.writeFilesList=function(i,e,n){var t=MiniFileMgr.fileNativeDir+"/"+MiniFileMgr.fileListName;MiniFileMgr.fs.writeFile({filePath:t,encoding:"utf8",data:e,success:function(i){},fail:function(i){}}),!x.isZiYu&&x.isPosMsgYu&&x.window.wx.postMessage&&x.window.wx.postMessage({url:i,data:MiniFileMgr.filesListObj[i],isLoad:"filenative",isAdd:n})},MiniFileMgr.getCacheUseSize=function(){return MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj.fileUsedSize?MiniFileMgr.filesListObj.fileUsedSize:0},MiniFileMgr.existDir=function(i,e){MiniFileMgr.fs.mkdir({dirPath:i,success:function(i){null!=e&&e.runWith([0,{data:JSON.stringify({})}])},fail:function(i){-1!=i.errMsg.indexOf("file already exists")?MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",e):null!=e&&e.runWith([1,i])}})},MiniFileMgr.readSync=function(i,e,n,t){void 0===e&&(e="utf8"),void 0===t&&(t="");var o,a=MiniFileMgr.getFileNativePath(i);try{o=MiniFileMgr.fs.readFileSync(a,e),null!=n&&n.runWith([0,{data:o}])}catch(i){null!=n&&n.runWith([1])}},MiniFileMgr.setNativeFileDir=function(i){MiniFileMgr.fileNativeDir=x.window.wx.env.USER_DATA_PATH+i},MiniFileMgr.filesListObj={},MiniFileMgr.fakeObj={},MiniFileMgr.fileNativeDir=null,MiniFileMgr.fileListName="layaairfiles.txt",MiniFileMgr.ziyuFileData={},MiniFileMgr.ziyuFileTextureData={},MiniFileMgr.loadPath="",MiniFileMgr.DESCENDING=2,MiniFileMgr.NUMERIC=16,t(MiniFileMgr,["fs",function(){return this.fs=x.window.wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=x.window.wx.downloadFile}]),MiniFileMgr}()),y=function(){function MiniLocalStorage(){}return o(MiniLocalStorage,"laya.wx.mini.MiniLocalStorage"),MiniLocalStorage.__init__=function(){MiniLocalStorage.items=MiniLocalStorage},MiniLocalStorage.setItem=function(i,e){try{wx.setStorageSync(i,e)}catch(n){wx.setStorage({key:i,data:e})}},MiniLocalStorage.getItem=function(i){return wx.getStorageSync(i)},MiniLocalStorage.setJSON=function(i,e){MiniLocalStorage.setItem(i,e)},MiniLocalStorage.getJSON=function(i){return MiniLocalStorage.getItem(i)},MiniLocalStorage.removeItem=function(i){wx.removeStorageSync(i)},MiniLocalStorage.clear=function(){wx.clearStorageSync()},MiniLocalStorage.getStorageInfoSync=function(){try{var i=wx.getStorageInfoSync();return console.log(i.keys),console.log(i.currentSize),console.log(i.limitSize),i}catch(i){}return null},MiniLocalStorage.support=!0,MiniLocalStorage.items=null,MiniLocalStorage}(),_=(function(){function MiniVideo(i,e){this.videoend=!1,this.videourl="",this.videoElement=null,this.onPlayFunc=null,this.onEndedFunC=null,this._duration=NaN,this.position=NaN,void 0===i&&(i=320),void 0===e&&(e=240),this.videoElement=x.window.wx.createVideo({width:i,height:e,autoplay:!0})}o(MiniVideo,"laya.wx.mini.MiniVideo");var i=MiniVideo.prototype;i.on=function(i,e,n){"loadedmetadata"==i?(this.onPlayFunc=n.bind(e),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=n.bind(e),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},i.onTimeUpdateFunc=function(i){this.position=i.position,this._duration=i.duration},i.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc()},i.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC())},i.off=function(i,e,n){"loadedmetadata"==i?(this.onPlayFunc=n.bind(e),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==i&&(this.onEndedFunC=n.bind(e),this.videoElement.offEnded=this.onEndedFunction.bind(this))},i.load=function(i){this.videoElement&&(this.videoElement.src=i)},i.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},i.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},i.size=function(i,e){this.videoElement&&(this.videoElement.width=i,this.videoElement.height=e)},i.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},i.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},a(0,i,"duration",function(){return this._duration}),a(0,i,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),a(0,i,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(i){this.videoElement&&(this.videoElement.loop=i)}),a(0,i,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(i){this.videoElement&&(this.videoElement.initialTime=i)}),a(0,i,"ended",function(){return this.videoend}),a(0,i,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(i){this.videoElement&&(this.videoElement.muted=i)}),a(0,i,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),a(0,i,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),a(0,i,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(i){this.videoElement&&(this.videoElement.playbackRate=i)}),a(0,i,"x",function(){return this.videoElement?this.videoElement.x:0},function(i){this.videoElement&&(this.videoElement.x=i)}),a(0,i,"y",function(){return this.videoElement?this.videoElement.y:0},function(i){this.videoElement&&(this.videoElement.y=i)}),a(0,i,"currentSrc",function(){return this.videoElement.src}),MiniVideo.__init__=function(){laya.device.media.Video=MiniVideo}}(),function(){function MiniImage(){}return o(MiniImage,"laya.wx.mini.MiniImage"),MiniImage.prototype._loadImage=function(i){if(x.isZiYu)MiniImage.onCreateImage(i,this,!0);else{var e=!1;if(w.isLocalNativeFile(i)){if(-1==i.indexOf("http://usr/")&&(-1!=i.indexOf("http://")||-1!=i.indexOf("https://")))if(""!=w.loadPath)i=i.split(w.loadPath)[1];else{var n=""!=m.rootPath?m.rootPath:m._basePath,t=i;""!=n&&(i=i.split(n)[1]),i||(i=t)}if(x.subNativeFiles&&0==x.subNativeheads.length)for(var o in x.subNativeFiles){var a=x.subNativeFiles[o];x.subNativeheads=x.subNativeheads.concat(a);for(var r=0;r<a.length;r++)x.subMaps[a[r]]=o+"/"+a[r]}if(x.subNativeFiles&&-1!=i.indexOf("/")){var l=i.split("/")[0]+"/";if(l&&-1!=x.subNativeheads.indexOf(l)){var s=x.subMaps[l];i=i.replace(l,s)}}}else e=!0,i=m.formatURL(i);w.getFileInfo(i)?MiniImage.onCreateImage(i,this,!e):-1!=i.indexOf("http://usr/")||-1==i.indexOf("http://")&&-1==i.indexOf("https://")?MiniImage.onCreateImage(i,this,!0):x.isZiYu?MiniImage.onCreateImage(i,this,!0):w.downOtherFiles(i,new d(MiniImage,MiniImage.onDownImgCallBack,[i,this]),i)}},MiniImage.onDownImgCallBack=function(i,e,n,t){void 0===t&&(t=""),n?e.onError(null):MiniImage.onCreateImage(i,e,!1,t)},MiniImage.onCreateImage=function(i,e,n,t){var o,a;if(void 0===n&&(n=!1),void 0===t&&(t=""),x.autoCacheFile)if(n)if(x.isZiYu){var l=m.formatURL(i);o=w.ziyuFileTextureData[l]?w.ziyuFileTextureData[l]:i}else o=i;else if(""!=t)o=t;else{var d=w.getFileInfo(i).md5;o=w.getFileNativePath(d)}else o=n?i:t;function clear(){var i=e._imgCache[o];i&&(i.onload=null,i.onerror=null,delete e._imgCache[o])}null==e._imgCache&&(e._imgCache={});var u=function(){clear(),delete w.fakeObj[i],delete w.filesListObj[i],e.event("error","Load image failed")};if("nativeimage"==e._type){var c=function(){clear(),e.onLoaded(a)};(a=new r.window.Image).crossOrigin="",a.onload=c,a.onerror=u,a.src=o,e._imgCache[o]=a}else{var f=new r.window.Image;c=function(){(a=s.create(f.width,f.height)).loadImageSource(f,!0),a._setCreateURL(o),clear(),e.onLoaded(a)},f.crossOrigin="",f.onload=c,f.onerror=u,f.src=o,e._imgCache[o]=f}},MiniImage}()),L=function(){function MiniInput(){}return o(MiniInput,"laya.wx.mini.MiniInput"),MiniInput._createInputElement=function(){u._initInput(u.area=r.createElement("textarea")),u._initInput(u.input=r.createElement("input")),u.inputContainer=r.createElement("div"),u.inputContainer.style.position="absolute",u.inputContainer.style.zIndex=1e5,r.container.appendChild(u.inputContainer),u.inputContainer.setPos=function(i,e){u.inputContainer.style.left=i+"px",u.inputContainer.style.top=e+"px"},n.stage.on("resize",null,MiniInput._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(e){i.dispatchEvent&&i.dispatchEvent("resize")}),v._soundClass=S,v._musicClass=S;var e=x.systemInfo.model,t=x.systemInfo.system;-1!=e.indexOf("iPhone")&&(r.onIPhone=!0,r.onIOS=!0,r.onIPad=!0,r.onAndroid=!1),-1==t.indexOf("Android")&&-1==t.indexOf("Adr")||(r.onAndroid=!0,r.onIPhone=!1,r.onIOS=!1,r.onIPad=!1)},MiniInput._onStageResize=function(){n.stage._canvasTransform.identity().scale(r.width/M.canvas.width/r.pixelRatio,r.height/M.canvas.height/r.pixelRatio)},MiniInput.wxinputFocus=function(i){var e=u.inputElement.target;e&&!e.editable||(x.window.wx.offKeyboardConfirm(),x.window.wx.offKeyboardInput(),x.window.wx.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:e.confirmType||"done",success:function(i){},fail:function(i){}}),x.window.wx.onKeyboardConfirm(function(i){var n=i?i.value:"";e._restrictPattern&&(n=n.replace(/\u2006|\x27/g,""),e._restrictPattern.test(n)&&(n=n.replace(e._restrictPattern,""))),e.text=n,e.event("input"),laya.wx.mini.MiniInput.inputEnter(),e.event("confirm")}),x.window.wx.onKeyboardInput(function(i){var n=i?i.value:"";e.multiline||-1==n.indexOf("\n")?(e._restrictPattern&&(n=n.replace(/\u2006|\x27/g,""),e._restrictPattern.test(n)&&(n=n.replace(e._restrictPattern,""))),e.text=n,e.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},MiniInput.inputEnter=function(){u.inputElement.target.focus=!1},MiniInput.wxinputblur=function(){MiniInput.hideKeyboard()},MiniInput.hideKeyboard=function(){x.window.wx.offKeyboardConfirm(),x.window.wx.offKeyboardInput(),x.window.wx.hideKeyboard({success:function(i){console.log("隐藏键盘")},fail:function(i){console.log("隐藏键盘出错:"+(i?i.errMsg:""))}})},MiniInput}(),x=function(){function MiniAdpter(){}return o(MiniAdpter,"laya.wx.mini.MiniAdpter"),MiniAdpter.getJson=function(i){return JSON.parse(i)},MiniAdpter.enable=function(){MiniAdpter.init(n.isWXPosMsg,n.isWXOpenDataContext)},MiniAdpter.init=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),MiniAdpter._inited||(MiniAdpter._inited=!0,MiniAdpter.window=i,MiniAdpter.window.hasOwnProperty("wx")&&(MiniAdpter.window.navigator.userAgent.indexOf("MiniGame")<0||(MiniAdpter.isZiYu=t,MiniAdpter.isPosMsgYu=e,MiniAdpter.EnvConfig={},MiniAdpter.isZiYu||(w.setNativeFileDir("/layaairGame"),w.existDir(w.fileNativeDir,d.create(MiniAdpter,MiniAdpter.onMkdirCallBack))),MiniAdpter.systemInfo=wx.getSystemInfoSync(),MiniAdpter.window.focus=function(){},n._getUrlPath=function(){return""},MiniAdpter.window.logtime=function(i){},MiniAdpter.window.alertTimeLog=function(i){},MiniAdpter.window.resetShareInfo=function(){},MiniAdpter.window.CanvasRenderingContext2D=function(){},MiniAdpter.window.CanvasRenderingContext2D.prototype=MiniAdpter.window.wx.createCanvas().getContext("2d").__proto__,MiniAdpter.window.document.body.appendChild=function(){},MiniAdpter.EnvConfig.pixelRatioInt=0,r._pixelRatio=MiniAdpter.pixelRatio(),MiniAdpter._preCreateElement=r.createElement,r.createElement=MiniAdpter.createElement,p.createShaderCondition=MiniAdpter.createShaderCondition,F.parseXMLFromString=MiniAdpter.parseXMLFromString,u._createInputElement=L._createInputElement,MiniAdpter.EnvConfig.load=c.prototype.load,c.prototype.load=C.prototype.load,c.prototype._loadImage=_.prototype._loadImage,f._baseClass=y,y.__init__(),MiniAdpter.window.wx.onMessage(MiniAdpter._onMessage))))},MiniAdpter._onMessage=function(i){switch(i.type){case"changeMatrix":n.stage.transform.identity(),n.stage._width=i.w,n.stage._height=i.h,n.stage._canvasTransform=new h(i.a,i.b,i.c,i.d,i.tx,i.ty);break;case"display":n.stage.frameRate=i.rate||"fast";break;case"undisplay":n.stage.frameRate="sleep"}"opendatacontext"==i.isLoad?i.url&&(w.ziyuFileData[i.url]=i.atlasdata,w.ziyuFileTextureData[i.imgReadyUrl]=i.imgNativeUrl):"openJsondatacontext"==i.isLoad?i.url&&(w.ziyuFileData[i.url]=i.atlasdata):"openJsondatacontextPic"==i.isLoad&&(w.ziyuFileTextureData[i.imgReadyUrl]=i.imgNativeUrl)},MiniAdpter.getUrlEncode=function(i,e){return"arraybuffer"==e?"":"utf8"},MiniAdpter.downLoadFile=function(i,e,n,t){void 0===e&&(e=""),void 0===t&&(t="utf8"),w.getFileInfo(i)?null!=n&&n.runWith([0]):w.downLoadFile(i,e,n,t)},MiniAdpter.remove=function(i,e){w.deleteFile("",i,e,"",0)},MiniAdpter.removeAll=function(){w.deleteAll()},MiniAdpter.hasNativeFile=function(i){return w.isLocalNativeFile(i)},MiniAdpter.getFileInfo=function(i){return w.getFileInfo(i)},MiniAdpter.getFileList=function(){return w.filesListObj},MiniAdpter.exitMiniProgram=function(){MiniAdpter.window.wx.exitMiniProgram()},MiniAdpter.onMkdirCallBack=function(i,e){i||(w.filesListObj=JSON.parse(e.data),w.fakeObj=w.filesListObj)},MiniAdpter.pixelRatio=function(){if(!MiniAdpter.EnvConfig.pixelRatioInt)try{return MiniAdpter.EnvConfig.pixelRatioInt=MiniAdpter.systemInfo.pixelRatio,MiniAdpter.systemInfo.pixelRatio}catch(i){}return MiniAdpter.EnvConfig.pixelRatioInt},MiniAdpter.createElement=function(e){var n;if("canvas"==e)return 1==MiniAdpter.idx?MiniAdpter.isZiYu?(n=sharedCanvas).style={}:n=i.canvas:n=i.wx.createCanvas(),MiniAdpter.idx++,n;if("textarea"==e||"input"==e)return MiniAdpter.onCreateInput(e);if("div"==e){var t=MiniAdpter._preCreateElement(e);return t.contains=function(i){return null},t.removeChild=function(i){},t}return MiniAdpter._preCreateElement(e)},MiniAdpter.onCreateInput=function(i){var e=MiniAdpter._preCreateElement(i);return e.focus=L.wxinputFocus,e.blur=L.wxinputblur,e.style={},e.value=0,e.parentElement={},e.placeholder={},e.type={},e.setColor=function(i){},e.setType=function(i){},e.setFontFace=function(i){},e.addEventListener=function(i){},e.contains=function(i){return null},e.removeChild=function(i){},e},MiniAdpter.createShaderCondition=function(i){var e=this;return function(){return e[i.replace("this.","")]}},MiniAdpter.sendAtlasToOpenDataContext=function(i){if(!laya.wx.mini.MiniAdpter.isZiYu){var e=c.getRes(m.formatURL(i));if(!e)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";e.meta.image.split(",");if(e.meta&&e.meta.image)for(var n=e.meta.image.split(","),t=i.indexOf("/")>=0?"/":"\\",o=i.lastIndexOf(t),a=o>=0?i.substr(0,o+1):"",r=0,l=n.length;r<l;r++)n[r]=a+n[r];else n=[i.replace(".json",".png")];for(r=0;r<n.length;r++){var s=n[r];MiniAdpter.postInfoToContext(i,s,e)}}},MiniAdpter.postInfoToContext=function(i,e,n){var t={frames:n.frames,meta:n.meta},o=e,a=w.getFileInfo(m.formatURL(e));if(a)var r=a.md5,l=w.getFileNativePath(r);else l=o;if(!l)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:i,atlasdata:t,imgNativeUrl:l,imgReadyUrl:o,isLoad:"opendatacontext"})},MiniAdpter.sendSinglePicToOpenDataContext=function(i){var e=m.formatURL(i),n=w.getFileInfo(e);if(n){var t=n.md5,o=w.getFileNativePath(t);i=e}else o=i;if(!o)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:i,imgNativeUrl:o,imgReadyUrl:i,isLoad:"openJsondatacontextPic"})},MiniAdpter.sendJsonDataToDataContext=function(i){if(!laya.wx.mini.MiniAdpter.isZiYu){var e=c.getRes(i);if(!e)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";wx.postMessage({url:i,atlasdata:e,isLoad:"openJsondatacontext"})}},MiniAdpter.EnvConfig=null,MiniAdpter.window=null,MiniAdpter._preCreateElement=null,MiniAdpter._inited=!1,MiniAdpter.systemInfo=null,MiniAdpter.isZiYu=!1,MiniAdpter.isPosMsgYu=!1,MiniAdpter.autoCacheFile=!0,MiniAdpter.minClearSize=5242880,MiniAdpter.subNativeFiles=null,MiniAdpter.subNativeheads=[],MiniAdpter.subMaps=[],MiniAdpter.AutoCacheDownFile=!1,MiniAdpter.parseXMLFromString=function(e){var n;e=e.replace(/>\s+</g,"><");try{n=(new i.Parser.DOMParser).parseFromString(e,"text/xml")}catch(i){throw"需要引入xml解析库文件"}return n},MiniAdpter.idx=1,t(MiniAdpter,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),MiniAdpter}(),C=function(i){function MiniLoader(){MiniLoader.__super.call(this)}return o(MiniLoader,"laya.wx.mini.MiniLoader",l),MiniLoader.prototype.load=function(i,e,n,t,o){void 0===n&&(n=!0),void 0===o&&(o=!1);if(this._url=i,i){if(0===(i=m.customFormat(i)).indexOf("data:image")?this._type=e="image":this._type=e||(e=c.getTypeFromUrl(this._url)),this._cache=n,this._data=null,!o&&c.loadedMap[m.formatURL(i)])return this._data=c.loadedMap[m.formatURL(i)],this.event("progress",1),void this.event("complete",this._data);if(null!=c.parserMap[e])return this._customParse=!0,void(c.parserMap[e]instanceof laya.utils.Handler?c.parserMap[e].runWith(this):c.parserMap[e].call(null,this));var a;switch(e){case"atlas":case"prefab":case"plf":a="json";break;case"font":a="xml";break;case"plfb":a="arraybuffer";break;default:a=e}if(c.preLoadedMap[m.formatURL(i)])this.onLoaded(c.preLoadedMap[m.formatURL(i)]);else{var r=x.getUrlEncode(i,a),l=F.getFileExtension(i);if(-1!=MiniLoader._fileTypeArr.indexOf(l))x.EnvConfig.load.call(this,i,e,n,t,o);else{if(x.isZiYu&&!w.ziyuFileData[i]&&(i=m.formatURL(i)),x.isZiYu&&w.ziyuFileData[i]){var s=w.ziyuFileData[i];return void this.onLoaded(s)}if(w.getFileInfo(i)){var u=w.getFileInfo(i);u.encoding=null==u.encoding?"utf8":u.encoding,w.readFile(i,u.encoding,new d(MiniLoader,MiniLoader.onReadNativeCallBack,[r,i,e,n,t,o,this]),i)}else{if(w.isLocalNativeFile(i)){if(x.subNativeFiles&&0==x.subNativeheads.length)for(var f in x.subNativeFiles){var h=x.subNativeFiles[f];x.subNativeheads=x.subNativeheads.concat(h);for(var M=0;M<h.length;M++)x.subMaps[h[M]]=f+"/"+h[M]}if(x.subNativeFiles&&-1!=i.indexOf("/")){var p=i.split("/")[0]+"/";if(p&&-1!=x.subNativeheads.indexOf(p)){var g=x.subMaps[p];i=i.replace(p,g)}}var v=""!=m.rootPath?m.rootPath:m._basePath,y=i;return""!=v&&(i=i.split(v)[1]),i||(i=y),void w.read(i,r,new d(MiniLoader,MiniLoader.onReadNativeCallBack,[r,i,e,n,t,o,this]))}var _=m.formatURL(i);-1!=_.indexOf("http://usr/")||-1==_.indexOf("http://")&&-1==_.indexOf("https://")||x.AutoCacheDownFile?(u=w.getFileInfo(i))?(u.encoding=null==u.encoding?"utf8":u.encoding,w.readFile(u.url,r,new d(MiniLoader,MiniLoader.onReadNativeCallBack,[r,i,e,n,t,o,this]),i)):"image"==this.type||"htmlimage"==this.type?x.EnvConfig.load.call(this,i,e,n,t,o):-1==(i=m.formatURL(i)).indexOf("http://")&&-1==i.indexOf("https://")||w.isLocalNativeFile(i)?w.readFile(i,r,new d(MiniLoader,MiniLoader.onReadNativeCallBack,[r,i,e,n,t,o,this]),i):w.downFiles(i,r,new d(MiniLoader,MiniLoader.onReadNativeCallBack,[r,i,e,n,t,o,this]),i,n):x.EnvConfig.load.call(this,i,e,n,t,o)}}}}else this.onLoaded(null)},MiniLoader.onReadNativeCallBack=function(i,e,n,t,o,a,r,l,s){var d;(void 0===t&&(t=!0),void 0===a&&(a=!1),void 0===l&&(l=0),l)?1==l&&x.EnvConfig.load.call(r,e,n,t,o,a):(d="json"==n||"atlas"==n||"prefab"==n||"plf"==n?x.getJson(s.data):"xml"==n?F.parseXMLFromString(s.data):s.data,!x.isZiYu&&x.isPosMsgYu&&"arraybuffer"!=n&&wx.postMessage({url:e,data:d,isLoad:"filedata"}),r.onLoaded(d))},t(MiniLoader,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),MiniLoader}(),S=function(i){function MiniSound(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,MiniSound.__super.call(this)}o(MiniSound,"laya.wx.mini.MiniSound",l);var e=MiniSound.prototype;return e.load=function(i){if(w.isLocalNativeFile(i)){if(-1!=i.indexOf("http://")||-1!=i.indexOf("https://"))if(""!=w.loadPath)i=i.split(w.loadPath)[1];else{var e=""!=m.rootPath?m.rootPath:m._basePath;""!=e&&(i=i.split(e)[1])}}else i=m.formatURL(i);if(this.url=i,this.readyUrl=i,MiniSound._audioCache[this.readyUrl])this.event("complete");else if(x.autoCacheFile&&w.getFileInfo(i))this.onDownLoadCallBack(i,0);else if(x.autoCacheFile)if(w.isLocalNativeFile(i)){var n=i;if(""!=(e=""!=m.rootPath?m.rootPath:m._basePath)&&(i=i.split(e)[1]),i||(i=n),x.subNativeFiles&&0==x.subNativeheads.length)for(var t in x.subNativeFiles){var o=x.subNativeFiles[t];x.subNativeheads=x.subNativeheads.concat(o);for(var a=0;a<o.length;a++)x.subMaps[o[a]]=t+"/"+o[a]}if(x.subNativeFiles&&-1!=i.indexOf("/")){var r=i.split("/")[0]+"/";if(r&&-1!=x.subNativeheads.indexOf(r)){var l=x.subMaps[r];i=i.replace(r,l)}}this.onDownLoadCallBack(i,0)}else!w.isLocalNativeFile(i)&&-1==i.indexOf("http://")&&-1==i.indexOf("https://")||-1!=i.indexOf("http://usr/")?this.onDownLoadCallBack(i,0):w.downOtherFiles(i,d.create(this,this.onDownLoadCallBack,[i]),i);else this.onDownLoadCallBack(i,0)},e.onDownLoadCallBack=function(i,e,n){if(e)this.event("error");else{var t;if(x.autoCacheFile){if(n)t=n;else if(w.isLocalNativeFile(i)){var o=""!=m.rootPath?m.rootPath:m._basePath,a=i;""==o||-1==i.indexOf("http://")&&-1==i.indexOf("https://")||(t=i.split(o)[1]),t||(t=a)}else{var r=w.getFileInfo(i);if(r&&r.md5){var l=r.md5;t=w.getFileNativePath(l)}else t=i}this._sound=MiniSound._createSound(),this._sound.src=this.url=t}else this._sound=MiniSound._createSound(),this._sound.src=i;this._sound.onCanplay(MiniSound.bindToThis(this.onCanPlay,this)),this._sound.onError(MiniSound.bindToThis(this.onError,this))}},e.onError=function(i){try{console.log("-----1---------------minisound-----id:"+MiniSound._id),console.log(i)}catch(i){console.log("-----2---------------minisound-----id:"+MiniSound._id),console.log(i)}this.event("error"),this._sound.offError(null)},e.onCanPlay=function(){this.loaded=!0,this.event("complete"),this._sound.offCanplay(null)},e.play=function(i,e){var n;if(void 0===i&&(i=0),void 0===e&&(e=0),this.url==v._bgMusic?(MiniSound._musicAudio||(MiniSound._musicAudio=MiniSound._createSound()),n=MiniSound._musicAudio):n=MiniSound._audioCache[this.readyUrl]?MiniSound._audioCache[this.readyUrl]._sound:MiniSound._createSound(),!n)return null;if(x.autoCacheFile&&w.getFileInfo(this.url)){var t=w.getFileInfo(this.url).md5;n.src=this.url=w.getFileNativePath(t)}else n.src=this.url;var o=new A(n,this);return o.url=this.url,o.loops=e,o.loop=0===e,o.startTime=i,o.play(),v.addChannel(o),o},e.dispose=function(){var i=MiniSound._audioCache[this.readyUrl];i&&(i.src="",i._sound&&(i._sound.destroy(),i._sound=null,i=null),delete MiniSound._audioCache[this.readyUrl])},a(0,e,"duration",function(){return this._sound.duration}),MiniSound._createSound=function(){return MiniSound._id++,x.window.wx.createInnerAudioContext()},MiniSound.bindToThis=function(i,e){return i.bind(e)},MiniSound._musicAudio=null,MiniSound._id=0,MiniSound._audioCache={},MiniSound}(),A=(function(i){function MiniAccelerator(){MiniAccelerator.__super.call(this)}o(MiniAccelerator,"laya.wx.mini.MiniAccelerator",i);var e=MiniAccelerator.prototype;e.on=function(e,n,t,o){return i.prototype.on.call(this,e,n,t,o),MiniAccelerator.startListen(this.onDeviceOrientationChange),this},e.off=function(e,n,t,o){return void 0===o&&(o=!1),this.hasListener(e)||MiniAccelerator.stopListen(),i.prototype.off.call(this,e,n,t,o)},MiniAccelerator.__init__=function(){try{var i;if(!(i=laya.device.motion.Accelerator))return;i.prototype.on=MiniAccelerator.prototype.on,i.prototype.off=MiniAccelerator.prototype.off}catch(i){}},MiniAccelerator.startListen=function(i){if(MiniAccelerator._callBack=i,!MiniAccelerator._isListening){MiniAccelerator._isListening=!0;try{x.window.wx.onAccelerometerChange(laya.wx.mini.MiniAccelerator.onDeviceOrientationChange)}catch(i){}}},MiniAccelerator.stopListen=function(){MiniAccelerator._isListening=!1;try{x.window.wx.stopAccelerometer({})}catch(i){}},MiniAccelerator.onDeviceOrientationChange=function(i){var e;(e={}).acceleration=i,e.accelerationIncludingGravity=i,e.rotationRate={},null!=MiniAccelerator._callBack&&MiniAccelerator._callBack(e)},MiniAccelerator._isListening=!1,MiniAccelerator._callBack=null}(l),function(i){function MiniSoundChannel(i,e){this._audio=null,this._onEnd=null,this._miniSound=null,MiniSoundChannel.__super.call(this),this._audio=i,this._miniSound=e,this._onEnd=MiniSoundChannel.bindToThis(this.__onEnd,this),i.onEnded(this._onEnd)}o(MiniSoundChannel,"laya.wx.mini.MiniSoundChannel",g);var e=MiniSoundChannel.prototype;return e.__onEnd=function(){if(S._audioCache[this.url]=this._miniSound,1==this.loops)return this.completeHandler&&(n.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},e.play=function(){this.isStopped=!1,v.addChannel(this),this._audio.play()},e.stop=function(){this.isStopped=!0,v.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this._audio.offEnded(null),this._miniSound.dispose(),this._audio=null,this._miniSound=null,this._onEnd=null)},e.pause=function(){this.isStopped=!0,this._audio.pause()},e.resume=function(){this._audio&&(this.isStopped=!1,v.addChannel(this),this._audio.play())},a(0,e,"startTime",null,function(i){this._audio&&(this._audio.startTime=i)}),a(0,e,"autoplay",function(){return this._audio.autoplay},function(i){this._audio.autoplay=i}),a(0,e,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,e,"duration",function(){return this._audio?this._audio.duration:0}),a(0,e,"loop",function(){return this._audio.loop},function(i){this._audio.loop=i}),a(0,e,"volume",function(){return this._audio?this._audio.volume:1},function(i){this._audio&&(this._audio.volume=i)}),MiniSoundChannel.bindToThis=function(i,e){return i.bind(e)},MiniSoundChannel}())},1e3);